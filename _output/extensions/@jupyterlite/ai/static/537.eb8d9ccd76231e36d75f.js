"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[537],{9537:(e,t,o)=>{o.r(t),o.d(t,{VERSION:()=>ye,anthropic:()=>Ue,createAnthropic:()=>ze});var n=o(2100),r=o(1408),a=o(6019),s=o(6190),i=o(2665),u=o(5606);function l(e){return Object.fromEntries([...e.headers])}var c=(({prefix:e,size:t=16,alphabet:o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{const a=()=>{const e=o.length,n=new Array(t);for(let r=0;r<t;r++)n[r]=o[Math.random()*e|0];return n.join("")};if(null==e)return a;if(o.includes(r))throw new n.Di({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${o}".`});return()=>`${e}${r}${a()}`})();function d(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var p=["fetch failed","failed to fetch"];function _(e=globalThis){var t,o,n;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(n=null==(o=e.process)?void 0:o.versions)?void 0:n.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function h(e,...t){const o=(n=null!=e?e:{},Object.fromEntries(Object.entries(n).filter(([e,t])=>null!=t)));var n;const r=new Headers(o),a=r.get("user-agent")||"";return r.set("user-agent",[a,...t].filter(Boolean).join(" ")),Object.fromEntries(r)}function m({apiKey:e,environmentVariableName:t,apiKeyParameterName:o="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new n.Kq({message:`${r} API key must be a string.`});if(void 0===u)throw new n.Kq({message:`${r} API key is missing. Pass it using the '${o}' parameter. Environment variables is not supported in this environment.`});if(null==(e=u.env[t]))throw new n.Kq({message:`${r} API key is missing. Pass it using the '${o}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new n.Kq({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var y=/"__proto__"\s*:/,f=/"constructor"\s*:/;function g(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return function(e){const t=JSON.parse(e);return null===t||"object"!=typeof t||!1===y.test(e)&&!1===f.test(e)?t:function(e){let t=[e];for(;t.length;){const e=t;t=[];for(const o of e){if(Object.prototype.hasOwnProperty.call(o,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(o,"constructor")&&Object.prototype.hasOwnProperty.call(o.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const e in o){const n=o[e];n&&"object"==typeof n&&t.push(n)}}}return e}(t)}(e)}finally{Error.stackTraceLimit=t}}var b=Symbol.for("vercel.ai.validator");async function v({value:e,schema:t}){const o=await k({value:e,schema:t});if(!o.success)throw n.iM.wrap({value:e,cause:o.error});return o.value}async function k({value:e,schema:t}){const o=function(e){return function(e){return"object"==typeof e&&null!==e&&b in e&&!0===e[b]&&"validate"in e}(e)?e:"function"==typeof e?e():(t=e,o=async e=>{const o=await t["~standard"].validate(e);return null==o.issues?{success:!0,value:o.value}:{success:!1,error:new n.iM({value:e,cause:o.issues})}},{[b]:!0,validate:o});var t,o}(t);try{if(null==o.validate)return{success:!0,value:e,rawValue:e};const t=await o.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:n.iM.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:n.iM.wrap({value:e,cause:t}),rawValue:e}}}async function x({text:e,schema:t}){try{const o=g(e);return null==t?{success:!0,value:o,rawValue:o}:await k({value:o,schema:t})}catch(t){return{success:!1,error:n.u6.isInstance(t)?t:new n.u6({text:e,cause:t}),rawValue:void 0}}}function w({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new r.Z).pipeThrough(new TransformStream({async transform({data:e},o){"[DONE]"!==e&&o.enqueue(await x({text:e,schema:t}))}}))}async function j({provider:e,providerOptions:t,schema:o}){if(null==(null==t?void 0:t[e]))return;const r=await k({value:t[e],schema:o});if(!r.success)throw new n.Di({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var Y=()=>globalThis.fetch,I=async({url:e,headers:t,body:o,failedResponseHandler:n,successfulResponseHandler:r,abortSignal:a,fetch:s})=>S({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(o),values:o},failedResponseHandler:n,successfulResponseHandler:r,abortSignal:a,fetch:s}),S=async({url:e,headers:t={},body:o,successfulResponseHandler:r,failedResponseHandler:a,abortSignal:s,fetch:i=Y()})=>{try{const u=await i(e,{method:"POST",headers:h(t,"ai-sdk/provider-utils/3.0.12",_()),body:o.content,signal:s}),c=l(u);if(!u.ok){let t;try{t=await a({response:u,url:e,requestBodyValues:o.values})}catch(t){if(d(t)||n.hL.isInstance(t))throw t;throw new n.hL({message:"Failed to process error response",cause:t,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:o.values})}throw t.value}try{return await r({response:u,url:e,requestBodyValues:o.values})}catch(t){if(t instanceof Error&&(d(t)||n.hL.isInstance(t)))throw t;throw new n.hL({message:"Failed to process successful response",cause:t,statusCode:u.status,url:e,responseHeaders:c,requestBodyValues:o.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:o}){if(d(e))return e;if(e instanceof TypeError&&p.includes(e.message.toLowerCase())){const r=e.cause;if(null!=r)return new n.hL({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:o,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:o.values})}};function P({id:e,name:t,inputSchema:o}){return({execute:n,outputSchema:r,toModelOutput:a,onInputStart:s,onInputDelta:i,onInputAvailable:u,...l})=>({type:"provider-defined",id:e,name:t,args:l,inputSchema:o,outputSchema:r,execute:n,toModelOutput:a,onInputStart:s,onInputDelta:i,onInputAvailable:u})}function T({id:e,name:t,inputSchema:o,outputSchema:n}){return({execute:r,toModelOutput:a,onInputStart:s,onInputDelta:i,onInputAvailable:u,...l})=>({type:"provider-defined",id:e,name:t,args:l,inputSchema:o,outputSchema:n,execute:r,toModelOutput:a,onInputStart:s,onInputDelta:i,onInputAvailable:u})}var O=(e,t)=>{let o=0;for(;o<e.length&&o<t.length&&e[o]===t[o];o++);return[(e.length-o).toString(),...t.slice(o)].join("/")},C=Symbol("Let zodToJsonSchema decide on which parser to use"),A={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function N(e,t){return re(e.type._def,t)}function $(e,t,o){const n=null!=o?o:t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((o,n)=>$(e,t,o))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return E(e)}}var E=e=>{const t={type:"integer",format:"unix-time"};for(const o of e.checks)switch(o.kind){case"min":t.minimum=o.value;break;case"max":t.maximum=o.value}return t},M=void 0,q=/^[cC][^\s-]{8,}$/,Z=/^[0-9a-z]+$/,R=/^[0-9A-HJKMNP-TV-Z]{26}$/,L=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,z=()=>(void 0===M&&(M=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),M),U=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,D=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,H=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,V=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,B=/^[a-zA-Z0-9_-]{21}$/,F=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function K(e,t){const o={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":o.minLength="number"==typeof o.minLength?Math.max(o.minLength,n.value):n.value;break;case"max":o.maxLength="number"==typeof o.maxLength?Math.min(o.maxLength,n.value):n.value;break;case"email":switch(t.emailStrategy){case"format:email":G(o,"email",n.message,t);break;case"format:idn-email":G(o,"idn-email",n.message,t);break;case"pattern:zod":Q(o,L,n.message,t)}break;case"url":G(o,"uri",n.message,t);break;case"uuid":G(o,"uuid",n.message,t);break;case"regex":Q(o,n.regex,n.message,t);break;case"cuid":Q(o,q,n.message,t);break;case"cuid2":Q(o,Z,n.message,t);break;case"startsWith":Q(o,RegExp(`^${J(n.value,t)}`),n.message,t);break;case"endsWith":Q(o,RegExp(`${J(n.value,t)}$`),n.message,t);break;case"datetime":G(o,"date-time",n.message,t);break;case"date":G(o,"date",n.message,t);break;case"time":G(o,"time",n.message,t);break;case"duration":G(o,"duration",n.message,t);break;case"length":o.minLength="number"==typeof o.minLength?Math.max(o.minLength,n.value):n.value,o.maxLength="number"==typeof o.maxLength?Math.min(o.maxLength,n.value):n.value;break;case"includes":Q(o,RegExp(J(n.value,t)),n.message,t);break;case"ip":"v6"!==n.version&&G(o,"ipv4",n.message,t),"v4"!==n.version&&G(o,"ipv6",n.message,t);break;case"base64url":Q(o,V,n.message,t);break;case"jwt":Q(o,F,n.message,t);break;case"cidr":"v6"!==n.version&&Q(o,U,n.message,t),"v4"!==n.version&&Q(o,D,n.message,t);break;case"emoji":Q(o,z(),n.message,t);break;case"ulid":Q(o,R,n.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":G(o,"binary",n.message,t);break;case"contentEncoding:base64":o.contentEncoding="base64";break;case"pattern:zod":Q(o,H,n.message,t)}break;case"nanoid":Q(o,B,n.message,t)}return o}function J(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let o=0;o<e.length;o++)W.has(e[o])||(t+="\\"),t+=e[o];return t}(e):e}var W=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function G(e,t,o,n){var r;e.format||(null==(r=e.anyOf)?void 0:r.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...o&&n.errorMessages&&{errorMessage:{format:o}}})):e.format=t}function Q(e,t,o,n){var r;e.pattern||(null==(r=e.allOf)?void 0:r.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:X(t,n),...o&&n.errorMessages&&{errorMessage:{pattern:o}}})):e.pattern=X(t,n)}function X(e,t){var o;if(!t.applyRegexFlags||!e.flags)return e.source;const n=e.flags.includes("i"),r=e.flags.includes("m"),a=e.flags.includes("s"),s=n?e.source.toLowerCase():e.source;let i="",u=!1,l=!1,c=!1;for(let e=0;e<s.length;e++)if(u)i+=s[e],u=!1;else{if(n)if(l){if(s[e].match(/[a-z]/)){c?(i+=s[e],i+=`${s[e-2]}-${s[e]}`.toUpperCase(),c=!1):"-"===s[e+1]&&(null==(o=s[e+2])?void 0:o.match(/[a-z]/))?(i+=s[e],c=!0):i+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){i+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(r){if("^"===s[e]){i+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){i+="($|(?=[\r\n]))";continue}}a&&"."===s[e]?i+=l?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(i+=s[e],"\\"===s[e]?u=!0:l&&"]"===s[e]?l=!1:l||"["!==s[e]||(l=!0))}try{new RegExp(i)}catch(o){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function ee(e,t){var o,n,r,a,s,u;const l={type:"object",additionalProperties:null!=(o=re(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?o:t.allowedAdditionalProperties};if((null==(n=e.keyType)?void 0:n._def.typeName)===i.kY.ZodString&&(null==(r=e.keyType._def.checks)?void 0:r.length)){const{type:o,...n}=K(e.keyType._def,t);return{...l,propertyNames:n}}if((null==(a=e.keyType)?void 0:a._def.typeName)===i.kY.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(s=e.keyType)?void 0:s._def.typeName)===i.kY.ZodBranded&&e.keyType._def.type._def.typeName===i.kY.ZodString&&(null==(u=e.keyType._def.type._def.checks)?void 0:u.length)){const{type:o,...n}=N(e.keyType._def,t);return{...l,propertyNames:n}}return l}var te={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function oe(e){try{return e.isOptional()}catch(e){return!0}}var ne=(e,t,o)=>{switch(t){case i.kY.ZodString:return K(e,o);case i.kY.ZodNumber:return function(e){const t={type:"number"};if(!e.checks)return t;for(const o of e.checks)switch(o.kind){case"int":t.type="integer";break;case"min":o.inclusive?t.minimum=o.value:t.exclusiveMinimum=o.value;break;case"max":o.inclusive?t.maximum=o.value:t.exclusiveMaximum=o.value;break;case"multipleOf":t.multipleOf=o.value}return t}(e);case i.kY.ZodObject:return function(e,t){const o={type:"object",properties:{}},n=[],r=e.shape();for(const e in r){let a=r[e];if(void 0===a||void 0===a._def)continue;const s=oe(a),i=re(a._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==i&&(o.properties[e]=i,s||n.push(e))}n.length&&(o.required=n);const a=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return re(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==a&&(o.additionalProperties=a),o}(e,o);case i.kY.ZodBigInt:return function(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const o of e.checks)switch(o.kind){case"min":o.inclusive?t.minimum=o.value:t.exclusiveMinimum=o.value;break;case"max":o.inclusive?t.maximum=o.value:t.exclusiveMaximum=o.value;break;case"multipleOf":t.multipleOf=o.value}return t}(e);case i.kY.ZodBoolean:return{type:"boolean"};case i.kY.ZodDate:return $(e,o);case i.kY.ZodUndefined:return{not:{}};case i.kY.ZodNull:return{type:"null"};case i.kY.ZodArray:return function(e,t){var o,n,r;const a={type:"array"};return(null==(o=e.type)?void 0:o._def)&&(null==(r=null==(n=e.type)?void 0:n._def)?void 0:r.typeName)!==i.kY.ZodAny&&(a.items=re(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(a.minItems=e.minLength.value),e.maxLength&&(a.maxItems=e.maxLength.value),e.exactLength&&(a.minItems=e.exactLength.value,a.maxItems=e.exactLength.value),a}(e,o);case i.kY.ZodUnion:case i.kY.ZodDiscriminatedUnion:return function(e,t){const o=e.options instanceof Map?Array.from(e.options.values()):e.options;if(o.every(e=>e._def.typeName in te&&(!e._def.checks||!e._def.checks.length))){const e=o.reduce((e,t)=>{const o=te[t._def.typeName];return o&&!e.includes(o)?[...e,o]:e},[]);return{type:e.length>1?e:e[0]}}if(o.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=o.reduce((e,t)=>{const o=typeof t._def.value;switch(o){case"string":case"number":case"boolean":return[...e,o];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===o.length){const t=e.filter((e,t,o)=>o.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:o.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(o.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:o.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return((e,t)=>{const o=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,o)=>re(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${o}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return o.length?{anyOf:o}:void 0})(e,t)}(e,o);case i.kY.ZodIntersection:return function(e,t){const o=[re(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),re(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),n=[];return o.forEach(e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:o,...n}=e;t=n}n.push(t)}else n.push(...e.allOf);var t}),n.length?{allOf:n}:void 0}(e,o);case i.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,o)=>re(e._def,{...t,currentPath:[...t.currentPath,"items",`${o}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:re(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,o)=>re(e._def,{...t,currentPath:[...t.currentPath,"items",`${o}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,o);case i.kY.ZodRecord:return ee(e,o);case i.kY.ZodLiteral:return function(e){const t=typeof e.value;return"bigint"!==t&&"number"!==t&&"boolean"!==t&&"string"!==t?{type:Array.isArray(e.value)?"array":"object"}:{type:"bigint"===t?"integer":t,const:e.value}}(e);case i.kY.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case i.kY.ZodNativeEnum:return function(e){const t=e.values,o=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),n=Array.from(new Set(o.map(e=>typeof e)));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:o}}(e);case i.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[te[e.innerType._def.typeName],"null"]};const o=re(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]}}(e,o);case i.kY.ZodOptional:return((e,t)=>{var o;if(t.currentPath.toString()===(null==(o=t.propertyPath)?void 0:o.toString()))return re(e.innerType._def,t);const n=re(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}})(e,o);case i.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?ee(e,t):{type:"array",maxItems:125,items:{type:"array",items:[re(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},re(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,o);case i.kY.ZodSet:return function(e,t){const o={type:"array",uniqueItems:!0,items:re(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(o.minItems=e.minSize.value),e.maxSize&&(o.maxItems=e.maxSize.value),o}(e,o);case i.kY.ZodLazy:return()=>e.getter()._def;case i.kY.ZodPromise:return function(e,t){return re(e.type._def,t)}(e,o);case i.kY.ZodNaN:case i.kY.ZodNever:return{not:{}};case i.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?re(e.schema._def,t):{}}(e,o);case i.kY.ZodAny:case i.kY.ZodUnknown:return{};case i.kY.ZodDefault:return function(e,t){return{...re(e.innerType._def,t),default:e.defaultValue()}}(e,o);case i.kY.ZodBranded:return N(e,o);case i.kY.ZodReadonly:case i.kY.ZodCatch:return((e,t)=>re(e.innerType._def,t))(e,o);case i.kY.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return re(e.in._def,t);if("output"===t.pipeStrategy)return re(e.out._def,t);const o=re(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[o,re(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",o?"1":"0"]})].filter(e=>void 0!==e)}})(e,o);case i.kY.ZodFunction:case i.kY.ZodVoid:case i.kY.ZodSymbol:default:return}};function re(e,t,o=!1){var n;const r=t.seen.get(e);if(t.override){const a=null==(n=t.override)?void 0:n.call(t,e,t,r,o);if(a!==C)return a}if(r&&!o){const e=ae(r,t);if(void 0!==e)return e}const a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);const s=ne(e,e.typeName,t),i="function"==typeof s?re(s(),t):s;if(i&&se(e,t,i),t.postProcess){const o=t.postProcess(i,e,t);return a.jsonSchema=i,o}return a.jsonSchema=i,i}var ae=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:O(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,o)=>t.currentPath[o]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},se=(e,t,o)=>(e.description&&(o.description=e.description),o),ie=(e,t)=>{var o;const n=(e=>{const t=(e=>"string"==typeof e?{...A,name:e}:{...A,...e})(e),o=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:o,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,o])=>[o._def,{def:o._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}})(t);let r="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,o])=>{var r;return{...e,[t]:null!=(r=re(o._def,{...n,currentPath:[...n.basePath,n.definitionPath,t]},!0))?r:{}}},{}):void 0;const a="string"==typeof t?t:"title"===(null==t?void 0:t.nameStrategy)||null==t?void 0:t.name,s=null!=(o=re(e._def,void 0===a?n:{...n,currentPath:[...n.basePath,n.definitionPath,a]},!1))?o:{},i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(s.title=i);const u=void 0===a?r?{...s,[n.definitionPath]:r}:s:{$ref:[..."relative"===n.$refStrategy?[]:n.basePath,n.definitionPath,a].join("/"),[n.definitionPath]:{...r,[a]:s}};return u.$schema="http://json-schema.org/draft-07/schema#",u};function ue(e,t){return function(e){return"_zod"in e}(e)?function(e,t){var o;const n=null!=(o=null==t?void 0:t.useReferences)&&o;return de(()=>a.b(e,{target:"draft-7",io:"output",reused:n?"ref":"inline"}),{validate:async t=>{const o=await s.bp(e,t);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}(e,t):function(e,t){var o;const n=null!=(o=null==t?void 0:t.useReferences)&&o;return de(()=>ie(e,{$refStrategy:n?"root":"none"}),{validate:async t=>{const o=await e.safeParseAsync(t);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}(e,t)}var le=Symbol.for("vercel.ai.schema");function ce(e){let t;return()=>(null==t&&(t=e()),t)}function de(e,{validate:t}={}){return{[le]:!0,_type:void 0,[b]:!0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}var{btoa:pe,atob:_e}=globalThis;function he(e){return e instanceof Uint8Array?function(e){let t="";for(let o=0;o<e.length;o++)t+=String.fromCodePoint(e[o]);return pe(t)}(e):e}var me=o(6097),ye="2.0.30",fe=(({errorSchema:e,errorToMessage:t,isRetryable:o})=>async({response:r,url:a,requestBodyValues:s})=>{const i=await r.text(),u=l(r);if(""===i.trim())return{responseHeaders:u,value:new n.hL({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:u,responseBody:i,isRetryable:null==o?void 0:o(r)})};try{const l=await async function({text:e,schema:t}){try{const o=g(e);return null==t?o:v({value:o,schema:t})}catch(t){if(n.u6.isInstance(t)||n.iM.isInstance(t))throw t;throw new n.u6({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:u,value:new n.hL({message:t(l),url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:u,responseBody:i,data:l,isRetryable:null==o?void 0:o(r,l)})}}catch(e){return{responseHeaders:u,value:new n.hL({message:r.statusText,url:a,requestBodyValues:s,statusCode:r.status,responseHeaders:u,responseBody:i,isRetryable:null==o?void 0:o(r)})}}})({errorSchema:ce(()=>ue(me.Ik({type:me.eu("error"),error:me.Ik({type:me.Yj(),message:me.Yj()})}))),errorToMessage:e=>e.error.message}),ge=ce(()=>ue(me.Ik({type:me.eu("message"),id:me.Yj().nullish(),model:me.Yj().nullish(),content:me.YO(me.gM("type",[me.Ik({type:me.eu("text"),text:me.Yj(),citations:me.YO(me.gM("type",[me.Ik({type:me.eu("web_search_result_location"),cited_text:me.Yj(),url:me.Yj(),title:me.Yj(),encrypted_index:me.Yj()}),me.Ik({type:me.eu("page_location"),cited_text:me.Yj(),document_index:me.ai(),document_title:me.Yj().nullable(),start_page_number:me.ai(),end_page_number:me.ai()}),me.Ik({type:me.eu("char_location"),cited_text:me.Yj(),document_index:me.ai(),document_title:me.Yj().nullable(),start_char_index:me.ai(),end_char_index:me.ai()})])).optional()}),me.Ik({type:me.eu("thinking"),thinking:me.Yj(),signature:me.Yj()}),me.Ik({type:me.eu("redacted_thinking"),data:me.Yj()}),me.Ik({type:me.eu("tool_use"),id:me.Yj(),name:me.Yj(),input:me.L5()}),me.Ik({type:me.eu("server_tool_use"),id:me.Yj(),name:me.Yj(),input:me.g1(me.Yj(),me.L5()).nullish()}),me.Ik({type:me.eu("web_fetch_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.Ik({type:me.eu("web_fetch_result"),url:me.Yj(),retrieved_at:me.Yj(),content:me.Ik({type:me.eu("document"),title:me.Yj().nullable(),citations:me.Ik({enabled:me.zM()}).optional(),source:me.Ik({type:me.eu("text"),media_type:me.Yj(),data:me.Yj()})})}),me.Ik({type:me.eu("web_fetch_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("web_search_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.YO(me.Ik({type:me.eu("web_search_result"),url:me.Yj(),title:me.Yj(),encrypted_content:me.Yj(),page_age:me.Yj().nullish()})),me.Ik({type:me.eu("web_search_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("code_execution_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.Ik({type:me.eu("code_execution_result"),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}),me.Ik({type:me.eu("code_execution_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("bash_code_execution_tool_result"),tool_use_id:me.Yj(),content:me.gM("type",[me.Ik({type:me.eu("bash_code_execution_result"),content:me.YO(me.Ik({type:me.eu("bash_code_execution_output"),file_id:me.Yj()})),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}),me.Ik({type:me.eu("bash_code_execution_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("text_editor_code_execution_tool_result"),tool_use_id:me.Yj(),content:me.gM("type",[me.Ik({type:me.eu("text_editor_code_execution_tool_result_error"),error_code:me.Yj()}),me.Ik({type:me.eu("text_editor_code_execution_view_result"),content:me.Yj(),file_type:me.Yj(),num_lines:me.ai().nullable(),start_line:me.ai().nullable(),total_lines:me.ai().nullable()}),me.Ik({type:me.eu("text_editor_code_execution_create_result"),is_file_update:me.zM()}),me.Ik({type:me.eu("text_editor_code_execution_str_replace_result"),lines:me.YO(me.Yj()).nullable(),new_lines:me.ai().nullable(),new_start:me.ai().nullable(),old_lines:me.ai().nullable(),old_start:me.ai().nullable()})])})])),stop_reason:me.Yj().nullish(),stop_sequence:me.Yj().nullish(),usage:me._H({input_tokens:me.ai(),output_tokens:me.ai(),cache_creation_input_tokens:me.ai().nullish(),cache_read_input_tokens:me.ai().nullish()})}))),be=ce(()=>ue(me.gM("type",[me.Ik({type:me.eu("message_start"),message:me.Ik({id:me.Yj().nullish(),model:me.Yj().nullish(),usage:me._H({input_tokens:me.ai(),cache_creation_input_tokens:me.ai().nullish(),cache_read_input_tokens:me.ai().nullish()})})}),me.Ik({type:me.eu("content_block_start"),index:me.ai(),content_block:me.gM("type",[me.Ik({type:me.eu("text"),text:me.Yj()}),me.Ik({type:me.eu("thinking"),thinking:me.Yj()}),me.Ik({type:me.eu("tool_use"),id:me.Yj(),name:me.Yj()}),me.Ik({type:me.eu("redacted_thinking"),data:me.Yj()}),me.Ik({type:me.eu("server_tool_use"),id:me.Yj(),name:me.Yj(),input:me.g1(me.Yj(),me.L5()).nullish()}),me.Ik({type:me.eu("web_fetch_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.Ik({type:me.eu("web_fetch_result"),url:me.Yj(),retrieved_at:me.Yj(),content:me.Ik({type:me.eu("document"),title:me.Yj().nullable(),citations:me.Ik({enabled:me.zM()}).optional(),source:me.Ik({type:me.eu("text"),media_type:me.Yj(),data:me.Yj()})})}),me.Ik({type:me.eu("web_fetch_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("web_search_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.YO(me.Ik({type:me.eu("web_search_result"),url:me.Yj(),title:me.Yj(),encrypted_content:me.Yj(),page_age:me.Yj().nullish()})),me.Ik({type:me.eu("web_search_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("code_execution_tool_result"),tool_use_id:me.Yj(),content:me.KC([me.Ik({type:me.eu("code_execution_result"),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}),me.Ik({type:me.eu("code_execution_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("bash_code_execution_tool_result"),tool_use_id:me.Yj(),content:me.gM("type",[me.Ik({type:me.eu("bash_code_execution_result"),content:me.YO(me.Ik({type:me.eu("bash_code_execution_output"),file_id:me.Yj()})),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}),me.Ik({type:me.eu("bash_code_execution_tool_result_error"),error_code:me.Yj()})])}),me.Ik({type:me.eu("text_editor_code_execution_tool_result"),tool_use_id:me.Yj(),content:me.gM("type",[me.Ik({type:me.eu("text_editor_code_execution_tool_result_error"),error_code:me.Yj()}),me.Ik({type:me.eu("text_editor_code_execution_view_result"),content:me.Yj(),file_type:me.Yj(),num_lines:me.ai().nullable(),start_line:me.ai().nullable(),total_lines:me.ai().nullable()}),me.Ik({type:me.eu("text_editor_code_execution_create_result"),is_file_update:me.zM()}),me.Ik({type:me.eu("text_editor_code_execution_str_replace_result"),lines:me.YO(me.Yj()).nullable(),new_lines:me.ai().nullable(),new_start:me.ai().nullable(),old_lines:me.ai().nullable(),old_start:me.ai().nullable()})])})])}),me.Ik({type:me.eu("content_block_delta"),index:me.ai(),delta:me.gM("type",[me.Ik({type:me.eu("input_json_delta"),partial_json:me.Yj()}),me.Ik({type:me.eu("text_delta"),text:me.Yj()}),me.Ik({type:me.eu("thinking_delta"),thinking:me.Yj()}),me.Ik({type:me.eu("signature_delta"),signature:me.Yj()}),me.Ik({type:me.eu("citations_delta"),citation:me.gM("type",[me.Ik({type:me.eu("web_search_result_location"),cited_text:me.Yj(),url:me.Yj(),title:me.Yj(),encrypted_index:me.Yj()}),me.Ik({type:me.eu("page_location"),cited_text:me.Yj(),document_index:me.ai(),document_title:me.Yj().nullable(),start_page_number:me.ai(),end_page_number:me.ai()}),me.Ik({type:me.eu("char_location"),cited_text:me.Yj(),document_index:me.ai(),document_title:me.Yj().nullable(),start_char_index:me.ai(),end_char_index:me.ai()})])})])}),me.Ik({type:me.eu("content_block_stop"),index:me.ai()}),me.Ik({type:me.eu("error"),error:me.Ik({type:me.Yj(),message:me.Yj()})}),me.Ik({type:me.eu("message_delta"),delta:me.Ik({stop_reason:me.Yj().nullish(),stop_sequence:me.Yj().nullish()}),usage:me._H({output_tokens:me.ai(),cache_creation_input_tokens:me.ai().nullish()})}),me.Ik({type:me.eu("message_stop")}),me.Ik({type:me.eu("ping")})]))),ve=ce(()=>ue(me.Ik({signature:me.Yj().optional(),redactedData:me.Yj().optional()}))),ke=me.Ik({citations:me.Ik({enabled:me.zM()}).optional(),title:me.Yj().optional(),context:me.Yj().optional()}),xe=me.Ik({sendReasoning:me.zM().optional(),thinking:me.Ik({type:me.KC([me.eu("enabled"),me.eu("disabled")]),budgetTokens:me.ai().optional()}).optional(),disableParallelToolUse:me.zM().optional(),cacheControl:me.Ik({type:me.eu("ephemeral"),ttl:me.KC([me.eu("5m"),me.eu("1h")]).optional()}).optional()});function we(e){var t;const o=null==e?void 0:e.anthropic;return null!=(t=null==o?void 0:o.cacheControl)?t:null==o?void 0:o.cache_control}var je=ce(()=>ue(me.Ik({maxCharacters:me.ai().optional()}))),Ye=P({id:"anthropic.text_editor_20250728",name:"str_replace_based_edit_tool",inputSchema:ce(()=>ue(me.Ik({command:me.k5(["view","create","str_replace","insert"]),path:me.Yj(),file_text:me.Yj().optional(),insert_line:me.ai().int().optional(),new_str:me.Yj().optional(),old_str:me.Yj().optional(),view_range:me.YO(me.ai().int()).optional()})))}),Ie=ce(()=>ue(me.Ik({maxUses:me.ai().optional(),allowedDomains:me.YO(me.Yj()).optional(),blockedDomains:me.YO(me.Yj()).optional(),userLocation:me.Ik({type:me.eu("approximate"),city:me.Yj().optional(),region:me.Yj().optional(),country:me.Yj().optional(),timezone:me.Yj().optional()}).optional()}))),Se=ce(()=>ue(me.YO(me.Ik({url:me.Yj(),title:me.Yj(),pageAge:me.Yj().nullable(),encryptedContent:me.Yj(),type:me.eu("web_search_result")})))),Pe=T({id:"anthropic.web_search_20250305",name:"web_search",inputSchema:ce(()=>ue(me.Ik({query:me.Yj()}))),outputSchema:Se}),Te=ce(()=>ue(me.Ik({maxUses:me.ai().optional(),allowedDomains:me.YO(me.Yj()).optional(),blockedDomains:me.YO(me.Yj()).optional(),citations:me.Ik({enabled:me.zM()}).optional(),maxContentTokens:me.ai().optional()}))),Oe=ce(()=>ue(me.Ik({type:me.eu("web_fetch_result"),url:me.Yj(),content:me.Ik({type:me.eu("document"),title:me.Yj(),citations:me.Ik({enabled:me.zM()}).optional(),source:me.KC([me.Ik({type:me.eu("base64"),mediaType:me.eu("application/pdf"),data:me.Yj()}),me.Ik({type:me.eu("text"),mediaType:me.eu("text/plain"),data:me.Yj()})])}),retrievedAt:me.Yj().nullable()}))),Ce=T({id:"anthropic.web_fetch_20250910",name:"web_fetch",inputSchema:ce(()=>ue(me.Ik({url:me.Yj()}))),outputSchema:Oe}),Ae=ce(()=>ue(me.Ik({type:me.eu("code_execution_result"),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}))),Ne=T({id:"anthropic.code_execution_20250522",name:"code_execution",inputSchema:ce(()=>ue(me.Ik({code:me.Yj()}))),outputSchema:Ae}),$e=ce(()=>ue(me.gM("type",[me.Ik({type:me.eu("bash_code_execution_result"),content:me.YO(me.Ik({type:me.eu("bash_code_execution_output"),file_id:me.Yj()})),stdout:me.Yj(),stderr:me.Yj(),return_code:me.ai()}),me.Ik({type:me.eu("bash_code_execution_tool_result_error"),error_code:me.Yj()}),me.Ik({type:me.eu("text_editor_code_execution_tool_result_error"),error_code:me.Yj()}),me.Ik({type:me.eu("text_editor_code_execution_view_result"),content:me.Yj(),file_type:me.Yj(),num_lines:me.ai().nullable(),start_line:me.ai().nullable(),total_lines:me.ai().nullable()}),me.Ik({type:me.eu("text_editor_code_execution_create_result"),is_file_update:me.zM()}),me.Ik({type:me.eu("text_editor_code_execution_str_replace_result"),lines:me.YO(me.Yj()).nullable(),new_lines:me.ai().nullable(),new_start:me.ai().nullable(),old_lines:me.ai().nullable(),old_start:me.ai().nullable()})]))),Ee=T({id:"anthropic.code_execution_20250825",name:"code_execution",inputSchema:ce(()=>ue(me.gM("type",[me.Ik({type:me.eu("bash_code_execution"),command:me.Yj()}),me.gM("command",[me.Ik({type:me.eu("text_editor_code_execution"),command:me.eu("view"),path:me.Yj()}),me.Ik({type:me.eu("text_editor_code_execution"),command:me.eu("create"),path:me.Yj(),file_text:me.Yj().nullish()}),me.Ik({type:me.eu("text_editor_code_execution"),command:me.eu("str_replace"),path:me.Yj(),old_str:me.Yj(),new_str:me.Yj()})])]))),outputSchema:$e});function Me(e){if("string"==typeof e)return Buffer.from(e,"base64").toString("utf-8");if(e instanceof Uint8Array)return(new TextDecoder).decode(e);if(e instanceof URL)throw new n.b8({functionality:"URL-based text documents are not supported for citations"});throw new n.b8({functionality:"unsupported data type for text documents: "+typeof e})}function qe({finishReason:e,isJsonResponseFromTool:t}){switch(e){case"pause_turn":case"end_turn":case"stop_sequence":return"stop";case"refusal":return"content-filter";case"tool_use":return t?"stop":"tool-calls";case"max_tokens":return"length";default:return"unknown"}}function Ze(e,t,o){var n;if("page_location"!==e.type&&"char_location"!==e.type)return;const r=t[e.document_index];return r?{type:"source",sourceType:"document",id:o(),mediaType:r.mediaType,title:null!=(n=e.document_title)?n:r.title,filename:r.filename,providerMetadata:{anthropic:"page_location"===e.type?{citedText:e.cited_text,startPageNumber:e.start_page_number,endPageNumber:e.end_page_number}:{citedText:e.cited_text,startCharIndex:e.start_char_index,endCharIndex:e.end_char_index}}}:void 0}var Re=class{constructor(e,t){var o;this.specificationVersion="v2",this.modelId=e,this.config=t,this.generateId=null!=(o=t.generateId)?o:c}supportsUrl(e){return"https:"===e.protocol}get provider(){return this.config.provider}get supportedUrls(){var e,t,o;return null!=(o=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?o:{}}async getArgs({prompt:e,maxOutputTokens:t=4096,temperature:o,topP:r,topK:a,frequencyPenalty:s,presencePenalty:i,stopSequences:u,responseFormat:l,seed:c,tools:d,toolChoice:p,providerOptions:_}){var h,m,y;const f=[];null!=s&&f.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=i&&f.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=c&&f.push({type:"unsupported-setting",setting:"seed"}),"json"===(null==l?void 0:l.type)&&(null==l.schema?f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format requires a schema. The response format is ignored."}):null!=d&&f.push({type:"unsupported-setting",setting:"tools",details:"JSON response format does not support tools. The provided tools are ignored."}));const g="json"===(null==l?void 0:l.type)&&null!=l.schema?{type:"function",name:"json",description:"Respond with a JSON object.",inputSchema:l.schema}:void 0,b=await j({provider:"anthropic",providerOptions:_,schema:xe}),{prompt:k,betas:x}=await async function({prompt:e,sendReasoning:t,warnings:o}){var r,a,s,i,u;const l=new Set,c=function(e){const t=[];let o;for(const n of e){const{role:e}=n;switch(e){case"system":"system"!==(null==o?void 0:o.type)&&(o={type:"system",messages:[]},t.push(o)),o.messages.push(n);break;case"assistant":"assistant"!==(null==o?void 0:o.type)&&(o={type:"assistant",messages:[]},t.push(o)),o.messages.push(n);break;case"user":case"tool":"user"!==(null==o?void 0:o.type)&&(o={type:"user",messages:[]},t.push(o)),o.messages.push(n);break;default:throw new Error(`Unsupported role: ${e}`)}}return t}(e);let d;const p=[];async function _(e){var t,o;const n=await j({provider:"anthropic",providerOptions:e,schema:ke});return null!=(o=null==(t=null==n?void 0:n.citations)?void 0:t.enabled)&&o}async function h(e){const t=await j({provider:"anthropic",providerOptions:e,schema:ke});return{title:null==t?void 0:t.title,context:null==t?void 0:t.context}}for(let e=0;e<c.length;e++){const m=c[e],y=e===c.length-1,f=m.type;switch(f){case"system":if(null!=d)throw new n.b8({functionality:"Multiple system messages that are separated by user/assistant messages"});d=m.messages.map(({content:e,providerOptions:t})=>({type:"text",text:e,cache_control:we(t)}));break;case"user":{const e=[];for(const t of m.messages){const{role:o,content:u}=t;switch(o){case"user":for(let o=0;o<u.length;o++){const i=u[o],c=o===u.length-1,d=null!=(r=we(i.providerOptions))?r:c?we(t.providerOptions):void 0;switch(i.type){case"text":e.push({type:"text",text:i.text,cache_control:d});break;case"file":if(i.mediaType.startsWith("image/"))e.push({type:"image",source:i.data instanceof URL?{type:"url",url:i.data.toString()}:{type:"base64",media_type:"image/*"===i.mediaType?"image/jpeg":i.mediaType,data:he(i.data)},cache_control:d});else if("application/pdf"===i.mediaType){l.add("pdfs-2024-09-25");const t=await _(i.providerOptions),o=await h(i.providerOptions);e.push({type:"document",source:i.data instanceof URL?{type:"url",url:i.data.toString()}:{type:"base64",media_type:"application/pdf",data:he(i.data)},title:null!=(a=o.title)?a:i.filename,...o.context&&{context:o.context},...t&&{citations:{enabled:!0}},cache_control:d})}else{if("text/plain"!==i.mediaType)throw new n.b8({functionality:`media type: ${i.mediaType}`});{const t=await _(i.providerOptions),o=await h(i.providerOptions);e.push({type:"document",source:i.data instanceof URL?{type:"url",url:i.data.toString()}:{type:"text",media_type:"text/plain",data:Me(i.data)},title:null!=(s=o.title)?s:i.filename,...o.context&&{context:o.context},...t&&{citations:{enabled:!0}},cache_control:d})}}}}break;case"tool":for(let o=0;o<u.length;o++){const r=u[o],a=o===u.length-1,s=null!=(i=we(r.providerOptions))?i:a?we(t.providerOptions):void 0,c=r.output;let d;switch(c.type){case"content":d=c.value.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,cache_control:void 0};case"media":if(e.mediaType.startsWith("image/"))return{type:"image",source:{type:"base64",media_type:e.mediaType,data:e.data},cache_control:void 0};if("application/pdf"===e.mediaType)return l.add("pdfs-2024-09-25"),{type:"document",source:{type:"base64",media_type:e.mediaType,data:e.data},cache_control:void 0};throw new n.b8({functionality:`media type: ${e.mediaType}`})}});break;case"text":case"error-text":d=c.value;break;default:d=JSON.stringify(c.value)}e.push({type:"tool_result",tool_use_id:r.toolCallId,content:d,is_error:"error-text"===c.type||"error-json"===c.type||void 0,cache_control:s})}break;default:throw new Error(`Unsupported role: ${o}`)}}p.push({role:"user",content:e});break}case"assistant":{const e=[];for(let n=0;n<m.messages.length;n++){const r=m.messages[n],a=n===m.messages.length-1,{content:s}=r;for(let n=0;n<s.length;n++){const i=s[n],l=n===s.length-1,c=null!=(u=we(i.providerOptions))?u:l?we(r.providerOptions):void 0;switch(i.type){case"text":e.push({type:"text",text:y&&a&&l?i.text.trim():i.text,cache_control:c});break;case"reasoning":if(t){const t=await j({provider:"anthropic",providerOptions:i.providerOptions,schema:ve});null!=t?null!=t.signature?e.push({type:"thinking",thinking:i.text,signature:t.signature,cache_control:c}):null!=t.redactedData?e.push({type:"redacted_thinking",data:t.redactedData,cache_control:c}):o.push({type:"other",message:"unsupported reasoning metadata"}):o.push({type:"other",message:"unsupported reasoning metadata"})}else o.push({type:"other",message:"sending reasoning content is disabled for this model"});break;case"tool-call":if(i.providerExecuted){"code_execution"!==i.toolName||null==i.input||"object"!=typeof i.input||!("type"in i.input)||"string"!=typeof i.input.type||"bash_code_execution"!==i.input.type&&"text_editor_code_execution"!==i.input.type?"code_execution"===i.toolName||"web_fetch"===i.toolName||"web_search"===i.toolName?e.push({type:"server_tool_use",id:i.toolCallId,name:i.toolName,input:i.input,cache_control:c}):o.push({type:"other",message:`provider executed tool call for tool ${i.toolName} is not supported`}):e.push({type:"server_tool_use",id:i.toolCallId,name:i.input.type,input:i.input,cache_control:c});break}e.push({type:"tool_use",id:i.toolCallId,name:i.toolName,input:i.input,cache_control:c});break;case"tool-result":if("code_execution"===i.toolName){const t=i.output;if("json"!==t.type){o.push({type:"other",message:`provider executed tool result output type ${t.type} for tool ${i.toolName} is not supported`});break}if(null==t.value||"object"!=typeof t.value||!("type"in t.value)||"string"!=typeof t.value.type){o.push({type:"other",message:`provider executed tool result output value is not a valid code execution result for tool ${i.toolName}`});break}if("code_execution_result"===t.value.type){const o=await v({value:t.value,schema:Ae});e.push({type:"code_execution_tool_result",tool_use_id:i.toolCallId,content:{type:o.type,stdout:o.stdout,stderr:o.stderr,return_code:o.return_code},cache_control:c})}else{const o=await v({value:t.value,schema:$e});e.push("bash_code_execution_result"===o.type||"bash_code_execution_tool_result_error"===o.type?{type:"bash_code_execution_tool_result",tool_use_id:i.toolCallId,cache_control:c,content:o}:{type:"text_editor_code_execution_tool_result",tool_use_id:i.toolCallId,cache_control:c,content:o})}break}if("web_fetch"===i.toolName){const t=i.output;if("json"!==t.type){o.push({type:"other",message:`provider executed tool result output type ${t.type} for tool ${i.toolName} is not supported`});break}const n=await v({value:t.value,schema:Oe});e.push({type:"web_fetch_tool_result",tool_use_id:i.toolCallId,content:{type:"web_fetch_result",url:n.url,retrieved_at:n.retrievedAt,content:{type:"document",title:n.content.title,citations:n.content.citations,source:{type:n.content.source.type,media_type:n.content.source.mediaType,data:n.content.source.data}}},cache_control:c});break}if("web_search"===i.toolName){const t=i.output;if("json"!==t.type){o.push({type:"other",message:`provider executed tool result output type ${t.type} for tool ${i.toolName} is not supported`});break}const n=await v({value:t.value,schema:Se});e.push({type:"web_search_tool_result",tool_use_id:i.toolCallId,content:n.map(e=>({url:e.url,title:e.title,page_age:e.pageAge,encrypted_content:e.encryptedContent,type:e.type})),cache_control:c});break}o.push({type:"other",message:`provider executed tool result for tool ${i.toolName} is not supported`})}}}p.push({role:"assistant",content:e});break}default:throw new Error(`content type: ${f}`)}}return{prompt:{system:d,messages:p},betas:l}}({prompt:e,sendReasoning:null==(h=null==b?void 0:b.sendReasoning)||h,warnings:f}),w="enabled"===(null==(m=null==b?void 0:b.thinking)?void 0:m.type),Y=null==(y=null==b?void 0:b.thinking)?void 0:y.budgetTokens,I={model:this.modelId,max_tokens:t,temperature:o,top_k:a,top_p:r,stop_sequences:u,...w&&{thinking:{type:"enabled",budget_tokens:Y}},system:k.system,messages:k.messages};if(w){if(null==Y)throw new n.b8({functionality:"thinking requires a budget"});null!=I.temperature&&(I.temperature=void 0,f.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported when thinking is enabled"})),null!=a&&(I.top_k=void 0,f.push({type:"unsupported-setting",setting:"topK",details:"topK is not supported when thinking is enabled"})),null!=r&&(I.top_p=void 0,f.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported when thinking is enabled"})),I.max_tokens=t+Y}const{tools:S,toolChoice:P,toolWarnings:T,betas:O}=await async function({tools:e,toolChoice:t,disableParallelToolUse:o}){e=(null==e?void 0:e.length)?e:void 0;const r=[],a=new Set;if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:a};const s=[];for(const t of e)switch(t.type){case"function":{const e=we(t.providerOptions);s.push({name:t.name,description:t.description,input_schema:t.inputSchema,cache_control:e});break}case"provider-defined":switch(t.id){case"anthropic.code_execution_20250522":a.add("code-execution-2025-05-22"),s.push({type:"code_execution_20250522",name:"code_execution"});break;case"anthropic.code_execution_20250825":a.add("code-execution-2025-08-25"),s.push({type:"code_execution_20250825",name:"code_execution"});break;case"anthropic.computer_20250124":a.add("computer-use-2025-01-24"),s.push({name:"computer",type:"computer_20250124",display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case"anthropic.computer_20241022":a.add("computer-use-2024-10-22"),s.push({name:"computer",type:"computer_20241022",display_width_px:t.args.displayWidthPx,display_height_px:t.args.displayHeightPx,display_number:t.args.displayNumber});break;case"anthropic.text_editor_20250124":a.add("computer-use-2025-01-24"),s.push({name:"str_replace_editor",type:"text_editor_20250124"});break;case"anthropic.text_editor_20241022":a.add("computer-use-2024-10-22"),s.push({name:"str_replace_editor",type:"text_editor_20241022"});break;case"anthropic.text_editor_20250429":a.add("computer-use-2025-01-24"),s.push({name:"str_replace_based_edit_tool",type:"text_editor_20250429"});break;case"anthropic.text_editor_20250728":{const e=await v({value:t.args,schema:je});s.push({name:"str_replace_based_edit_tool",type:"text_editor_20250728",max_characters:e.maxCharacters});break}case"anthropic.bash_20250124":a.add("computer-use-2025-01-24"),s.push({name:"bash",type:"bash_20250124"});break;case"anthropic.bash_20241022":a.add("computer-use-2024-10-22"),s.push({name:"bash",type:"bash_20241022"});break;case"anthropic.memory_20250818":a.add("context-management-2025-06-27"),s.push({name:"memory",type:"memory_20250818"});break;case"anthropic.web_fetch_20250910":{a.add("web-fetch-2025-09-10");const e=await v({value:t.args,schema:Te});s.push({type:"web_fetch_20250910",name:"web_fetch",max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,citations:e.citations,max_content_tokens:e.maxContentTokens});break}case"anthropic.web_search_20250305":{const e=await v({value:t.args,schema:Ie});s.push({type:"web_search_20250305",name:"web_search",max_uses:e.maxUses,allowed_domains:e.allowedDomains,blocked_domains:e.blockedDomains,user_location:e.userLocation});break}default:r.push({type:"unsupported-tool",tool:t})}break;default:r.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:s,toolChoice:o?{type:"auto",disable_parallel_tool_use:o}:void 0,toolWarnings:r,betas:a};const i=t.type;switch(i){case"auto":return{tools:s,toolChoice:{type:"auto",disable_parallel_tool_use:o},toolWarnings:r,betas:a};case"required":return{tools:s,toolChoice:{type:"any",disable_parallel_tool_use:o},toolWarnings:r,betas:a};case"none":return{tools:void 0,toolChoice:void 0,toolWarnings:r,betas:a};case"tool":return{tools:s,toolChoice:{type:"tool",name:t.toolName,disable_parallel_tool_use:o},toolWarnings:r,betas:a};default:{const e=i;throw new n.b8({functionality:`tool choice type: ${e}`})}}}(null!=g?{tools:[g],toolChoice:{type:"tool",toolName:g.name},disableParallelToolUse:!0}:{tools:null!=d?d:[],toolChoice:p,disableParallelToolUse:null==b?void 0:b.disableParallelToolUse});return{args:{...I,tools:S,tool_choice:P},warnings:[...f,...T],betas:new Set([...x,...O]),usesJsonResponseTool:null!=g}}async getHeaders({betas:e,headers:t}){return function(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}(await async function(e){return"function"==typeof e&&(e=e()),Promise.resolve(e)}(this.config.headers),e.size>0?{"anthropic-beta":Array.from(e).join(",")}:{},t)}buildRequestUrl(e){var t,o,n;return null!=(n=null==(o=(t=this.config).buildRequestUrl)?void 0:o.call(t,this.config.baseURL,e))?n:`${this.config.baseURL}/messages`}transformRequestBody(e){var t,o,n;return null!=(n=null==(o=(t=this.config).transformRequestBody)?void 0:o.call(t,e))?n:e}extractCitationDocuments(e){return e.filter(e=>"user"===e.role).flatMap(e=>e.content).filter(e=>{var t,o;if("file"!==e.type)return!1;if("application/pdf"!==e.mediaType&&"text/plain"!==e.mediaType)return!1;const n=null==(t=e.providerOptions)?void 0:t.anthropic,r=null==n?void 0:n.citations;return null!=(o=null==r?void 0:r.enabled)&&o}).map(e=>{var t;const o=e;return{title:null!=(t=o.filename)?t:"Untitled Document",filename:o.filename,mediaType:o.mediaType}})}async doGenerate(e){var t,o,r,a,s,i;const{args:u,warnings:c,betas:d,usesJsonResponseTool:p}=await this.getArgs(e),_=this.extractCitationDocuments(e.prompt),{responseHeaders:h,value:m,rawValue:y}=await I({url:this.buildRequestUrl(!1),headers:await this.getHeaders({betas:d,headers:e.headers}),body:this.transformRequestBody(u),failedResponseHandler:fe,successfulResponseHandler:(f=ge,async({response:e,url:t,requestBodyValues:o})=>{const r=await e.text(),a=await x({text:r,schema:f}),s=l(e);if(!a.success)throw new n.hL({message:"Invalid JSON response",cause:a.error,statusCode:e.status,responseHeaders:s,responseBody:r,url:t,requestBodyValues:o});return{responseHeaders:s,value:a.value,rawValue:a.rawValue}}),abortSignal:e.abortSignal,fetch:this.config.fetch});var f;const g=[];for(const e of m.content)switch(e.type){case"text":if(!p&&(g.push({type:"text",text:e.text}),e.citations))for(const t of e.citations){const e=Ze(t,_,this.generateId);e&&g.push(e)}break;case"thinking":g.push({type:"reasoning",text:e.thinking,providerMetadata:{anthropic:{signature:e.signature}}});break;case"redacted_thinking":g.push({type:"reasoning",text:"",providerMetadata:{anthropic:{redactedData:e.data}}});break;case"tool_use":g.push(p?{type:"text",text:JSON.stringify(e.input)}:{type:"tool-call",toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input)});break;case"server_tool_use":"text_editor_code_execution"===e.name||"bash_code_execution"===e.name?g.push({type:"tool-call",toolCallId:e.id,toolName:"code_execution",input:JSON.stringify({type:e.name,...e.input}),providerExecuted:!0}):"web_search"!==e.name&&"code_execution"!==e.name&&"web_fetch"!==e.name||g.push({type:"tool-call",toolCallId:e.id,toolName:e.name,input:JSON.stringify(e.input),providerExecuted:!0});break;case"web_fetch_tool_result":"web_fetch_result"===e.content.type?g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_fetch",result:{type:"web_fetch_result",url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}},providerExecuted:!0}):"web_fetch_tool_result_error"===e.content.type&&g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_fetch",isError:!0,result:{type:"web_fetch_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0});break;case"web_search_tool_result":if(Array.isArray(e.content)){g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_search",result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:null!=(t=e.page_age)?t:null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(const o of e.content)g.push({type:"source",sourceType:"url",id:this.generateId(),url:o.url,title:o.title,providerMetadata:{anthropic:{pageAge:null!=(t=o.page_age)?t:null}}})}else g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_search",isError:!0,result:{type:"web_search_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0});break;case"code_execution_tool_result":"code_execution_result"===e.content.type?g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):"code_execution_tool_result_error"===e.content.type&&g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",isError:!0,result:{type:"code_execution_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0});break;case"bash_code_execution_tool_result":case"text_editor_code_execution_tool_result":g.push({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",result:e.content,providerExecuted:!0})}return{content:g,finishReason:qe({finishReason:m.stop_reason,isJsonResponseFromTool:p}),usage:{inputTokens:m.usage.input_tokens,outputTokens:m.usage.output_tokens,totalTokens:m.usage.input_tokens+m.usage.output_tokens,cachedInputTokens:null!=(o=m.usage.cache_read_input_tokens)?o:void 0},request:{body:u},response:{id:null!=(r=m.id)?r:void 0,modelId:null!=(a=m.model)?a:void 0,headers:h,body:y},warnings:c,providerMetadata:{anthropic:{usage:m.usage,cacheCreationInputTokens:null!=(s=m.usage.cache_creation_input_tokens)?s:null,stopSequence:null!=(i=m.stop_sequence)?i:null}}}}async doStream(e){const{args:t,warnings:o,betas:r,usesJsonResponseTool:a}=await this.getArgs(e),s=this.extractCitationDocuments(e.prompt),i={...t,stream:!0},{responseHeaders:u,value:c}=await I({url:this.buildRequestUrl(!0),headers:await this.getHeaders({betas:r,headers:e.headers}),body:this.transformRequestBody(i),failedResponseHandler:fe,successfulResponseHandler:(d=be,async({response:e})=>{const t=l(e);if(null==e.body)throw new n.Tt({});return{responseHeaders:t,value:w({stream:e.body,schema:d})}}),abortSignal:e.abortSignal,fetch:this.config.fetch});var d;let p="unknown";const _={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},h={};let m,y,f=null,g=null;const b=this.generateId;return{stream:c.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var n,r,i,u,l,c,d,v;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void o.enqueue({type:"error",error:t.error});const k=t.value;switch(k.type){case"ping":return;case"content_block_start":{const e=k.content_block.type;switch(y=e,e){case"text":return h[k.index]={type:"text"},void o.enqueue({type:"text-start",id:String(k.index)});case"thinking":return h[k.index]={type:"reasoning"},void o.enqueue({type:"reasoning-start",id:String(k.index)});case"redacted_thinking":return h[k.index]={type:"reasoning"},void o.enqueue({type:"reasoning-start",id:String(k.index),providerMetadata:{anthropic:{redactedData:k.content_block.data}}});case"tool_use":return h[k.index]=a?{type:"text"}:{type:"tool-call",toolCallId:k.content_block.id,toolName:k.content_block.name,input:"",firstDelta:!0},void o.enqueue(a?{type:"text-start",id:String(k.index)}:{type:"tool-input-start",id:k.content_block.id,toolName:k.content_block.name});case"server_tool_use":if(["web_fetch","web_search","code_execution","text_editor_code_execution","bash_code_execution"].includes(k.content_block.name)){h[k.index]={type:"tool-call",toolCallId:k.content_block.id,toolName:k.content_block.name,input:"",providerExecuted:!0,firstDelta:!0};const e="text_editor_code_execution"===k.content_block.name||"bash_code_execution"===k.content_block.name?"code_execution":k.content_block.name;o.enqueue({type:"tool-input-start",id:k.content_block.id,toolName:e,providerExecuted:!0})}return;case"web_fetch_tool_result":{const e=k.content_block;return void("web_fetch_result"===e.content.type?o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_fetch",result:{type:"web_fetch_result",url:e.content.url,retrievedAt:e.content.retrieved_at,content:{type:e.content.content.type,title:e.content.content.title,citations:e.content.content.citations,source:{type:e.content.content.source.type,mediaType:e.content.content.source.media_type,data:e.content.content.source.data}}}}):"web_fetch_tool_result_error"===e.content.type&&o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_fetch",isError:!0,result:{type:"web_fetch_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0}))}case"web_search_tool_result":{const e=k.content_block;if(Array.isArray(e.content)){o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_search",result:e.content.map(e=>{var t;return{url:e.url,title:e.title,pageAge:null!=(t=e.page_age)?t:null,encryptedContent:e.encrypted_content,type:e.type}}),providerExecuted:!0});for(const t of e.content)o.enqueue({type:"source",sourceType:"url",id:b(),url:t.url,title:t.title,providerMetadata:{anthropic:{pageAge:null!=(n=t.page_age)?n:null}}})}else o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"web_search",isError:!0,result:{type:"web_search_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0});return}case"code_execution_tool_result":{const e=k.content_block;return void("code_execution_result"===e.content.type?o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",result:{type:e.content.type,stdout:e.content.stdout,stderr:e.content.stderr,return_code:e.content.return_code},providerExecuted:!0}):"code_execution_tool_result_error"===e.content.type&&o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",isError:!0,result:{type:"code_execution_tool_result_error",errorCode:e.content.error_code},providerExecuted:!0}))}case"bash_code_execution_tool_result":case"text_editor_code_execution_tool_result":{const e=k.content_block;return void o.enqueue({type:"tool-result",toolCallId:e.tool_use_id,toolName:"code_execution",result:e.content,providerExecuted:!0})}default:throw new Error(`Unsupported content block type: ${e}`)}}case"content_block_stop":if(null!=h[k.index]){const e=h[k.index];switch(e.type){case"text":o.enqueue({type:"text-end",id:String(k.index)});break;case"reasoning":o.enqueue({type:"reasoning-end",id:String(k.index)});break;case"tool-call":if(!a){o.enqueue({type:"tool-input-end",id:e.toolCallId});const t="text_editor_code_execution"===e.toolName||"bash_code_execution"===e.toolName?"code_execution":e.toolName;o.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:t,input:e.input,providerExecuted:e.providerExecuted})}}delete h[k.index]}return void(y=void 0);case"content_block_delta":{const e=k.delta.type;switch(e){case"text_delta":if(a)return;return void o.enqueue({type:"text-delta",id:String(k.index),delta:k.delta.text});case"thinking_delta":return void o.enqueue({type:"reasoning-delta",id:String(k.index),delta:k.delta.thinking});case"signature_delta":return void("thinking"===y&&o.enqueue({type:"reasoning-delta",id:String(k.index),delta:"",providerMetadata:{anthropic:{signature:k.delta.signature}}}));case"input_json_delta":{const e=h[k.index];let t=k.delta.partial_json;if(0===t.length)return;if(a){if("text"!==(null==e?void 0:e.type))return;o.enqueue({type:"text-delta",id:String(k.index),delta:t})}else{if("tool-call"!==(null==e?void 0:e.type))return;!e.firstDelta||"bash_code_execution"!==e.toolName&&"text_editor_code_execution"!==e.toolName||(t=`{"type": "${e.toolName}",${t.substring(1)}`),o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:t}),e.input+=t,e.firstDelta=!1}return}case"citations_delta":{const e=Ze(k.delta.citation,s,b);return void(e&&o.enqueue(e))}default:throw new Error(`Unsupported delta type: ${e}`)}}case"message_start":return _.inputTokens=k.message.usage.input_tokens,_.cachedInputTokens=null!=(r=k.message.usage.cache_read_input_tokens)?r:void 0,m={...k.message.usage},f=null!=(i=k.message.usage.cache_creation_input_tokens)?i:null,void o.enqueue({type:"response-metadata",id:null!=(u=k.message.id)?u:void 0,modelId:null!=(l=k.message.model)?l:void 0});case"message_delta":return _.outputTokens=k.usage.output_tokens,_.totalTokens=(null!=(c=_.inputTokens)?c:0)+(null!=(d=k.usage.output_tokens)?d:0),p=qe({finishReason:k.delta.stop_reason,isJsonResponseFromTool:a}),g=null!=(v=k.delta.stop_sequence)?v:null,void(m={...m,...k.usage});case"message_stop":return void o.enqueue({type:"finish",finishReason:p,usage:_,providerMetadata:{anthropic:{usage:null!=m?m:null,cacheCreationInputTokens:f,stopSequence:g}}});case"error":return void o.enqueue({type:"error",error:k.error});default:throw new Error(`Unsupported chunk type: ${k}`)}}})),request:{body:i},response:{headers:u}}}},Le={bash_20241022:P({id:"anthropic.bash_20241022",name:"bash",inputSchema:ce(()=>ue(me.Ik({command:me.Yj(),restart:me.zM().optional()})))}),bash_20250124:P({id:"anthropic.bash_20250124",name:"bash",inputSchema:ce(()=>ue(me.Ik({command:me.Yj(),restart:me.zM().optional()})))}),codeExecution_20250522:(e={})=>Ne(e),codeExecution_20250825:(e={})=>Ee(e),computer_20241022:P({id:"anthropic.computer_20241022",name:"computer",inputSchema:ce(()=>ue(me.Ik({action:me.k5(["key","type","mouse_move","left_click","left_click_drag","right_click","middle_click","double_click","screenshot","cursor_position"]),coordinate:me.YO(me.ai().int()).optional(),text:me.Yj().optional()})))}),computer_20250124:P({id:"anthropic.computer_20250124",name:"computer",inputSchema:ce(()=>ue(me.Ik({action:me.k5(["key","hold_key","type","cursor_position","mouse_move","left_mouse_down","left_mouse_up","left_click","left_click_drag","right_click","middle_click","double_click","triple_click","scroll","wait","screenshot"]),coordinate:me.PV([me.ai().int(),me.ai().int()]).optional(),duration:me.ai().optional(),scroll_amount:me.ai().optional(),scroll_direction:me.k5(["up","down","left","right"]).optional(),start_coordinate:me.PV([me.ai().int(),me.ai().int()]).optional(),text:me.Yj().optional()})))}),memory_20250818:P({id:"anthropic.memory_20250818",name:"memory",inputSchema:ce(()=>ue(me.gM("command",[me.Ik({command:me.eu("view"),path:me.Yj(),view_range:me.PV([me.ai(),me.ai()]).optional()}),me.Ik({command:me.eu("create"),path:me.Yj(),file_text:me.Yj()}),me.Ik({command:me.eu("str_replace"),path:me.Yj(),old_str:me.Yj(),new_str:me.Yj()}),me.Ik({command:me.eu("insert"),path:me.Yj(),insert_line:me.ai(),insert_text:me.Yj()}),me.Ik({command:me.eu("delete"),path:me.Yj()}),me.Ik({command:me.eu("rename"),old_path:me.Yj(),new_path:me.Yj()})])))}),textEditor_20241022:P({id:"anthropic.text_editor_20241022",name:"str_replace_editor",inputSchema:ce(()=>ue(me.Ik({command:me.k5(["view","create","str_replace","insert","undo_edit"]),path:me.Yj(),file_text:me.Yj().optional(),insert_line:me.ai().int().optional(),new_str:me.Yj().optional(),old_str:me.Yj().optional(),view_range:me.YO(me.ai().int()).optional()})))}),textEditor_20250124:P({id:"anthropic.text_editor_20250124",name:"str_replace_editor",inputSchema:ce(()=>ue(me.Ik({command:me.k5(["view","create","str_replace","insert","undo_edit"]),path:me.Yj(),file_text:me.Yj().optional(),insert_line:me.ai().int().optional(),new_str:me.Yj().optional(),old_str:me.Yj().optional(),view_range:me.YO(me.ai().int()).optional()})))}),textEditor_20250429:P({id:"anthropic.text_editor_20250429",name:"str_replace_based_edit_tool",inputSchema:ce(()=>ue(me.Ik({command:me.k5(["view","create","str_replace","insert"]),path:me.Yj(),file_text:me.Yj().optional(),insert_line:me.ai().int().optional(),new_str:me.Yj().optional(),old_str:me.Yj().optional(),view_range:me.YO(me.ai().int()).optional()})))}),textEditor_20250728:(e={})=>Ye(e),webFetch_20250910:(e={})=>Ce(e),webSearch_20250305:(e={})=>Pe(e)};function ze(e={}){var t;const o=null!=(t=null==(r=e.baseURL)?void 0:r.replace(/\/$/,""))?t:"https://api.anthropic.com/v1";var r;const a=()=>h({"anthropic-version":"2023-06-01","x-api-key":m({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers},`ai-sdk/anthropic/${ye}`),s=t=>{var n;return new Re(t,{provider:"anthropic.messages",baseURL:o,headers:a,fetch:e.fetch,generateId:null!=(n=e.generateId)?n:c,supportedUrls:()=>({"image/*":[/^https?:\/\/.*$/]})})},i=function(e){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return s(e)};return i.languageModel=s,i.chat=s,i.messages=s,i.textEmbeddingModel=e=>{throw new n.eM({modelId:e,modelType:"textEmbeddingModel"})},i.imageModel=e=>{throw new n.eM({modelId:e,modelType:"imageModel"})},i.tools=Le,i}var Ue=ze()}}]);