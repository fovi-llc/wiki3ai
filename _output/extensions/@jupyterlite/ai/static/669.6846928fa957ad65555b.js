"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[669],{6669:(e,t,n)=>{n.r(t),n.d(t,{AbstractChatContext:()=>st,AbstractChatModel:()=>it,ActiveCellManager:()=>o,AttachButton:()=>B,AttachmentOpenerRegistry:()=>lt,Avatar:()=>d,CancelButton:()=>F,Chat:()=>nt,ChatBody:()=>tt,ChatCommandRegistry:()=>ct,ChatInput:()=>ie,ChatMessage:()=>Pe,ChatMessageHeader:()=>ue,ChatMessages:()=>et,ChatSection:()=>xt,ChatWidget:()=>yt,CodeToolbar:()=>be,ContrastingTooltip:()=>w,CopyButton:()=>_e,IAttachmentOpenerRegistry:()=>ot,IChatCommandRegistry:()=>rt,IInputToolbarRegistryFactory:()=>O,IMessageFooterRegistry:()=>dt,InputModel:()=>Ae,InputToolbarRegistry:()=>H,JlThemeProvider:()=>re,MD_MIME_TYPE:()=>Se,MD_RENDERED_CLASS:()=>Ie,MESSAGE_CLASS:()=>Ye,MarkdownRenderer:()=>je,MessageFooterComponent:()=>ce,MessageFooterRegistry:()=>ht,MessageRenderer:()=>Re,MessageToolbar:()=>ke,MultiChatPanel:()=>Et,Navigation:()=>ze,ScrollContainer:()=>qe,SelectionWatcher:()=>ut,SendButton:()=>D,TooltippedButton:()=>x,TooltippedIconButton:()=>pe,WelcomeMessage:()=>Je,WritingUsersList:()=>Ke,buildChatSidebar:()=>bt,buildErrorWidget:()=>gt,chatIcon:()=>k,includeSelectionIcon:()=>j,readIcon:()=>I,replaceCellIcon:()=>S,useChatCommands:()=>X});var a=n(669),i=n(8762),s=n(4602);class o{constructor(e){var t,n;this._onMainAreaChanged=()=>{var e,t;const n=null!==(t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.isVisible)&&void 0!==t&&t;n!==this._notebookVisible&&(this._notebookVisible=n,this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available))},this._onActiveCellChanged=(e,t)=>{var n;this._activeCell!==t&&(null===(n=this._activeCell)||void 0===n||n.model.stateChanged.disconnect(this._cellStateChange),this._activeCell=t,null==t||t.ready.then(()=>{var e;null===(e=this._activeCell)||void 0===e||e.model.stateChanged.connect(this._cellStateChange),this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available)}))},this._cellStateChange=(e,t)=>{var n;if("executionCount"===t.name){const e=null===(n=this._activeCell)||void 0===n?void 0:n.model.sharedModel,t=this._activeCellError;let a=null;e&&"outputs"in e&&(a=e.outputs.find(e=>"error"===e.output_type)||null),t!==a&&(this._activeCellError=a,this._activeCellErrorChanged.emit(this._activeCellError))}},this._notebookVisible=!1,this._activeCell=null,this._available=!1,this._activeCellError=null,this._availabilityChanged=new s.Signal(this),this._activeCellErrorChanged=new s.Signal(this),this._notebookTracker=e.tracker,this._notebookTracker.activeCellChanged.connect(this._onActiveCellChanged),null===(t=e.shell.currentChanged)||void 0===t||t.connect(this._onMainAreaChanged),e.shell instanceof a.LabShell&&(null===(n=e.shell.layoutModified)||void 0===n||n.connect(this._onMainAreaChanged)),this._onMainAreaChanged()}get available(){return this._available}get activeCellError(){return this._activeCellError}get availabilityChanged(){return this._availabilityChanged}get activeCellErrorChanged(){return this._activeCellErrorChanged}getContent(e=!1){var t,n,a;const i=null===(t=this._notebookTracker.activeCell)||void 0===t?void 0:t.model.sharedModel,s="code"===(null==i?void 0:i.cell_type)?null===(a=null===(n=this._notebookTracker.currentWidget)||void 0===n?void 0:n.model)||void 0===a?void 0:a.defaultKernelLanguage:void 0;if(!i)return null;if(!e)return{type:i.cell_type,source:i.getSource(),language:s};const o=this._activeCellError;return o?{type:"code",source:i.getSource(),language:s,error:{name:o.ename,value:o.evalue,traceback:o.traceback}}:null}insertAbove(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(i.NotebookActions.insertAbove(t.content),this.replace(e))}insertBelow(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(i.NotebookActions.insertBelow(t.content),this.replace(e))}async replace(e){var t;const n=this._notebookTracker.currentWidget;if(!n||!n.isVisible)return;const a=this._notebookTracker.activeCell;a&&(await a.ready,null===(t=a.editor)||void 0===t||t.model.sharedModel.setSource(e))}}var l=n(9679),r=n(3345),c=n.n(r);function d(e){var t,n;const{user:a}=e,i={height:(e.small?"16":"24")+"px",width:(e.small?"16":"24")+"px",bgcolor:a.color,fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`},s=null!==(n=null!==(t=a.display_name)&&void 0!==t?t:a.name)&&void 0!==n?n:a.username||"User undefined";return a.avatar_url?c().createElement(l.Avatar,{sx:{...i},src:a.avatar_url,alt:s,title:s}):a.initials?c().createElement(l.Avatar,{sx:{...i},alt:s,title:s},c().createElement(l.Typography,{sx:{fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`,color:"var(--jp-ui-inverse-font-color1)"}},a.initials)):null}var h=n(709),u=n(4848);const m=(0,h.A)((0,u.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var g=n(5764),p=n(9071),v=n(4135);const f=(0,n(8413).A)("MuiBox",["root"]),_=(0,v.A)({defaultClassName:f.root,generateClassName:p.A.generate});var C=n(7262);const y=(0,h.A)((0,u.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown"),b=(0,h.A)((0,u.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),w=(0,l.styled)(({className:e,...t})=>c().createElement(l.Tooltip,{...t,arrow:!0,classes:{popper:e}}))(({theme:e})=>({[`& .${l.tooltipClasses.tooltip}`]:{backgroundColor:e.palette.common.black,color:e.palette.common.white,boxShadow:e.shadows[1],fontSize:11},[`& .${l.tooltipClasses.arrow}`]:{color:e.palette.common.black}})),E="jp-chat-tooltipped-wrap";function x(e){var t;return c().createElement(w,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},c().createElement("span",{style:{cursor:"default"},className:E},c().createElement(l.Button,{...e.buttonProps,onClick:e.onClick,disabled:e.disabled,sx:{lineHeight:0,...e.disabled&&{opacity:.5},...e.sx},"aria-label":e["aria-label"]},e.children)))}var M=n(9694);const k=new M.LabIcon({name:"jupyter-chat::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'}),I=new M.LabIcon({name:"jupyter-chat::read",svgstr:'<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3">\n    <path\n      style="display:inline;fill:none;fill-opacity:1;stroke:#616161;stroke-width:1.54693;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:1.5;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"\n      d="M 2.2734634,9 V 20.226537 H 21.726536 V 9"\n    />\n    <path\n      style="display:inline;fill:none;stroke:#616161;stroke-width:1.54528;stroke-linecap:square;stroke-miterlimit:10"\n      transform="matrix(0.81805878,0.57513462,-0.81805878,0.57513462,0,0)"\n      d="M 9.5141659,-5.1535239 H 20.802967 V 6.1352773 H 9.5141659 Z"\n    />\n  </g>\n</svg>\n'}),S=new M.LabIcon({name:"jupyter-ai::replace-cell",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M12 4.71429V7H1.71429V4.71429H12ZM12.5714 3C13.2026 3 13.7143 3.51168 13.7143 4.14286V7.57143C13.7143 8.20263 13.2026 8.71429 12.5714 8.71429H1.14286C0.51168 8.71429 0 8.20263 0 7.57143V4.14286C0 3.51168 0.511669 3 1.14286 3H12.5714Z"\n    fill="#616161"\n    class="jp-icon3"\n  />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M14 8.71429V11H3.71429V8.71429H14ZM14.5714 7C15.2026 7 15.7143 7.51168 15.7143 8.14286V11.5714C15.7143 12.2026 15.2026 12.7143 14.5714 12.7143H3.14286C2.51168 12.7143 2 12.2026 2 11.5714V8.14286C2 7.51168 2.51167 7 3.14286 7H14.5714Z"\n    fill="#616161"\n    class="jp-icon3"\n  />\n</svg>\n'}),j=new M.LabIcon({name:"jupyter-chat::include",svgstr:'<svg width="18" height="9" viewBox="0 0 18 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M-0.0018417 1.33824L0.837379 0.499023L1.35717 1.01871C1.35741 1.01862 1.35764 1.01853 1.35787 1.01845L3.411 3.07158H3.41049L4.83909 4.49987L3.41011 5.92872H3.41075L1.35769 7.98178C1.35749 7.98171 1.35729 7.98164 1.35709 7.98156L0.837023 8.50158L-0.00219727 7.66236L3.1547 4.49987L-0.0018417 1.33824ZM2.6821 8.07158H16.143C16.932 8.07158 17.5716 7.43201 17.5716 6.64301V2.35729C17.5716 1.56832 16.932 0.928721 16.143 0.928721H2.68236L4.82522 3.07158H15.4287V5.92872H4.82496L2.6821 8.07158ZM1.74238 4.50002L0.428719 5.81655V3.18349L1.74238 4.50002Z"\n        fill="#616161"\n        class="jp-icon3"\n    />\n</svg>\n'}),R="jp-chat-send-button",A="jp-chat-send-include-opener",N="jp-chat-send-include";function D(e){const{model:t,chatCommandRegistry:n}=e,{activeCellManager:a,selectionWatcher:i}=t,s=!a||!i,[o,d]=(0,r.useState)(null),[h,u]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),[p,v]=(0,r.useState)(""),f=(0,r.useCallback)(e=>{d(e),u(!0)},[]),_=(0,r.useCallback)(()=>{u(!1)},[]),[C,w]=(0,r.useState)(""),[E,M]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{var e;const n=()=>{const e=!!t.value.trim()||t.attachments.length;g(!e)};t.valueChanged.connect(n),null===(e=t.attachmentsChanged)||void 0===e||e.connect(n),n();const a=(e,t)=>{var n;v(null!==(n=t.sendWithShiftEnter)&&void 0!==n&&n?"Send message (SHIFT+ENTER)":"Send message (ENTER)")};return t.configChanged.connect(a),()=>{var e,i;t.valueChanged.disconnect(n),null===(e=t.attachmentsChanged)||void 0===e||e.disconnect(n),null===(i=t.configChanged)||void 0===i||i.disconnect(a)}},[t]),(0,r.useEffect)(()=>{const e=()=>{M(!((null==i?void 0:i.selection)||(null==a?void 0:a.available)));const e=(null==i?void 0:i.selection)?`${i.selection.numLines} line(s) selected`:(null==a?void 0:a.available)?"Code from 1 active cell":"No selection or active cell";w(e)};return s||(null==i||i.selectionChanged.connect(e),null==a||a.availabilityChanged.connect(e),e()),()=>{null==i||i.selectionChanged.disconnect(e),null==a||a.availabilityChanged.disconnect(e)}},[a,i]),c().createElement(c().Fragment,null,c().createElement(x,{onClick:async function(){await(null==n?void 0:n.onSubmit(t)),t.send(t.value)},disabled:m,tooltip:p,buttonProps:{size:"small",title:p,variant:"contained",className:R}},c().createElement(b,null)),!s&&c().createElement(c().Fragment,null,c().createElement(x,{onClick:e=>{f(e.currentTarget)},disabled:m,tooltip:"",buttonProps:{variant:"contained",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(f(e.currentTarget),e.stopPropagation())},className:A}},c().createElement(y,null)),c().createElement(l.Menu,{open:h,onClose:_,anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},sx:{"& .MuiMenuItem-root":{display:"flex",alignItems:"center",gap:"8px"},"& svg":{lineHeight:0}}},c().createElement(l.MenuItem,{onClick:e=>{!async function(){let e,s="";if(await(null==n?void 0:n.onSubmit(t)),null==i?void 0:i.selection)s=i.selection.text,e=i.selection.language;else if(null==a?void 0:a.available){const t=a.getContent(!1);s=t.source,e=null==t?void 0:t.language}let o=t.value;s&&(o+=`\n\n\`\`\`${null!=e?e:""}\n${s}\n\`\`\`\n`),t.send(o),_(),t.value=""}(),e.stopPropagation()},disabled:E,className:N},c().createElement(j.react,null),c().createElement(l.Box,null,c().createElement(l.Typography,{display:"block"},"Send message with selection"),c().createElement(l.Typography,{display:"block",sx:{opacity:.618}},C))))))}var T=n(8011);const W=(0,h.A)((0,u.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),L="jp-chat-attach-button";function B(e){const{model:t}=e,n="Add attachment";return t.documentManager&&t.addAttachment?c().createElement(x,{onClick:async()=>{if(t.documentManager&&t.addAttachment)try{const e=await T.FileDialog.getOpenFiles({title:"Select files to attach",manager:t.documentManager});e.value&&e.value.forEach(e=>{var n;"directory"!==e.type&&(null===(n=t.addAttachment)||void 0===n||n.call(t,{type:"file",value:e.path}))})}catch(e){console.warn("Error selecting files to attach",e)}},tooltip:n,buttonProps:{size:"small",variant:"contained",title:n,className:L}},c().createElement(W,null)):c().createElement(c().Fragment,null)}const P=(0,h.A)((0,u.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),V="jp-chat-cancel-button";function F(e){if(!e.model.cancel)return c().createElement(c().Fragment,null);const t="Cancel edition";return c().createElement(x,{onClick:e.model.cancel,tooltip:t,buttonProps:{size:"small",variant:"contained",title:t,className:V}},c().createElement(P,null))}class H{constructor(){this._items=new Map,this._itemsChanged=new s.Signal(this)}get itemsChanged(){return this._itemsChanged}get(e){return this._items.get(e)}getItems(){return Array.from(this._items.values()).filter(e=>!e.hidden).sort((e,t)=>e.position-t.position)}addItem(e,t){this._items.has(e)?console.warn(`A chat input toolbar item '${e}' is already registered`):(this._items.set(e,t),this._itemsChanged.emit())}hide(e){const t=this._items.get(e);t&&(t.hidden=!0,this._itemsChanged.emit())}show(e){const t=this._items.get(e);t&&(t.hidden=!1,this._itemsChanged.emit())}}!function(e){e.defaultToolbarRegistry=function(){const t=new e;return t.addItem("send",{element:D,position:100}),t.addItem("attach",{element:B,position:20}),t.addItem("cancel",{element:F,position:10}),t}}(H||(H={}));const O=new C.Token("@jupyter/chat:IInputToolbarRegistryFactory");var $=n(8919);const z=(0,h.A)((0,u.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var U=n(1297);const J=(0,r.createContext)(void 0),Z="jp-chat-attachments",G="jp-chat-attachment",K="jp-chat-attachment-clickable",q="jp-chat-attachment-remove";function Y(e){return c().createElement(l.Box,{className:Z},e.attachments.map(t=>c().createElement(Q,{key:`${U.PathExt.basename(t.value)}-${C.UUID.uuid4()}`,...e,attachment:t})))}function Q(e){const t="Remove attachment",n=(0,r.useContext)(J);return c().createElement(l.Box,{className:G},c().createElement("span",{className:(null==n?void 0:n.get(e.attachment.type))?K:"",onClick:()=>{var t;return null===(t=null==n?void 0:n.get(e.attachment.type))||void 0===t?void 0:t(e.attachment)}},function(e){var t;if("notebook"===e.type){const n=U.PathExt.basename(e.value)||"Unknown notebook";return 1===(null===(t=e.cells)||void 0===t?void 0:t.length)?`${n}: ${e.cells[0].input_type} cell`:e.cells&&e.cells.length>1?`${n}: ${e.cells.length} cells`:n}return"file"===e.type?U.PathExt.basename(e.value)||"Unknown file":e.value||"Unknown attachment"}(e.attachment)),e.onRemove&&c().createElement(x,{onClick:()=>e.onRemove(e.attachment),tooltip:t,buttonProps:{size:"small",title:t,className:q},sx:{minWidth:"unset",padding:"0",color:"inherit"}},c().createElement(z,null)))}function X(e,t){const[n,a]=(0,r.useState)(!1),[i,s]=(0,r.useState)(!1),[o,d]=(0,r.useState)([]);return(0,r.useEffect)(()=>{async function n(n,i){const o=null==t?void 0:t.getProviders();if(!o)return;if(!(null==i?void 0:i.length))return d([]),s(!1),void a(!1);let l=[];for(const t of o)try{l=l.concat(await t.listCommandCompletions(e))}catch(e){console.error(`Error when getting chat commands from command provider '${t.id}': `,e)}if(1===l.length&&l[0].name===e.currentWord&&void 0!==l[0].replaceWith){const t=l[0].replaceWith;return void e.replaceCurrentWord(t)}l.length?s(!0):(s(!1),a(!1)),d(l)}return e.currentWordChanged.connect(n),()=>{e.currentWordChanged.disconnect(n)}},[e]),{autocompleteProps:{open:i,options:o,getOptionLabel:e=>"string"==typeof e?"":e.name,renderOption:(e,t,n,a)=>{const{key:i,...s}=e,o=c().isValidElement(t.icon)?t.icon:c().createElement("span",null,t.icon instanceof M.LabIcon?c().createElement(t.icon.react,null):t.icon);return c().createElement(l.Box,{key:i,component:"li",...s},o,c().createElement("p",{className:"jp-chat-command-name"},t.name),t.description&&c().createElement(c().Fragment,null,c().createElement("span",null," - "),c().createElement("p",{className:"jp-chat-command-description"},t.description)))},filterOptions:e=>e,value:null,autoHighlight:!0,freeSolo:!0,disableClearable:!0,onChange:(n,a,i)=>{if("selectOption"!==i)return;if(!t)return;if(!e.currentWord)return;let s=void 0===a.replaceWith?a.name:a.replaceWith;a.spaceOnAccept&&(s+=" "),e.replaceCurrentWord(s)},onHighlightChange:(e,t)=>{a(!!t)},onClose:()=>{a(!1),s(!1)}},menu:{open:i,highlighted:n}}}const ee="jp-chat-input-container",te="jp-chat-input-textfield",ne="jp-chat-input-component",ae="jp-chat-input-toolbar";function ie(e){var t;const{model:n,toolbarRegistry:a}=e,[i,s]=(0,r.useState)(n.value),o=(0,r.useRef)(),d=X(n,e.chatCommandRegistry),[h,u]=(0,r.useState)(null!==(t=n.config.sendWithShiftEnter)&&void 0!==t&&t),[m,g]=(0,r.useState)(n.attachments),[p,v]=(0,r.useState)([]);(0,r.useEffect)(()=>{var e,t;n.valueChanged.connect((e,t)=>{s(t)});const a=(e,t)=>{var n;u(null!==(n=t.sendWithShiftEnter)&&void 0!==n&&n)};n.configChanged.connect(a);const i=()=>{o.current&&o.current.focus()};null===(e=n.focusInputSignal)||void 0===e||e.connect(i);const l=(e,t)=>{g([...t])};return null===(t=n.attachmentsChanged)||void 0===t||t.connect(l),()=>{var e,t,s;null===(e=n.configChanged)||void 0===e||e.disconnect(a),null===(t=n.focusInputSignal)||void 0===t||t.disconnect(i),null===(s=n.attachmentsChanged)||void 0===s||s.disconnect(l)}},[n]),(0,r.useEffect)(()=>{const e=()=>{v(a.getItems())};return a.itemsChanged.connect(e),e(),()=>{a.itemsChanged.disconnect(e)}},[a]);const f=!!i.trim();async function _(t){var a;if(!["ArrowDown","ArrowUp"].includes(t.key)||d.menu.open){if("Enter"===t.key&&!d.menu.highlighted){if(t.stopPropagation(),!f)return t.stopPropagation(),void t.preventDefault();(h&&t.shiftKey||!h&&!t.shiftKey)&&(await(null===(a=e.chatCommandRegistry)||void 0===a?void 0:a.onSubmit(n)),n.send(n.value),t.stopPropagation(),t.preventDefault())}}else t.stopPropagation()}const C=h?c().createElement("span",null,"Press ",c().createElement("b",null,"Shift"),"+",c().createElement("b",null,"Enter")," to send message"):c().createElement("span",null,"Press ",c().createElement("b",null,"Shift"),"+",c().createElement("b",null,"Enter")," to add a new line");return c().createElement(l.Box,{sx:e.sx,className:(0,$.A)(ee)},c().createElement(Y,{attachments:m,onRemove:n.removeAttachment}),c().createElement(l.Autocomplete,{...d.autocompleteProps,slotProps:{popper:{placement:"top"},paper:{sx:{border:"1px solid lightgray"}},listbox:{sx:{"& .MuiAutocomplete-option":{padding:2}}}},renderInput:e=>c().createElement(l.TextField,{...e,fullWidth:!0,variant:"filled",className:te,multiline:!0,onKeyDown:_,placeholder:"Start chatting",inputRef:o,sx:{marginTop:"1px"},onSelect:()=>{var e,t;return n.cursorIndex=null!==(t=null===(e=o.current)||void 0===e?void 0:e.selectionStart)&&void 0!==t?t:null},slotProps:{input:{...e.InputProps,className:ne}},label:i.length>2?C:" "}),inputValue:i,onInputChange:(e,t,a)=>{"reset"!==a&&(n.value=t)}}),c().createElement(l.Toolbar,{className:ae},p.map(t=>c().createElement(t.element,{model:n,chatCommandRegistry:e.chatCommandRegistry}))))}var se=n(710),oe=n(2515);function le(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function re(e){const[t,n]=(0,r.useState)((0,se.A)());return(0,r.useEffect)(()=>{var t;async function a(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise(e=>setTimeout(e,100))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,se.A)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:le("--jp-layout-color1"),default:le("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:le("--jp-brand-color1"),light:le("--jp-brand-color2"),dark:le("--jp-brand-color0")},error:{main:le("--jp-error-color1"),light:le("--jp-error-color2"),dark:le("--jp-error-color0")},warning:{main:le("--jp-warn-color1"),light:le("--jp-warn-color2"),dark:le("--jp-warn-color0")},success:{main:le("--jp-success-color1"),light:le("--jp-success-color2"),dark:le("--jp-success-color0")},text:{primary:le("--jp-ui-font-color1"),secondary:le("--jp-ui-font-color2"),disabled:le("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:le("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}a(),null===(t=e.themeManager)||void 0===t||t.themeChanged.connect(a)},[]),c().createElement(oe.A,{theme:t},e.children)}function ce(e){var t,n,a;const{message:i,model:s,registry:o}=e,r=o.getFooter();return c().createElement(l.Box,{sx:{display:"flex",justifyContent:"space-between"}},(null===(t=r.left)||void 0===t?void 0:t.component)?c().createElement(r.left.component,{message:i,model:s}):c().createElement("div",null),(null===(n=r.center)||void 0===n?void 0:n.component)?c().createElement(r.center.component,{message:i,model:s}):c().createElement("div",null),(null===(a=r.right)||void 0===a?void 0:a.component)?c().createElement(r.right.component,{message:i,model:s}):c().createElement("div",null))}const de="jp-chat-message-header",he="jp-chat-message-time";function ue(e){var t,n;const[a,i]=(0,r.useState)({}),s=e.message,o=s.sender;(0,r.useEffect)(()=>{if(!a[s.time]){const e={};let t;const n=new Date,a=e=>e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate(),o=new Date(1e3*s.time);t=a(o)?o.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):o.toLocaleString([],{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),e[s.time]=t,i(e)}});const h=s.stacked?null:d({user:o}),u=null!==(n=null!==(t=o.display_name)&&void 0!==t?t:o.name)&&void 0!==n?n:o.username||"User undefined";return c().createElement(l.Box,{className:de,sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},marginBottom:s.stacked?"0px":"12px"}},h,c().createElement(l.Box,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},c().createElement(l.Box,{sx:{display:"flex",alignItems:"center"}},!s.stacked&&c().createElement(l.Typography,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)",paddingRight:"0.5em"}},u),(s.deleted||s.edited)&&c().createElement(l.Typography,{sx:{fontStyle:"italic",fontSize:"var(--jp-content-font-size0)"}},s.deleted?"(message deleted)":"(edited)")),c().createElement(l.Typography,{className:he,sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300},title:s.raw_time?"Unverified time":""},`${a[s.time]}${s.raw_time?"*":""}`)))}var me=n(7628);const ge="jp-chat-tooltipped-wrap";function pe(e){var t;return c().createElement(w,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},c().createElement("span",{className:(0,M.classes)(e.className,ge)},c().createElement(l.IconButton,{...e.iconButtonProps,onClick:e.onClick,disabled:e.disabled,sx:{marginLeft:"8px",lineHeight:0,...e.disabled&&{opacity:.5}},"aria-label":e["aria-label"]},e.children)))}var ve;!function(e){e[e.None=0]="None",e[e.Copying=1]="Copying",e[e.Copied=2]="Copied",e[e.Disabled=3]="Disabled"}(ve||(ve={}));const fe={[ve.None]:"Copy to clipboard",[ve.Copying]:"Copyingâ€¦",[ve.Copied]:"Copied!",[ve.Disabled]:"Copy to clipboard disabled in insecure context"};function _e(e){const t=void 0===navigator.clipboard,[n,a]=(0,r.useState)(t?ve.Disabled:ve.None),i=(0,r.useRef)(null),s=(0,r.useCallback)(async()=>{if(n!==ve.Copying){try{await navigator.clipboard.writeText(e.value)}catch(e){return console.error("Failed to copy text: ",e),void a(ve.None)}a(ve.Copied),i.current&&clearTimeout(i.current),i.current=window.setTimeout(()=>a(ve.None),1e3)}},[n,e.value]);return c().createElement(pe,{disabled:t,className:e.className,tooltip:fe[n],placement:"top",onClick:s,"aria-label":"Copy to clipboard"},c().createElement(M.copyIcon.react,{height:"16px",width:"16px"}))}const Ce="jp-chat-code-toolbar",ye="jp-chat-code-toolbar-item";function be(e){var t;const{content:n,model:a}=e,[i,s]=(0,r.useState)(null===(t=a.config.enableCodeToolbar)||void 0===t||t),o=a.activeCellManager,d=a.selectionWatcher,[h,u]=(0,r.useState)({content:n,activeCellManager:o,selectionWatcher:d,activeCellAvailable:!!(null==o?void 0:o.available),selectionExists:!!(null==d?void 0:d.selection)});return(0,r.useEffect)(()=>{const e=()=>{var e;s(null===(e=a.config.enableCodeToolbar)||void 0===e||e)},t=()=>{u({content:n,activeCellManager:o,selectionWatcher:d,activeCellAvailable:!!(null==o?void 0:o.available),selectionExists:!!(null==d?void 0:d.selection)})};return null==o||o.availabilityChanged.connect(t),null==d||d.selectionChanged.connect(t),a.configChanged.connect(e),t(),()=>{null==o||o.availabilityChanged.disconnect(t),null==d||d.selectionChanged.disconnect(t),a.configChanged.disconnect(e)}},[a]),null!==o&&i?c().createElement(l.Box,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",padding:"2px 2px",marginBottom:"1em",border:"1px solid var(--jp-cell-editor-border-color)",borderTop:"none"},className:Ce},c().createElement(we,{...h,className:ye}),c().createElement(Ee,{...h,className:ye}),c().createElement(xe,{...h,className:ye}),c().createElement(_e,{value:n,className:ye})):c().createElement(c().Fragment,null)}function we(e){const t=e.activeCellAvailable?"Insert above active cell":"Insert above active cell (no active cell)";return c().createElement(pe,{className:e.className,tooltip:t,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertAbove(e.content)},disabled:!e.activeCellAvailable},c().createElement(M.addAboveIcon.react,{height:"16px",width:"16px"}))}function Ee(e){const t=e.activeCellAvailable?"Insert below active cell":"Insert below active cell (no active cell)";return c().createElement(pe,{className:e.className,tooltip:t,disabled:!e.activeCellAvailable,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertBelow(e.content)}},c().createElement(M.addBelowIcon.react,{height:"16px",width:"16px"}))}function xe(e){var t,n;const a=e.selectionExists?`Replace selection (${null===(n=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.numLines} line(s))`:e.activeCellAvailable?"Replace selection (active cell)":"Replace selection (no selection)",i=!e.activeCellAvailable&&!e.selectionExists;return c().createElement(pe,{className:e.className,tooltip:a,disabled:i,onClick:()=>{var t,n,a;if(e.selectionExists){const a=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection;if(!a)return;null===(n=e.selectionWatcher)||void 0===n||n.replaceSelection({...a,text:e.content})}else e.activeCellAvailable&&(null===(a=e.activeCellManager)||void 0===a||a.replace(e.content))}},c().createElement(S.react,{height:"16px",width:"16px"}))}const Me="jp-chat-toolbar";function ke(e){const t=[];if(void 0!==e.edit){const n=(0,M.ToolbarButtonComponent)({icon:M.editIcon,onClick:e.edit,tooltip:"Edit"});t.push(n)}if(void 0!==e.delete){const n=(0,M.ToolbarButtonComponent)({icon:M.deleteIcon,onClick:e.delete,tooltip:"Delete"});t.push(n)}return c().createElement("div",{className:Me},t.map(e=>e))}const Ie="jp-chat-rendered-markdown",Se="text/markdown";var je;!function(e){function t(e){return e.replace(/\\\(/g,"\\\\(").replace(/\\\)/g,"\\\\)").replace(/\\\[/g,"\\\\[").replace(/\\\]/g,"\\\\]")}e.renderContent=async function(e){var n;const{rmRegistry:a,content:i}=e,s=t(i),o=a.createModel({data:{[Se]:s}}),l=a.createRenderer(Se);if(await l.renderModel(o),!l.node)throw new Error("Rendermime was unable to render Markdown content within a chat message. Please report this upstream to Jupyter chat on GitHub.");return null===(n=a.latexTypesetter)||void 0===n||n.typeset(l.node),l},e.escapeLatexDelimiters=t}(je||(je={}));const Re=c().memo(function(e){const{markdownStr:t,rmRegistry:n}=e,a=e.appendContent||!1,[i,s]=(0,r.useState)(null),[o,l]=(0,r.useState)([]);return(0,r.useEffect)(()=>{(async()=>{const a=await je.renderContent({content:t,rmRegistry:n}),i=[];a.node.querySelectorAll("pre").forEach(t=>{var n;const a=document.createElement("div");null===(n=t.parentNode)||void 0===n||n.insertBefore(a,t.nextSibling),i.push([a,{model:e.model,content:t.textContent||""}])}),l(i),s(a.node),e.rendered.resolve()})()},[t,n]),c().createElement("div",{className:Ie},i&&(a?c().createElement("div",{ref:e=>e&&e.appendChild(i)}):c().createElement("div",{ref:e=>e&&e.replaceChildren(i)})),c().createElement(ke,{edit:e.edit,delete:e.delete}),o.map(e=>{const[t,n]=e;return(0,me.createPortal)(c().createElement(be,{...n}),t)}))});class Ae{constructor(e){var t,n,a;this.send=e=>{this._onSend(e,this),this.value=""},this.addAttachment=e=>{const t=JSON.stringify(e);if(!this._attachments.find(e=>JSON.stringify(e)===t)){if("notebook"===e.type&&e.cells){const t=this._attachments.findIndex(t=>"notebook"===t.type&&t.value===e.value);if(-1!==t){const n=this._attachments[t],a=n.cells||[],i=e.cells.filter(e=>!a.some(t=>t.id===e.id));if(!i.length)return;return this._attachments[t]={...n,cells:[...a,...i]},void this._attachmentsChanged.emit([...this._attachments])}}this._attachments.push(e),this._attachmentsChanged.emit([...this._attachments])}},this.removeAttachment=e=>{const t=JSON.stringify(e),n=this._attachments.findIndex(e=>JSON.stringify(e)===t);-1!==n&&(this._attachments.splice(n,1),this._attachmentsChanged.emit([...this._attachments]))},this.clearAttachments=()=>{this._attachments=[],this._attachmentsChanged.emit([])},this.clearMentions=()=>{this._mentions=[]},this._cursorIndex=null,this._currentWord=null,this._valueChanged=new s.Signal(this),this._cursorIndexChanged=new s.Signal(this),this._currentWordChanged=new s.Signal(this),this._configChanged=new s.Signal(this),this._focusInputSignal=new s.Signal(this),this._attachmentsChanged=new s.Signal(this),this._onDisposed=new s.Signal(this),this._isDisposed=!1,this._onSend=e.onSend,this._chatContext=e.chatContext,this._value=e.value||"",this._attachments=e.attachments||[],this._mentions=e.mentions||[],this.cursorIndex=e.cursorIndex||this.value.length,this._activeCellManager=null!==(t=e.activeCellManager)&&void 0!==t?t:null,this._selectionWatcher=null!==(n=e.selectionWatcher)&&void 0!==n?n:null,this._documentManager=null!==(a=e.documentManager)&&void 0!==a?a:null,this._config={...e.config},this.cancel=e.onCancel}get chatContext(){return this._chatContext}set chatContext(e){this._chatContext=e}get value(){return this._value}set value(e){this._value=e,this._valueChanged.emit(e)}get valueChanged(){return this._valueChanged}get cursorIndex(){return this._cursorIndex}set cursorIndex(e){if(null===e||e>this._value.length)return;if(this._cursorIndex=e,this._cursorIndexChanged.emit(e),null===this._cursorIndex)return;const t=Ne.getCurrentWord(this._value,this._cursorIndex);t!==this._currentWord&&(this._currentWord=t,this._currentWordChanged.emit(this._currentWord))}get cursorIndexChanged(){return this._cursorIndexChanged}get currentWord(){return this._currentWord}get currentWordChanged(){return this._currentWordChanged}get activeCellManager(){return this._activeCellManager}get selectionWatcher(){return this._selectionWatcher}get documentManager(){return this._documentManager}get config(){return this._config}set config(e){this._config={...this._config,...e},this._configChanged.emit(this._config)}get configChanged(){return this._configChanged}focus(){this._focusInputSignal.emit()}get focusInputSignal(){return this._focusInputSignal}get attachments(){return this._attachments}get attachmentsChanged(){return this._attachmentsChanged}replaceCurrentWord(e){if(null===this.cursorIndex)return;const[t,n]=Ne.getCurrentWordBoundaries(this.value,this.cursorIndex);this.value=this.value.slice(0,t)+e+this.value.slice(n)}get mentions(){return this._mentions}addMention(e){const t=this._mentions.map(e=>e.username);t.includes(e.username)||this._mentions.push(e)}removeMention(e){const t=this._mentions.indexOf(e);t>-1&&this._mentions.splice(t,1)}dispose(){this.isDisposed||(this._onDisposed.emit(),this._isDisposed=!0)}get onDisposed(){return this._onDisposed}get isDisposed(){return this._isDisposed}}var Ne;!function(e){const t=new Set([" ","\n","\t"]);function n(e,n){let a=n,i=n;const s=e.length;for(;a-1>=0&&!t.has(e[a-1])||a-2>=0&&"\\"===e[a-2]&&t.has(e[a-1]);)a--;for(;i<s&&!t.has(e[i])||i<s&&i-1>=0&&"\\"===e[i-1]&&t.has(e[i]);)i++;return[a,i]}e.getCurrentWordBoundaries=n,e.getCurrentWord=function(e,t){const[a,i]=n(e,t);return e.slice(a,i)}}(Ne||(Ne={}));var De=n(4337),Te=n(1561),We=n(6544);const Le="jp-chat-mention";function Be(e){var t;if(!(e instanceof Te.DocumentWidget))return null;let n;const{content:a}=e;return a instanceof We.FileEditor?n=a.editor:a instanceof i.Notebook&&(n=null===(t=a.activeCell)||void 0===t?void 0:t.editor),n instanceof De.CodeMirrorEditor?n:void 0}const Pe=(0,r.forwardRef)((e,t)=>{const{message:n,model:a,rmRegistry:i}=e,[s,o]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),[h,u]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{var e;if(d(null!==(e=n.deleted)&&void 0!==e&&e),void 0===a.user||n.deleted)u(!1),g(!1);else{if(a.user.username===n.sender.username)return u(void 0!==a.updateMessage),void g(void 0!==a.deleteMessage);n.sender.bot&&g(void 0!==a.deleteMessage)}},[a,n]);const p=()=>{var e;null===(e=a.getEditionModel(n.id))||void 0===e||e.dispose(),o(!1)},v=(e,t,i)=>{var s;if(!h||!i)return;const l={...n};l.body=t,l.attachments=i.attachments,l.mentions=i.mentions,a.updateMessage(e,l),null===(s=a.getEditionModel(n.id))||void 0===s||s.dispose(),o(!1)};return l?c().createElement("div",{ref:t,"data-index":e.index}):c().createElement("div",{ref:t,"data-index":e.index},s&&h&&a.getEditionModel(n.id)?c().createElement(ie,{onCancel:()=>p(),model:a.getEditionModel(n.id),chatCommandRegistry:e.chatCommandRegistry,toolbarRegistry:e.inputToolbarRegistry}):c().createElement(Re,{rmRegistry:i,markdownStr:n.body,model:a,edit:h?()=>{var e;if(!h)return;let t=n.body;null===(e=n.mentions)||void 0===e||e.forEach(e=>{t=function(e,t){if(!t.mention_name)return e;const n="@"+t.mention_name,a=new RegExp(`<span class="${Le}">${n}</span>`,"g");return e.replace(a,n)}(t,e)});const i=new Ae({chatContext:a.createChatContext(),onSend:(e,t)=>v(n.id,e,t),onCancel:()=>p(),value:t,activeCellManager:a.activeCellManager,selectionWatcher:a.selectionWatcher,documentManager:a.documentManager,config:{sendWithShiftEnter:a.config.sendWithShiftEnter},attachments:n.attachments,mentions:n.mentions});a.addEditionModel(n.id,i),o(!0)}:void 0,delete:m?()=>{return e=n.id,void(m&&a.deleteMessage(e));var e}:void 0,rendered:e.renderedPromise}),n.attachments&&!s&&c().createElement(Y,{attachments:n.attachments}))});var Ve=n(180);const Fe="jp-chat-navigation",He="jp-chat-navigation-unread",Oe="jp-chat-navigation-top",$e="jp-chat-navigation-bottom";function ze(e){const{model:t}=e,[n,a]=(0,r.useState)(!0),[i,s]=(0,r.useState)(null),[o,l]=(0,r.useState)(null),d=(t,n=!0)=>{var a,i;null===(i=null===(a=e.refMsgBox.current)||void 0===a?void 0:a.children.item(t))||void 0===i||i.scrollIntoView(n)};return(0,r.useEffect)(()=>{var n;if(!e.allRendered)return;const a=(e,t)=>{const n=e.messagesInViewport;if(!n)return;let a=null!==i&&t.includes(i)&&i<Math.min(...n)?i:null,r=null!==o&&t.includes(o)&&o>Math.max(...n)?o:null;t.forEach(t=>{(null==n?void 0:n.includes(t))||(t<(null!=a?a:Math.min(...n))?a=t:t>Math.max(...n)&&t<(null!=r?r:e.messages.length)&&(r=t))}),s(a),l(r)};return null===(n=t.unreadChanged)||void 0===n||n.connect(a),a(t,t.unreadMessages),d(t.messages.length-1,!1),()=>{var e;null===(e=t.unreadChanged)||void 0===e||e.disconnect(a)}},[t,e.allRendered]),(0,r.useEffect)(()=>{var e,n;const i=(e,t)=>{a(0===e.messages.length||t.includes(e.messages.length-1))};return null===(e=t.viewportChanged)||void 0===e||e.connect(i),i(t,null!==(n=t.messagesInViewport)&&void 0!==n?n:[]),()=>{var e;null===(e=t.viewportChanged)||void 0===e||e.disconnect(i)}},[t]),c().createElement(c().Fragment,null,null!==i&&c().createElement(Ve.Button,{className:`${Fe} ${He} ${Oe}`,onClick:()=>d(i),title:"Go to unread messages"},c().createElement(M.LabIcon.resolveReact,{display:"flex",icon:M.caretDownEmptyIcon,iconClass:(0,M.classes)("jp-Icon")})),(null!==o||!n)&&c().createElement(Ve.Button,{className:`${Fe} ${null!==o?He:""} ${$e}`,onClick:null===o?()=>d(t.messages.length-1,!1):()=>d(o),title:null!==o?"Go to unread messages":"Go to last message"},c().createElement(M.LabIcon.resolveReact,{display:"flex",icon:M.caretDownEmptyIcon,iconClass:(0,M.classes)("jp-Icon")})))}const Ue="jp-chat-welcome-message";function Je(e){const{rmRegistry:t}=e,n=e.content+"\n----\n",a=(0,r.useRef)(null),i=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{(async()=>{const e=await je.renderContent({content:n,rmRegistry:t});null===a.current||i.current||(a.current.appendChild(e.node),i.current=!0)})()},[n]),c().createElement("div",{className:(0,M.classes)(Ie,Ue)},c().createElement("div",{ref:a}))}const Ze="jp-chat-writers",Ge=()=>c().createElement(l.Box,{className:"jp-chat-typing-indicator"},c().createElement("span",{className:"jp-chat-typing-dot"}),c().createElement("span",{className:"jp-chat-typing-dot"}),c().createElement("span",{className:"jp-chat-typing-dot"}));function Ke(e){const{writers:t}=e;if(0===t.length)return null;const n=t.length>1?" are writing":" is writing",a=(0,r.useMemo)(()=>t.map((e,n)=>{var a,i;return c().createElement(l.Box,{key:e.username||n,className:"jp-chat-writer-item"},c().createElement(d,{user:e,small:!0}),c().createElement(l.Typography,{variant:"body2",className:"jp-chat-writer-name"},null!==(i=null!==(a=e.display_name)&&void 0!==a?a:e.name)&&void 0!==i?i:e.username||"User undefined"),n<t.length-1&&c().createElement(l.Typography,{variant:"body2",className:"jp-chat-writer-separator"},n<t.length-2?", ":" and "))}),[t]);return c().createElement(l.Box,{className:`${Ze}`},c().createElement(l.Box,{className:"jp-chat-writers-content"},a,c().createElement(l.Box,{className:"jp-chat-writing-status"},c().createElement(l.Typography,{variant:"body2",className:"jp-chat-writing-text"},n),c().createElement(Ge,null))))}function qe(e){const t=(0,r.useMemo)(()=>"jupyter-chat-scroll-container-"+Date.now().toString(),[]);return c().createElement(l.Box,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},c().createElement(l.Box,null,e.children),c().createElement(l.Box,{sx:{overflowAnchor:"auto",height:"1px"}}))}const Ye="jp-chat-message",Qe="jp-chat-messages-container",Xe="jp-chat-message-stacked";function et(e){const{model:t}=e,[n,a]=(0,r.useState)(t.messages),i=(0,r.useRef)(null),[s,o]=(0,r.useState)([]),[d,h]=(0,r.useState)(!1),u=(0,r.useRef)([]),m=(0,r.useRef)([]);return(0,r.useEffect)(()=>{!async function(){t.getHistory&&t.getHistory().then(e=>a(e.messages)).catch(e=>console.error(e))}(),o([])},[t]),(0,r.useEffect)(()=>{var e;function n(){a([...t.messages])}return t.messagesUpdated.connect(n),null===(e=t.writersChanged)||void 0===e||e.connect(function(e,t){o(t.map(e=>e.user))}),function(){var e;t.messagesUpdated.disconnect(n),null===(e=t.writersChanged)||void 0===e||e.disconnect(n)}},[t]),(0,r.useEffect)(()=>{const n=new IntersectionObserver(n=>{var a;d||Promise.all(m.current.map(e=>e.promise)).then(()=>{h(!0)});const i=[...t.unreadMessages];let s=!1;const o=[...null!==(a=t.messagesInViewport)&&void 0!==a?a:[]];n.forEach(e=>{var t;const n=parseInt(null!==(t=e.target.getAttribute("data-index"))&&void 0!==t?t:"");if(!isNaN(n)){const t=o.indexOf(n);if(e.isIntersecting||-1===t?e.isIntersecting&&-1===t&&o.push(n):o.splice(t,1),i.length){const t=i.indexOf(n);-1!==t&&e.isIntersecting&&(i.splice(t,1),s=!0)}}}),e.model.messagesInViewport=o,d&&s&&(t.unreadMessages=i)});return u.current.forEach(e=>{e&&n.observe(e)}),()=>{u.current.forEach(e=>{e&&n.unobserve(e)})}},[n,d]),c().createElement(c().Fragment,null,c().createElement(qe,{sx:{flexGrow:1}},e.welcomeMessage&&c().createElement(Je,{rmRegistry:e.rmRegistry,content:e.welcomeMessage}),c().createElement(l.Box,{ref:i,className:(0,$.A)(Qe)},n.map((n,a)=>(m.current[a]=new C.PromiseDelegate,c().createElement(l.Box,{key:a,className:(0,$.A)(Ye,n.stacked?Xe:"")},c().createElement(ue,{message:n}),c().createElement(Pe,{...e,message:n,index:a,renderedPromise:m.current[a],ref:e=>u.current[a]=e}),e.messageFooterRegistry&&c().createElement(ce,{registry:e.messageFooterRegistry,message:n,model:t})))))),c().createElement(Ke,{writers:s}),c().createElement(ze,{...e,refMsgBox:i,allRendered:d}))}function tt(e){const{model:t}=e;let{inputToolbarRegistry:n}=e;return n||(n=H.defaultToolbarRegistry()),c().createElement(J.Provider,{value:e.attachmentOpenerRegistry},c().createElement(et,{rmRegistry:e.rmRegistry,model:t,chatCommandRegistry:e.chatCommandRegistry,inputToolbarRegistry:n,messageFooterRegistry:e.messageFooterRegistry,welcomeMessage:e.welcomeMessage}),c().createElement(ie,{sx:{paddingLeft:4,paddingRight:4,paddingTop:0,paddingBottom:0,borderTop:"1px solid var(--jp-border-color1)"},model:t.input,chatCommandRegistry:e.chatCommandRegistry,toolbarRegistry:n}))}function nt(e){var t;const[n,a]=(0,r.useState)(e.chatView||nt.View.chat);return c().createElement(re,{themeManager:null!==(t=e.themeManager)&&void 0!==t?t:null},c().createElement(_,{className:"jp-ThemedContainer",sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},c().createElement(_,{sx:{display:"flex",justifyContent:"space-between"}},n!==nt.View.chat?c().createElement(l.IconButton,{onClick:()=>a(nt.View.chat)},c().createElement(m,null)):c().createElement(_,null),n!==nt.View.settings&&e.settingsPanel?c().createElement(l.IconButton,{onClick:()=>a(nt.View.settings)},c().createElement(g.A,null)):c().createElement(_,null)),n===nt.View.chat&&c().createElement(tt,{...e}),n===nt.View.settings&&e.settingsPanel&&c().createElement(e.settingsPanel,null)))}!function(e){let t;!function(e){e[e.chat=0]="chat",e[e.settings=1]="settings"}(t=e.View||(e.View={}))}(nt||(nt={}));var at=n(4053);class it{constructor(e={}){var t,n,a,i;this._messages=[],this._unreadMessages=[],this._messagesInViewport=[],this._name="",this._readyDelegate=new C.PromiseDelegate,this._disposed=new s.Signal(this),this._isDisposed=!1,this._notificationId=null,this._writers=[],this._messageEditions=new Map,this._messagesUpdated=new s.Signal(this),this._configChanged=new s.Signal(this),this._unreadChanged=new s.Signal(this),this._viewportChanged=new s.Signal(this),this._writersChanged=new s.Signal(this),this._messageEditionAdded=new s.Signal(this),e.id&&(this.id=e.id);const o=null!==(t=e.config)&&void 0!==t?t:{};this._config={stackMessages:!0,sendTypingNotification:!0,...o},this._inputModel=new Ae({activeCellManager:e.activeCellManager,selectionWatcher:e.selectionWatcher,documentManager:e.documentManager,config:{sendWithShiftEnter:o.sendWithShiftEnter},onSend:e=>this.sendMessage({body:e})}),this._commands=e.commands,this._activeCellManager=null!==(n=e.activeCellManager)&&void 0!==n?n:null,this._selectionWatcher=null!==(a=e.selectionWatcher)&&void 0!==a?a:null,this._documentManager=null!==(i=e.documentManager)&&void 0!==i?i:null,this._readyDelegate=new C.PromiseDelegate,this.ready.then(()=>{this._inputModel.chatContext=this.createChatContext()})}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get disposed(){return this._disposed}get messages(){return this._messages}get input(){return this._inputModel}get writers(){return this._writers}get activeCellManager(){return this._activeCellManager}get selectionWatcher(){return this._selectionWatcher}get documentManager(){return this._documentManager}get lastRead(){var e;return void 0===this._id?0:null!==(e=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}").lastRead)&&void 0!==e?e:0}set lastRead(e){if(void 0===this._id)return;const t=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}");t.lastRead=e,localStorage.setItem(`@jupyter/chat:${this._id}`,JSON.stringify(t))}get ready(){return this._readyDelegate.promise}setReady(){this._readyDelegate.resolve()}get config(){return this._config}set config(e){const t="stackMessages"in e&&this._config.stackMessages!==e.stackMessages,n="unreadNotifications"in e&&this._config.unreadNotifications!==e.unreadNotifications;this._config={...this._config,...e},this._configChanged.emit(this._config),this.input.config=e,t&&(this._config.stackMessages?this._messages.slice(1).forEach((e,t)=>{const n=this._messages[t].sender.username;e.stacked=n===e.sender.username}):this._messages.forEach(e=>{delete e.stacked}),this._messagesUpdated.emit()),n&&!this._config.unreadNotifications&&this._notify(0)}get unreadMessages(){return this._unreadMessages}set unreadMessages(e){var t;const n=this._unreadMessages.filter(t=>!e.includes(t)),a=e.length-this._unreadMessages.length;if(this._unreadMessages=e,this._unreadChanged.emit(this._unreadMessages),this._notify(e.length,a>0),void 0!==this._id&&n.length){let e=!1,a=null!==(t=this.lastRead)&&void 0!==t?t:this.messages[n[0]].time;n.forEach(t=>{this.messages[t].time>a&&(a=this.messages[t].time,e=!0)}),e&&(this.lastRead=a)}}get messagesInViewport(){return this._messagesInViewport}set messagesInViewport(e){this._messagesInViewport=e,this._viewportChanged.emit(e)}get messagesUpdated(){return this._messagesUpdated}get configChanged(){return this._configChanged}get unreadChanged(){return this._unreadChanged}get viewportChanged(){return this._viewportChanged}get writersChanged(){return this._writersChanged}get messageEditionAdded(){return this._messageEditionAdded}clearMessages(){this._messages=[],this._messagesUpdated.emit()}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit())}get isDisposed(){return this._isDisposed}formatChatMessage(e){var t;return null===(t=e.mentions)||void 0===t||t.forEach(t=>{e.body=function(e,t){if(!t.mention_name)return e;const n="@"+t.mention_name,a=new RegExp(n,"g"),i=`<span class="${Le}">${n}</span>`;return e.replace(a,i)}(e.body,t)}),e}messageAdded(e){const t=this._messages.findIndex(t=>t.id===e.id);t>-1&&this._messages.splice(t,1);let n=this._messages.findIndex(t=>t.time>e.time);-1===n&&(n=this._messages.length),this.messagesInserted(n,[e])}messagesInserted(e,t){var n;const a=[],i=[],s=null!==(n=this.lastRead)&&void 0!==n?n:0;if(t.forEach((t,n)=>{a.push(this.formatChatMessage(t)),t.time>s&&i.push(e+n)}),this._messages.splice(e,0,...a),this._config.stackMessages){const t=e+a.length-1,n=0===e?1:e,i=this._messages.length>t+1?t+1:t;for(let e=n;e<=i;e++){const t=this._messages[e],n=this._messages[e-1].sender.username;t.stacked=n===t.sender.username}}this._addUnreadMessages(i),this._messagesUpdated.emit()}messagesDeleted(e,t){this._messages.splice(e,t),this._messagesUpdated.emit()}updateWriters(e){at.ArrayExt.shallowEqual(this._writers,e,(e,t)=>e.user.username===t.user.username&&e.user.display_name===t.user.display_name&&e.messageID===t.messageID)||(this._writers=e,this._writersChanged.emit(e))}getEditionModel(e){return this._messageEditions.get(e)}addEditionModel(e,t){var n;null===(n=this.getEditionModel(e))||void 0===n||n.dispose(),this._messageEditions.set(e,t),this._messageEditionAdded.emit({id:e,model:t}),t.onDisposed.connect(()=>{this._messageEditions.delete(e)})}_addUnreadMessages(e){const t=new Set(this._unreadMessages);e.forEach(e=>t.add(e)),this.unreadMessages=Array.from(t.values())}_notify(e,t=!1){this._commands&&(e&&this._config.unreadNotifications?this._commands.execute("apputils:update-notification",{id:this._notificationId,message:`${e} incoming message(s) ${this._name?"in "+this._name:""}`}).then(n=>{!n&&t&&this._commands.execute("apputils:notify",{type:"info",message:`${e} incoming message(s) in ${this._name}`}).then(e=>{this._notificationId=e})}):this._notificationId&&(this._commands.execute("apputils:dismiss-notification",{id:this._notificationId}),this._notificationId=null))}}class st{constructor(e){this._model=e.model}get name(){return this._model.name}get messages(){return[...this._model.messages]}get user(){var e;return null===(e=this._model)||void 0===e?void 0:e.user}}const ot=new C.Token("@jupyter/chat:IAttachmentOpenerRegistry");class lt extends Map{}const rt=new C.Token("@jupyter/chat:IChatCommandRegistry");class ct{constructor(){this._providers=new Map}addProvider(e){this._providers.set(e.id,e)}getProviders(){return Array.from(this._providers.values())}async onSubmit(e){for(const t of this._providers.values())await t.onSubmit(e)}}const dt=new C.Token("@jupyter/chat:ChatFooterRegistry");class ht{constructor(){this._footers={}}getFooter(){return this._footers}addSection(e){this._footers[e.position]=e}}class ut{constructor(e){var t;this._mainAreaDocumentWidget=null,this._selection=null,this._selectionChanged=new s.Signal(this),this._shell=e.shell,this._languages=e.languages||new De.EditorLanguageRegistry,null===(t=this._shell.currentChanged)||void 0===t||t.connect((e,t)=>{var n;const a=t.newValue;if(null===a)return void(this._mainAreaDocumentWidget=null);const s=Be(a);a instanceof Te.DocumentWidget&&(s||a.content instanceof i.Notebook)?this._mainAreaDocumentWidget=a:(null===(n=this._mainAreaDocumentWidget)||void 0===n?void 0:n.isDisposed)&&(this._mainAreaDocumentWidget=null)}),setInterval(this._poll.bind(this),200)}get selection(){return this._selection}get selectionChanged(){return this._selectionChanged}replaceSelection(e){const t=(0,at.find)(this._shell.widgets(),t=>t.id===e.widgetId);if(!((null==t?void 0:t.isVisible)&&t instanceof Te.DocumentWidget))return;if(this._shell.activateById(e.widgetId),t.content instanceof i.Notebook&&e.cellId){const n=function(e,t){var n;const a=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex(e=>e.getId()===t);return void 0===a?-1:a}(t.content,e.cellId);-1!==n&&(t.content.activeCellIndex=n)}const n=Be(t);if(!n)return;n.model.sharedModel.updateSource(n.getOffsetAt(e.start),n.getOffsetAt(e.end),e.text);const a=n.getPositionAt(n.getOffsetAt(e.start)+e.text.length);n.setSelection({start:a,end:a})}async _poll(){var e;let t=null;const n=this._selection;(null===(e=this._mainAreaDocumentWidget)||void 0===e?void 0:e.isVisible)&&(t=await async function(e,t){var n,a;const s=Be(e);if(!(s&&e instanceof Te.DocumentWidget))return null;let o;e.content instanceof i.Notebook&&(o=null===(n=e.content.activeCell)||void 0===n?void 0:n.model.id);const l=s.getSelection();let{start:r,end:c}=l;const d=s.getOffsetAt(r),h=s.getOffsetAt(c),u=s.model.sharedModel.getSource().substring(d,h);if(!u)return null;d>h&&([r,c]=[c,r]);const m=null===(a=await t.getLanguage(null==s?void 0:s.model.mimeType))||void 0===a?void 0:a.name;return{...l,start:r,end:c,text:u,numLines:u.split("\n").length,widgetId:e.id,...m&&{language:m},...o&&{cellId:o}}}(this._mainAreaDocumentWidget,this._languages)),(null==n?void 0:n.text)!==(null==t?void 0:t.text)&&(this._selection=t,this._selectionChanged.emit(t))}}var mt=n(2986);function gt(e){const t=mt.ReactWidget.create(c().createElement(re,{themeManager:e},c().createElement(l.Box,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},c().createElement(l.Box,{sx:{padding:4}},c().createElement(l.Alert,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-chat::chat",t.title.icon=k,t.title.caption="Jupyter Chat",t}var pt=n(9323),vt=n(1355);const ft="application/x-jupyter-icontentsrich",_t="application/vnd.jupyter.cells",Ct="jp-chat-drag-hover";class yt extends mt.ReactWidget{constructor(e){super(),this._dragTarget=null,this.title.icon=k,this.title.caption="Jupyter Chat",this._chatOptions=e,this.id=`jupyter-chat::widget::${e.model.name}`,this.node.addEventListener("click",e=>{const t=e.target;if(this.node.contains(document.activeElement))return;const n=t.closest(`.${Ye}`);if(n){const e=window.getSelection();if(e&&""!==e.toString().trim()&&n.contains(e.anchorNode))return}this.model.input.focus()})}get model(){return this._chatOptions.model}get inputToolbarRegistry(){return this._chatOptions.inputToolbarRegistry}render(){return c().createElement(nt,{...this._chatOptions,model:this._chatOptions.model})}handleEvent(e){if(e instanceof vt.Drag.Event)switch(e.type){case"lm-dragenter":e.preventDefault(),e.stopPropagation();break;case"lm-dragover":this._handleDrag(e);break;case"lm-drop":this._handleDrop(e);break;case"lm-dragleave":{const t=e.relatedTarget;t&&this.node.contains(t)||this._removeDragHoverClass();break}}}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("lm-dragover",this,!0),this.node.addEventListener("lm-dragenter",this,!0),this.node.addEventListener("lm-drop",this,!0),this.node.addEventListener("lm-dragleave",this,!0)}onBeforeDetach(e){this.node.removeEventListener("lm-dragover",this,!0),this.node.removeEventListener("lm-dragenter",this,!0),this.node.removeEventListener("lm-drop",this,!0),this.node.removeEventListener("lm-dragleave",this,!0),super.onBeforeDetach(e)}_handleDrag(e){const t=this.node.querySelector(".jp-chat-input-container"),n=e.target;(null==t?void 0:t.contains(n))||t===n?this._canHandleDrop(e)&&(e.preventDefault(),e.stopPropagation(),e.dropAction="move",t&&!t.classList.contains(Ct)&&(t.classList.add(Ct),this._dragTarget=t)):this._removeDragHoverClass()}_canHandleDrop(e){const t=e.mimeData.types();return t.includes(_t)||t.includes(ft)}_handleDrop(e){if(this._canHandleDrop(e)){e.preventDefault(),e.stopPropagation(),e.dropAction="move",this._removeDragHoverClass();try{e.mimeData.hasData(_t)?this._processCellDrop(e):e.mimeData.hasData(ft)&&this._processFileDrop(e)}catch(e){console.error("Error processing drop:",e)}}}_processFileDrop(e){var t,n,a;const i=e.mimeData.getData(ft);if(!(null===(t=null==i?void 0:i.model)||void 0===t?void 0:t.path))return void console.warn("Invalid file browser data in drop event");const s={type:"file",value:i.model.path,mimetype:i.model.mimetype};null===(a=(n=this.model.input).addAttachment)||void 0===a||a.call(n,s)}_processCellDrop(e){var t,n,a;try{const i=e.mimeData.getData(_t),s=Array.isArray(i)?i:[i];if(!(null===(t=s[0])||void 0===t?void 0:t.id))return void console.warn("No valid cells to process");const o=this._findNotebookPath(String(s[0].id));if(!o)return void console.warn(`Cannot find notebook for dragged cells from ${s[0].id}`);const l=[];for(const e of s){if(!e.id){console.warn("Dropped cell missing required ID, skipping");continue}let t;if((0,pt.isCode)(e))t="code";else if((0,pt.isMarkdown)(e))t="markdown";else{if(!(0,pt.isRaw)(e)){console.warn(`Unknown cell type: ${e.cell_type}, skipping`);continue}t="raw"}const n={id:e.id,input_type:t};l.push(n)}if(l.length){const e={type:"notebook",value:o,cells:l};null===(a=(n=this.model.input).addAttachment)||void 0===a||a.call(n,e)}}catch(e){console.error("Failed to process cell drop: ",e)}}_findNotebookPath(e){if(!this.model.input.activeCellManager)return null;const t=this.model.input.activeCellManager._notebookTracker;if(!t)return null;if(t.currentWidget){const n=t.currentWidget;if(n.content.widgets.find(t=>t.model.id===e))return n.context.path}const n=t.widgets||[];for(const t of n)if(t.content.widgets.find(t=>t.model.id===e))return t.context.path;return null}_removeDragHoverClass(){this._dragTarget&&(this._dragTarget.classList.remove(Ct),this._dragTarget=null)}}function bt(e){const t=new yt(e);return t.id="jupyter-chat::side-panel",t.title.icon=k,t.title.caption="Jupyter Chat",t}var wt=n(4583);class Et extends M.SidePanel{constructor(e){if(super(e),this._updateChatList=async()=>{var e;try{const t=await(null===(e=this._getChatNames)||void 0===e?void 0:e.call(this));this._chatNamesChanged.emit(null!=t?t:{})}catch(e){console.error("Error getting chat files",e)}},this._chatNamesChanged=new s.Signal(this),this._sectionAdded=new s.Signal(this),this.id="jupyter-chat::multi-chat-panel",this.title.icon=k,this.title.caption="Jupyter Chat",this.addClass("jp-chat-sidepanel"),this._rmRegistry=e.rmRegistry,this._themeManager=e.themeManager,this._chatCommandRegistry=e.chatCommandRegistry,this._attachmentOpenerRegistry=e.attachmentOpenerRegistry,this._inputToolbarFactory=e.inputToolbarFactory,this._messageFooterRegistry=e.messageFooterRegistry,this._welcomeMessage=e.welcomeMessage,this._getChatNames=e.getChatNames,this._createModel=e.createModel,this._openInMain=e.openInMain,this._renameChat=e.renameChat,this._createModel){const e=new M.ToolbarButton({onClick:async()=>{const e=await this._createModel();this.addChat(e)},icon:M.addIcon,label:"Chat",tooltip:"Add a new chat"});e.addClass("jp-chat-add"),this.toolbar.addItem("createChat",e)}this._getChatNames&&this._createModel&&(this._openChatWidget=M.ReactWidget.create(c().createElement(Mt,{chatNamesChanged:this._chatNamesChanged,handleChange:this._chatSelected.bind(this)})),this._openChatWidget.addClass("jp-chat-open"),this.toolbar.addItem("openChat",this._openChatWidget)),this.content.expansionToggled.connect(this._onExpansionToggled,this),this._updateChatListDebouncer=new wt.Debouncer(this._updateChatList,200)}get sections(){return this.widgets}get sectionAdded(){return this._sectionAdded}addChat(e){const{model:t,displayName:n}=e;if(!t)return;if(this.openIfExists(t.name))return;const a=this.content;for(let e=0;e<this.widgets.length;e++)a.collapse(e);let i;this._inputToolbarFactory&&(i=this._inputToolbarFactory.create());const s=new yt({model:t,rmRegistry:this._rmRegistry,themeManager:this._themeManager,chatCommandRegistry:this._chatCommandRegistry,attachmentOpenerRegistry:this._attachmentOpenerRegistry,inputToolbarRegistry:i,messageFooterRegistry:this._messageFooterRegistry,welcomeMessage:this._welcomeMessage}),o=new xt({widget:s,openInMain:this._openInMain,renameChat:this._renameChat,displayName:n});return this.addWidget(o),a.expand(this.widgets.length-1),this._sectionAdded.emit(o),s}updateChatList(){this._updateChatListDebouncer.invoke()}openIfExists(e){const t=this._getChatIndex(e);return t>-1&&this._expandChat(t),t>-1}onAfterAttach(){var e,t;null===(t=null===(e=this._openChatWidget)||void 0===e?void 0:e.renderPromise)||void 0===t||t.then(()=>this.updateChatList())}_getChatIndex(e){return this.sections.findIndex(t=>{var n;return(null===(n=t.model)||void 0===n?void 0:n.name)===e})}_expandChat(e){this.widgets[e].isVisible||this.content.expand(e)}async _chatSelected(e){const t=e.target.value;if("-"!==t){if(this._createModel){const e=await this._createModel(t);this.addChat(e)}e.target.selectedIndex=0}}_onExpansionToggled(e,t){if(this.widgets[t].isVisible)for(let n=0;n<this.widgets.length;n++)n!==t&&e.collapse(n)}}class xt extends M.PanelWithToolbar{constructor(e){var t,n,a,i,s;if(super(e),this._unreadChanged=(e,t)=>{this._markAsRead.enabled=t.length>0},this._spinner=new M.Spinner,this._chatWidget=e.widget,this.addWidget(this._chatWidget),this.addWidget(this._spinner),this.addClass("jp-chat-section"),this.toolbar.addClass("jp-chat-section-toolbar"),this._displayName=null!==(n=null!==(t=e.displayName)&&void 0!==t?t:e.widget.model.name)&&void 0!==n?n:"Chat",this._updateTitle(),this._markAsRead=new M.ToolbarButton({icon:I,iconLabel:"Mark chat as read",className:"jp-mod-styled",onClick:()=>{this.model&&(this.model.unreadMessages=[])}}),this.toolbar.addItem("markRead",this._markAsRead),e.renameChat){const t=new M.ToolbarButton({iconClass:"jp-EditIcon",iconLabel:"Rename chat",className:"jp-mod-styled",onClick:async()=>{var t,n;const a=null!==(t=this.model.name)&&void 0!==t?t:"Chat",i=await mt.InputDialog.getText({title:"Rename Chat",text:this.model.name,placeholder:"new-name"});if(!i.button.accept)return;const s=i.value;this.model&&s&&s!==a&&await(null===(n=e.renameChat)||void 0===n?void 0:n.call(e,a,s))&&(this.model.name=s,this._displayName=s,this._updateTitle())}});this.toolbar.addItem("rename",t)}if(e.openInMain){const t=new M.ToolbarButton({icon:M.launchIcon,iconLabel:"Move the chat to the main area",className:"jp-mod-styled",onClick:async()=>{var t;const n=this.model.name;await(null===(t=e.openInMain)||void 0===t?void 0:t.call(e,n))&&(this.model.dispose(),this.dispose())}});this.toolbar.addItem("moveMain",t)}const o=new M.ToolbarButton({icon:M.closeIcon,iconLabel:"Close the chat",className:"jp-mod-styled",onClick:()=>{this.model.dispose(),this.dispose()}});this.toolbar.addItem("close",o),null===(a=this.model.unreadChanged)||void 0===a||a.connect(this._unreadChanged),this._markAsRead.enabled=(null!==(s=null===(i=this.model)||void 0===i?void 0:i.unreadMessages.length)&&void 0!==s?s:0)>0,e.widget.node.style.height="100%",this.model.ready.then(()=>{this._spinner.dispose()})}get displayName(){return this._displayName}set displayName(e){this._displayName=e,this._updateTitle()}get widget(){return this._chatWidget}get model(){return this._chatWidget.model}dispose(){var e;const t=this.model;t&&(null===(e=t.unreadChanged)||void 0===e||e.disconnect(this._unreadChanged)),super.dispose()}_updateTitle(){this.title.label=this._displayName,this.title.caption=this._displayName}}function Mt({chatNamesChanged:e,handleChange:t}){const[n,a]=(0,r.useState)({});return e.connect((e,t)=>{a(t)}),c().createElement(M.HTMLSelect,{onChange:t,value:"-"},c().createElement("option",{value:"-"},"Open a chat"),Object.keys(n).map(e=>c().createElement("option",{value:n[e]},e)))}}}]);