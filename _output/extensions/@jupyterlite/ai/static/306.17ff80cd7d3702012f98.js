"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[306],{7306:(e,t,o)=>{o.r(t),o.d(t,{VERSION:()=>Ce,createOpenAI:()=>Me,openai:()=>Ne});var n=o(116),i=o(2100),s=o(6097),a=o(9717),r=s.Ik({error:s.Ik({message:s.Yj(),type:s.Yj().nullish(),param:s.bz().nullish(),code:s.KC([s.Yj(),s.ai()]).nullish()})}),l=(0,n.createJsonErrorResponseHandler)({errorSchema:r,errorToMessage:e=>e.error.message});function u({id:e,model:t,created:o}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=o?new Date(1e3*o):void 0}}function p(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var d=s.Ik({logitBias:s.g1(a.qG(s.rS,undefined),s.ai()).optional(),logprobs:s.KC([s.zM(),s.ai()]).optional(),parallelToolCalls:s.zM().optional(),user:s.Yj().optional(),reasoningEffort:s.k5(["minimal","low","medium","high"]).optional(),maxCompletionTokens:s.ai().optional(),store:s.zM().optional(),metadata:s.g1(s.Yj().max(64),s.Yj().max(512)).optional(),prediction:s.g1(s.Yj(),s.bz()).optional(),structuredOutputs:s.zM().optional(),serviceTier:s.k5(["auto","flex","priority"]).optional(),strictJsonSchema:s.zM().optional(),textVerbosity:s.k5(["low","medium","high"]).optional(),promptCacheKey:s.Yj().optional(),safetyIdentifier:s.Yj().optional()}),c=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:o,topP:s,topK:a,frequencyPenalty:r,presencePenalty:l,stopSequences:u,responseFormat:p,seed:c,tools:m,toolChoice:h,providerOptions:g}){var _,v,k,I;const b=[],Y=null!=(_=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:g,schema:d}))?_:{},j=null==(v=Y.structuredOutputs)||v;null!=a&&b.push({type:"unsupported-setting",setting:"topK"}),"json"!==(null==p?void 0:p.type)||null==p.schema||j||b.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{messages:w,warnings:x}=function({prompt:e,systemMessageMode:t="system"}){const o=[],s=[];for(const{role:a,content:r}of e)switch(a){case"system":switch(t){case"system":o.push({role:"system",content:r});break;case"developer":o.push({role:"developer",content:r});break;case"remove":s.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===r.length&&"text"===r[0].type){o.push({role:"user",content:r[0].text});break}o.push({role:"user",content:r.map((e,t)=>{var o,s,a;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,n.convertToBase64)(e.data)}`,detail:null==(s=null==(o=e.providerOptions)?void 0:o.openai)?void 0:s.imageDetail}}}if(!e.mediaType.startsWith("audio/")){if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new i.b8({functionality:"PDF file parts with URLs"});return{type:"file",file:"string"==typeof e.data&&e.data.startsWith("file-")?{file_id:e.data}:{filename:null!=(a=e.filename)?a:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,n.convertToBase64)(e.data)}`}}}throw new i.b8({functionality:`file part media type ${e.mediaType}`})}if(e.data instanceof URL)throw new i.b8({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:(0,n.convertToBase64)(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:(0,n.convertToBase64)(e.data),format:"mp3"}};default:throw new i.b8({functionality:`audio content parts with media type ${e.mediaType}`})}}})});break;case"assistant":{let e="";const t=[];for(const o of r)switch(o.type){case"text":e+=o.text;break;case"tool-call":t.push({id:o.toolCallId,type:"function",function:{name:o.toolName,arguments:JSON.stringify(o.input)}})}o.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(const e of r){const t=e.output;let n;switch(t.type){case"text":case"error-text":n=t.value;break;case"content":case"json":case"error-json":n=JSON.stringify(t.value)}o.push({role:"tool",tool_call_id:e.toolCallId,content:n})}break;default:throw new Error(`Unsupported role: ${a}`)}return{messages:o,warnings:s}}({prompt:e,systemMessageMode:y(this.modelId)});b.push(...x);const T=null!=(k=Y.strictJsonSchema)&&k,O={model:this.modelId,logit_bias:Y.logitBias,logprobs:!0===Y.logprobs||"number"==typeof Y.logprobs||void 0,top_logprobs:"number"==typeof Y.logprobs?Y.logprobs:"boolean"==typeof Y.logprobs&&Y.logprobs?0:void 0,user:Y.user,parallel_tool_calls:Y.parallelToolCalls,max_tokens:t,temperature:o,top_p:s,frequency_penalty:r,presence_penalty:l,response_format:"json"===(null==p?void 0:p.type)?j&&null!=p.schema?{type:"json_schema",json_schema:{schema:p.schema,strict:T,name:null!=(I=p.name)?I:"response",description:p.description}}:{type:"json_object"}:void 0,stop:u,seed:c,verbosity:Y.textVerbosity,max_completion_tokens:Y.maxCompletionTokens,store:Y.store,metadata:Y.metadata,prediction:Y.prediction,reasoning_effort:Y.reasoningEffort,service_tier:Y.serviceTier,prompt_cache_key:Y.promptCacheKey,safety_identifier:Y.safetyIdentifier,messages:w};var q;f(this.modelId)?(null!=O.temperature&&(O.temperature=void 0,b.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=O.top_p&&(O.top_p=void 0,b.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=O.frequency_penalty&&(O.frequency_penalty=void 0,b.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=O.presence_penalty&&(O.presence_penalty=void 0,b.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=O.logit_bias&&(O.logit_bias=void 0,b.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=O.logprobs&&(O.logprobs=void 0,b.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=O.top_logprobs&&(O.top_logprobs=void 0,b.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=O.max_tokens&&(null==O.max_completion_tokens&&(O.max_completion_tokens=O.max_tokens),O.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=O.temperature&&(O.temperature=void 0,b.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==Y.serviceTier||(q=this.modelId).startsWith("o3")||q.startsWith("o4-mini")||q.startsWith("gpt-5")&&!q.startsWith("gpt-5-chat")||(b.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),O.service_tier=void 0),"priority"!==Y.serviceTier||function(e){return e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini")}(this.modelId)||(b.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),O.service_tier=void 0);const{tools:S,toolChoice:C,toolWarnings:M}=function({tools:e,toolChoice:t,structuredOutputs:o,strictJsonSchema:n}){const s=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:s};const a=[];for(const t of e)"function"===t.type?a.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:o?n:void 0}}):s.push({type:"unsupported-tool",tool:t});if(null==t)return{tools:a,toolChoice:void 0,toolWarnings:s};const r=t.type;switch(r){case"auto":case"none":case"required":return{tools:a,toolChoice:r,toolWarnings:s};case"tool":return{tools:a,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:s};default:{const e=r;throw new i.b8({functionality:`tool choice type: ${e}`})}}}({tools:m,toolChoice:h,structuredOutputs:j,strictJsonSchema:T});return{args:{...O,tools:S,tool_choice:C},warnings:[...b,...M]}}async doGenerate(e){var t,o,i,s,a,r,d,c,m,g,f,y,_,v;const{args:k,warnings:I}=await this.getArgs(e),{responseHeaders:b,value:Y,rawValue:j}=await(0,n.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:k,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(h),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=Y.choices[0],x=[],T=w.message.content;null!=T&&T.length>0&&x.push({type:"text",text:T});for(const e of null!=(t=w.message.tool_calls)?t:[])x.push({type:"tool-call",toolCallId:null!=(o=e.id)?o:(0,n.generateId)(),toolName:e.function.name,input:e.function.arguments});for(const e of null!=(i=w.message.annotations)?i:[])x.push({type:"source",sourceType:"url",id:(0,n.generateId)(),url:e.url,title:e.title});const O=null==(s=Y.usage)?void 0:s.completion_tokens_details,q=null==(a=Y.usage)?void 0:a.prompt_tokens_details,S={openai:{}};return null!=(null==O?void 0:O.accepted_prediction_tokens)&&(S.openai.acceptedPredictionTokens=null==O?void 0:O.accepted_prediction_tokens),null!=(null==O?void 0:O.rejected_prediction_tokens)&&(S.openai.rejectedPredictionTokens=null==O?void 0:O.rejected_prediction_tokens),null!=(null==(r=w.logprobs)?void 0:r.content)&&(S.openai.logprobs=w.logprobs.content),{content:x,finishReason:p(w.finish_reason),usage:{inputTokens:null!=(c=null==(d=Y.usage)?void 0:d.prompt_tokens)?c:void 0,outputTokens:null!=(g=null==(m=Y.usage)?void 0:m.completion_tokens)?g:void 0,totalTokens:null!=(y=null==(f=Y.usage)?void 0:f.total_tokens)?y:void 0,reasoningTokens:null!=(_=null==O?void 0:O.reasoning_tokens)?_:void 0,cachedInputTokens:null!=(v=null==q?void 0:q.cached_tokens)?v:void 0},request:{body:k},response:{...u(Y),headers:b,body:j},warnings:I,providerMetadata:S}}async doStream(e){const{args:t,warnings:o}=await this.getArgs(e),s={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:r}=await(0,n.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:s,failedResponseHandler:l,successfulResponseHandler:(0,n.createEventSourceResponseHandler)(g),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=[];let c="unknown";const m={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let h=!0,f=!1;const y={openai:{}};return{stream:r.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var s,a,r,l,g,_,v,k,I,b,Y,j,w,x,T,O,q,S,C,M,N,R,E,$;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return c="error",void o.enqueue({type:"error",error:t.error});const P=t.value;if("error"in P)return c="error",void o.enqueue({type:"error",error:P.error});h&&(h=!1,o.enqueue({type:"response-metadata",...u(P)})),null!=P.usage&&(m.inputTokens=null!=(s=P.usage.prompt_tokens)?s:void 0,m.outputTokens=null!=(a=P.usage.completion_tokens)?a:void 0,m.totalTokens=null!=(r=P.usage.total_tokens)?r:void 0,m.reasoningTokens=null!=(g=null==(l=P.usage.completion_tokens_details)?void 0:l.reasoning_tokens)?g:void 0,m.cachedInputTokens=null!=(v=null==(_=P.usage.prompt_tokens_details)?void 0:_.cached_tokens)?v:void 0,null!=(null==(k=P.usage.completion_tokens_details)?void 0:k.accepted_prediction_tokens)&&(y.openai.acceptedPredictionTokens=null==(I=P.usage.completion_tokens_details)?void 0:I.accepted_prediction_tokens),null!=(null==(b=P.usage.completion_tokens_details)?void 0:b.rejected_prediction_tokens)&&(y.openai.rejectedPredictionTokens=null==(Y=P.usage.completion_tokens_details)?void 0:Y.rejected_prediction_tokens));const W=P.choices[0];if(null!=(null==W?void 0:W.finish_reason)&&(c=p(W.finish_reason)),null!=(null==(j=null==W?void 0:W.logprobs)?void 0:j.content)&&(y.openai.logprobs=W.logprobs.content),null==(null==W?void 0:W.delta))return;const H=W.delta;if(null!=H.content&&(f||(o.enqueue({type:"text-start",id:"0"}),f=!0),o.enqueue({type:"text-delta",id:"0",delta:H.content})),null!=H.tool_calls)for(const e of H.tool_calls){const t=e.index;if(null==d[t]){if("function"!==e.type)throw new i.xn({data:e,message:"Expected 'function' type."});if(null==e.id)throw new i.xn({data:e,message:"Expected 'id' to be a string."});if(null==(null==(w=e.function)?void 0:w.name))throw new i.xn({data:e,message:"Expected 'function.name' to be a string."});o.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),d[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(x=e.function.arguments)?x:""},hasFinished:!1};const s=d[t];null!=(null==(T=s.function)?void 0:T.name)&&null!=(null==(O=s.function)?void 0:O.arguments)&&(s.function.arguments.length>0&&o.enqueue({type:"tool-input-delta",id:s.id,delta:s.function.arguments}),(0,n.isParsableJson)(s.function.arguments)&&(o.enqueue({type:"tool-input-end",id:s.id}),o.enqueue({type:"tool-call",toolCallId:null!=(q=s.id)?q:(0,n.generateId)(),toolName:s.function.name,input:s.function.arguments}),s.hasFinished=!0));continue}const s=d[t];s.hasFinished||(null!=(null==(S=e.function)?void 0:S.arguments)&&(s.function.arguments+=null!=(M=null==(C=e.function)?void 0:C.arguments)?M:""),o.enqueue({type:"tool-input-delta",id:s.id,delta:null!=(N=e.function.arguments)?N:""}),null!=(null==(R=s.function)?void 0:R.name)&&null!=(null==(E=s.function)?void 0:E.arguments)&&(0,n.isParsableJson)(s.function.arguments)&&(o.enqueue({type:"tool-input-end",id:s.id}),o.enqueue({type:"tool-call",toolCallId:null!=($=s.id)?$:(0,n.generateId)(),toolName:s.function.name,input:s.function.arguments}),s.hasFinished=!0))}if(null!=H.annotations)for(const e of H.annotations)o.enqueue({type:"source",sourceType:"url",id:(0,n.generateId)(),url:e.url,title:e.title})},flush(e){f&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:c,usage:m,...null!=y?{providerMetadata:y}:{}})}})),request:{body:s},response:{headers:a}}}},m=s.Ik({prompt_tokens:s.ai().nullish(),completion_tokens:s.ai().nullish(),total_tokens:s.ai().nullish(),prompt_tokens_details:s.Ik({cached_tokens:s.ai().nullish()}).nullish(),completion_tokens_details:s.Ik({reasoning_tokens:s.ai().nullish(),accepted_prediction_tokens:s.ai().nullish(),rejected_prediction_tokens:s.ai().nullish()}).nullish()}).nullish(),h=s.Ik({id:s.Yj().nullish(),created:s.ai().nullish(),model:s.Yj().nullish(),choices:s.YO(s.Ik({message:s.Ik({role:s.eu("assistant").nullish(),content:s.Yj().nullish(),tool_calls:s.YO(s.Ik({id:s.Yj().nullish(),type:s.eu("function"),function:s.Ik({name:s.Yj(),arguments:s.Yj()})})).nullish(),annotations:s.YO(s.Ik({type:s.eu("url_citation"),start_index:s.ai(),end_index:s.ai(),url:s.Yj(),title:s.Yj()})).nullish()}),index:s.ai(),logprobs:s.Ik({content:s.YO(s.Ik({token:s.Yj(),logprob:s.ai(),top_logprobs:s.YO(s.Ik({token:s.Yj(),logprob:s.ai()}))})).nullish()}).nullish(),finish_reason:s.Yj().nullish()})),usage:m}),g=s.KC([s.Ik({id:s.Yj().nullish(),created:s.ai().nullish(),model:s.Yj().nullish(),choices:s.YO(s.Ik({delta:s.Ik({role:s.k5(["assistant"]).nullish(),content:s.Yj().nullish(),tool_calls:s.YO(s.Ik({index:s.ai(),id:s.Yj().nullish(),type:s.eu("function").nullish(),function:s.Ik({name:s.Yj().nullish(),arguments:s.Yj().nullish()})})).nullish(),annotations:s.YO(s.Ik({type:s.eu("url_citation"),start_index:s.ai(),end_index:s.ai(),url:s.Yj(),title:s.Yj()})).nullish()}).nullish(),logprobs:s.Ik({content:s.YO(s.Ik({token:s.Yj(),logprob:s.ai(),top_logprobs:s.YO(s.Ik({token:s.Yj(),logprob:s.ai()}))})).nullish()}).nullish(),finish_reason:s.Yj().nullish(),index:s.ai()})),usage:m}),r]);function f(e){return(e.startsWith("o")||e.startsWith("gpt-5"))&&!e.startsWith("gpt-5-chat")}function y(e){var t,o;return f(e)?null!=(o=null==(t=_[e])?void 0:t.systemMessageMode)?o:"developer":"system"}var _={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function v({id:e,model:t,created:o}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=o?new Date(1e3*o):void 0}}function k(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var I=s.Ik({echo:s.zM().optional(),logitBias:s.g1(s.Yj(),s.ai()).optional(),suffix:s.Yj().optional(),user:s.Yj().optional(),logprobs:s.KC([s.zM(),s.ai()]).optional()}),b=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:o,topP:s,topK:a,frequencyPenalty:r,presencePenalty:l,stopSequences:u,responseFormat:p,tools:d,toolChoice:c,seed:m,providerOptions:h}){const g=[],f={...await(0,n.parseProviderOptions)({provider:"openai",providerOptions:h,schema:I}),...await(0,n.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:h,schema:I})};null!=a&&g.push({type:"unsupported-setting",setting:"topK"}),(null==d?void 0:d.length)&&g.push({type:"unsupported-setting",setting:"tools"}),null!=c&&g.push({type:"unsupported-setting",setting:"toolChoice"}),null!=p&&"text"!==p.type&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:y,stopSequences:_}=function({prompt:e,user:t="user",assistant:o="assistant"}){let n="";"system"===e[0].role&&(n+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:s,content:a}of e)switch(s){case"system":throw new i.M3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":n+=`${t}:\n${a.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("")}\n\n`;break;case"assistant":n+=`${o}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new i.b8({functionality:"tool-call messages"})}}).join("")}\n\n`;break;case"tool":throw new i.b8({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${s}`)}return n+=`${o}:\n`,{prompt:n,stopSequences:[`\n${t}:`]}}({prompt:e}),v=[...null!=_?_:[],...null!=u?u:[]];return{args:{model:this.modelId,echo:f.echo,logit_bias:f.logitBias,logprobs:!0===(null==f?void 0:f.logprobs)?0:!1===(null==f?void 0:f.logprobs)||null==f?void 0:f.logprobs,suffix:f.suffix,user:f.user,max_tokens:t,temperature:o,top_p:s,frequency_penalty:r,presence_penalty:l,seed:m,prompt:y,stop:v.length>0?v:void 0},warnings:g}}async doGenerate(e){var t,o,i;const{args:s,warnings:a}=await this.getArgs(e),{responseHeaders:r,value:u,rawValue:p}=await(0,n.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:s,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(j),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=u.choices[0],c={openai:{}};return null!=d.logprobs&&(c.openai.logprobs=d.logprobs),{content:[{type:"text",text:d.text}],usage:{inputTokens:null==(t=u.usage)?void 0:t.prompt_tokens,outputTokens:null==(o=u.usage)?void 0:o.completion_tokens,totalTokens:null==(i=u.usage)?void 0:i.total_tokens},finishReason:k(d.finish_reason),request:{body:s},response:{...v(u),headers:r,body:p},providerMetadata:c,warnings:a}}async doStream(e){const{args:t,warnings:o}=await this.getArgs(e),i={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:a}=await(0,n.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:i,failedResponseHandler:l,successfulResponseHandler:(0,n.createEventSourceResponseHandler)(w),abortSignal:e.abortSignal,fetch:this.config.fetch});let r="unknown";const u={openai:{}},p={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let d=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return r="error",void o.enqueue({type:"error",error:t.error});const n=t.value;if("error"in n)return r="error",void o.enqueue({type:"error",error:n.error});d&&(d=!1,o.enqueue({type:"response-metadata",...v(n)}),o.enqueue({type:"text-start",id:"0"})),null!=n.usage&&(p.inputTokens=n.usage.prompt_tokens,p.outputTokens=n.usage.completion_tokens,p.totalTokens=n.usage.total_tokens);const i=n.choices[0];null!=(null==i?void 0:i.finish_reason)&&(r=k(i.finish_reason)),null!=(null==i?void 0:i.logprobs)&&(u.openai.logprobs=i.logprobs),null!=(null==i?void 0:i.text)&&i.text.length>0&&o.enqueue({type:"text-delta",id:"0",delta:i.text})},flush(e){d||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:r,providerMetadata:u,usage:p})}})),request:{body:i},response:{headers:s}}}},Y=s.Ik({prompt_tokens:s.ai(),completion_tokens:s.ai(),total_tokens:s.ai()}),j=s.Ik({id:s.Yj().nullish(),created:s.ai().nullish(),model:s.Yj().nullish(),choices:s.YO(s.Ik({text:s.Yj(),finish_reason:s.Yj(),logprobs:s.Ik({tokens:s.YO(s.Yj()),token_logprobs:s.YO(s.ai()),top_logprobs:s.YO(s.g1(s.Yj(),s.ai())).nullish()}).nullish()})),usage:Y.nullish()}),w=s.KC([s.Ik({id:s.Yj().nullish(),created:s.ai().nullish(),model:s.Yj().nullish(),choices:s.YO(s.Ik({text:s.Yj(),finish_reason:s.Yj().nullish(),index:s.ai(),logprobs:s.Ik({tokens:s.YO(s.Yj()),token_logprobs:s.YO(s.ai()),top_logprobs:s.YO(s.g1(s.Yj(),s.ai())).nullish()}).nullish()})),usage:Y.nullish()}),r]),x=s.Ik({dimensions:s.ai().optional(),user:s.Yj().optional()}),T=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:o,providerOptions:s}){var a;if(e.length>this.maxEmbeddingsPerCall)throw new i.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const r=null!=(a=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:s,schema:x}))?a:{},{responseHeaders:u,value:p,rawValue:d}=await(0,n.postJsonToApi)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:r.dimensions,user:r.user},failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(O),abortSignal:o,fetch:this.config.fetch});return{embeddings:p.data.map(e=>e.embedding),usage:p.usage?{tokens:p.usage.prompt_tokens}:void 0,response:{headers:u,body:d}}}},O=s.Ik({data:s.YO(s.Ik({embedding:s.YO(s.ai())})),usage:s.Ik({prompt_tokens:s.ai()}).nullish()}),q={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10},S=new Set(["gpt-image-1","gpt-image-1-mini"]),C=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=q[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:o,aspectRatio:i,seed:s,providerOptions:a,headers:r,abortSignal:u}){var p,d,c,m;const h=[];null!=i&&h.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=s&&h.push({type:"unsupported-setting",setting:"seed"});const g=null!=(c=null==(d=null==(p=this.config._internal)?void 0:p.currentDate)?void 0:d.call(p))?c:new Date,{value:f,responseHeaders:y}=await(0,n.postJsonToApi)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),r),body:{model:this.modelId,prompt:e,n:t,size:o,...null!=(m=a.openai)?m:{},...S.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(M),abortSignal:u,fetch:this.config.fetch});return{images:f.data.map(e=>e.b64_json),warnings:h,response:{timestamp:g,modelId:this.modelId,headers:y},providerMetadata:{openai:{images:f.data.map(e=>e.revised_prompt?{revisedPrompt:e.revised_prompt}:null)}}}}},M=s.Ik({data:s.YO(s.Ik({b64_json:s.Yj(),revised_prompt:s.Yj().optional()}))}),N=s.Ik({code:s.Yj().nullish(),containerId:s.Yj()}),R=s.Ik({outputs:s.YO(s.gM("type",[s.Ik({type:s.eu("logs"),logs:s.Yj()}),s.Ik({type:s.eu("image"),url:s.Yj()})])).nullish()}),E=s.Ik({container:s.KC([s.Yj(),s.Ik({fileIds:s.YO(s.Yj()).optional()})]).optional()}),$=(0,n.createProviderDefinedToolFactoryWithOutputSchema)({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:N,outputSchema:R}),P=s.Ik({key:s.Yj(),type:s.k5(["eq","ne","gt","gte","lt","lte"]),value:s.KC([s.Yj(),s.ai(),s.zM()])}),W=s.Ik({type:s.k5(["and","or"]),filters:s.YO(s.KC([P,s.RZ(()=>W)]))}),H=s.Ik({vectorStoreIds:s.YO(s.Yj()),maxNumResults:s.ai().optional(),ranking:s.Ik({ranker:s.Yj().optional(),scoreThreshold:s.ai().optional()}).optional(),filters:s.KC([P,W]).optional()}),A=s.Ik({queries:s.YO(s.Yj()),results:s.YO(s.Ik({attributes:s.g1(s.Yj(),s.L5()),fileId:s.Yj(),filename:s.Yj(),score:s.ai(),text:s.Yj()})).nullable()}),J=(0,n.createProviderDefinedToolFactoryWithOutputSchema)({id:"openai.file_search",name:"file_search",inputSchema:s.Ik({}),outputSchema:A}),z=s.Ik({background:s.k5(["auto","opaque","transparent"]).optional(),inputFidelity:s.k5(["low","high"]).optional(),inputImageMask:s.Ik({fileId:s.Yj().optional(),imageUrl:s.Yj().optional()}).optional(),model:s.Yj().optional(),moderation:s.k5(["auto"]).optional(),outputCompression:s.ai().int().min(0).max(100).optional(),outputFormat:s.k5(["png","jpeg","webp"]).optional(),quality:s.k5(["auto","low","medium","high"]).optional(),size:s.k5(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict(),D=s.Ik({result:s.Yj()}),F=(0,n.createProviderDefinedToolFactoryWithOutputSchema)({id:"openai.image_generation",name:"image_generation",inputSchema:s.Ik({}),outputSchema:D}),V=s.Ik({action:s.Ik({type:s.eu("exec"),command:s.YO(s.Yj()),timeoutMs:s.ai().optional(),user:s.Yj().optional(),workingDirectory:s.Yj().optional(),env:s.g1(s.Yj(),s.Yj()).optional()})}),U=s.Ik({output:s.Yj()}),K=(0,n.createProviderDefinedToolFactoryWithOutputSchema)({id:"openai.local_shell",name:"local_shell",inputSchema:V,outputSchema:U}),B=s.Ik({filters:s.Ik({allowedDomains:s.YO(s.Yj()).optional()}).optional(),searchContextSize:s.k5(["low","medium","high"]).optional(),userLocation:s.Ik({type:s.eu("approximate"),country:s.Yj().optional(),city:s.Yj().optional(),region:s.Yj().optional(),timezone:s.Yj().optional()}).optional()}),L=(0,n.createProviderDefinedToolFactory)({id:"openai.web_search",name:"web_search",inputSchema:s.Ik({action:s.gM("type",[s.Ik({type:s.eu("search"),query:s.Yj().nullish()}),s.Ik({type:s.eu("open_page"),url:s.Yj()}),s.Ik({type:s.eu("find"),url:s.Yj(),pattern:s.Yj()})]).nullish()})}),G=s.Ik({searchContextSize:s.k5(["low","medium","high"]).optional(),userLocation:s.Ik({type:s.eu("approximate"),country:s.Yj().optional(),city:s.Yj().optional(),region:s.Yj().optional(),timezone:s.Yj().optional()}).optional()}),Z={codeInterpreter:(e={})=>$(e),fileSearch:J,imageGeneration:(e={})=>F(e),localShell:K,webSearchPreview:(0,n.createProviderDefinedToolFactory)({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:s.Ik({action:s.gM("type",[s.Ik({type:s.eu("search"),query:s.Yj().nullish()}),s.Ik({type:s.eu("open_page"),url:s.Yj()}),s.Ik({type:s.eu("find"),url:s.Yj(),pattern:s.Yj()})]).nullish()})}),webSearch:(e={})=>L(e)};function Q(e,t){return!!t&&t.some(t=>e.startsWith(t))}var X=s.Ik({itemId:s.Yj().nullish(),reasoningEncryptedContent:s.Yj().nullish()});function ee({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var te=s.Ik({type:s.eu("web_search_call"),id:s.Yj(),status:s.Yj(),action:s.gM("type",[s.Ik({type:s.eu("search"),query:s.Yj().nullish()}),s.Ik({type:s.eu("open_page"),url:s.Yj()}),s.Ik({type:s.eu("find"),url:s.Yj(),pattern:s.Yj()})]).nullish()}),oe=s.Ik({type:s.eu("file_search_call"),id:s.Yj(),queries:s.YO(s.Yj()),results:s.YO(s.Ik({attributes:s.g1(s.Yj(),s.L5()),file_id:s.Yj(),filename:s.Yj(),score:s.ai(),text:s.Yj()})).nullish()}),ne=s.Ik({type:s.eu("code_interpreter_call"),id:s.Yj(),code:s.Yj().nullable(),container_id:s.Yj(),outputs:s.YO(s.gM("type",[s.Ik({type:s.eu("logs"),logs:s.Yj()}),s.Ik({type:s.eu("image"),url:s.Yj()})])).nullable()}),ie=s.Ik({type:s.eu("local_shell_call"),id:s.Yj(),call_id:s.Yj(),action:s.Ik({type:s.eu("exec"),command:s.YO(s.Yj()),timeout_ms:s.ai().optional(),user:s.Yj().optional(),working_directory:s.Yj().optional(),env:s.g1(s.Yj(),s.Yj()).optional()})}),se=s.Ik({type:s.eu("image_generation_call"),id:s.Yj(),result:s.Yj()}),ae=s.YO(s.Ik({token:s.Yj(),logprob:s.ai(),top_logprobs:s.YO(s.Ik({token:s.Yj(),logprob:s.ai()}))})),re=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:o,topP:s,topK:a,presencePenalty:r,frequencyPenalty:l,seed:u,prompt:p,providerOptions:d,tools:c,toolChoice:m,responseFormat:h}){var g,f,y,_;const v=[],k=function(e){const t={requiredAutoTruncation:!1,systemMessageMode:"system",supportsFlexProcessing:e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),supportsPriorityProcessing:e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini")};return e.startsWith("gpt-5-chat")?{...t,isReasoningModel:!1}:e.startsWith("o")||e.startsWith("gpt-5")||e.startsWith("codex-")||e.startsWith("computer-use")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{...t,isReasoningModel:!0,systemMessageMode:"remove"}:{...t,isReasoningModel:!0,systemMessageMode:"developer"}:{...t,isReasoningModel:!1}}(this.modelId);null!=a&&v.push({type:"unsupported-setting",setting:"topK"}),null!=u&&v.push({type:"unsupported-setting",setting:"seed"}),null!=r&&v.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=l&&v.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=o&&v.push({type:"unsupported-setting",setting:"stopSequences"});const I=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:d,schema:je}),{input:b,warnings:Y}=await async function({prompt:e,systemMessageMode:t,fileIdPrefixes:o,store:s,hasLocalShellTool:a=!1}){var r,l,u,p,d,c,m,h,g;const f=[],y=[];for(const{role:_,content:v}of e)switch(_){case"system":switch(t){case"system":f.push({role:"system",content:v});break;case"developer":f.push({role:"developer",content:v});break;case"remove":y.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":f.push({role:"user",content:v.map((e,t)=>{var s,a,r;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",...e.data instanceof URL?{image_url:e.data.toString()}:"string"==typeof e.data&&Q(e.data,o)?{file_id:e.data}:{image_url:`data:${t};base64,${(0,n.convertToBase64)(e.data)}`},detail:null==(a=null==(s=e.providerOptions)?void 0:s.openai)?void 0:a.imageDetail}}if("application/pdf"===e.mediaType)return e.data instanceof URL?{type:"input_file",file_url:e.data.toString()}:{type:"input_file",..."string"==typeof e.data&&Q(e.data,o)?{file_id:e.data}:{filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,n.convertToBase64)(e.data)}`}};throw new i.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{const e={},t={};for(const o of v)switch(o.type){case"text":f.push({role:"assistant",content:[{type:"output_text",text:o.text}],id:null!=(u=null==(l=null==(r=o.providerOptions)?void 0:r.openai)?void 0:l.itemId)?u:void 0});break;case"tool-call":if(t[o.toolCallId]=o,o.providerExecuted)break;if(a&&"local_shell"===o.toolName){const e=V.parse(o.input);f.push({type:"local_shell_call",call_id:o.toolCallId,id:null!=(c=null==(d=null==(p=o.providerOptions)?void 0:p.openai)?void 0:d.itemId)?c:void 0,action:{type:"exec",command:e.action.command,timeout_ms:e.action.timeoutMs,user:e.action.user,working_directory:e.action.workingDirectory,env:e.action.env}});break}f.push({type:"function_call",call_id:o.toolCallId,name:o.toolName,arguments:JSON.stringify(o.input),id:null!=(g=null==(h=null==(m=o.providerOptions)?void 0:m.openai)?void 0:h.itemId)?g:void 0});break;case"tool-result":s?f.push({type:"item_reference",id:o.toolCallId}):y.push({type:"other",message:`Results for OpenAI tool ${o.toolName} are not sent to the API when store is false`});break;case"reasoning":{const t=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:o.providerOptions,schema:X}),i=null==t?void 0:t.itemId;if(null!=i){const n=e[i];if(s)void 0===n&&(f.push({type:"item_reference",id:i}),e[i]={type:"reasoning",id:i,summary:[]});else{const s=[];o.text.length>0?s.push({type:"summary_text",text:o.text}):void 0!==n&&y.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(o)}.`}),void 0===n?(e[i]={type:"reasoning",id:i,encrypted_content:null==t?void 0:t.reasoningEncryptedContent,summary:s},f.push(e[i])):n.summary.push(...s)}}else y.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(o)}.`});break}}break}case"tool":for(const e of v){const t=e.output;if(a&&"local_shell"===e.toolName&&"json"===t.type){f.push({type:"local_shell_call_output",call_id:e.toolCallId,output:U.parse(t.value).output});break}let o;switch(t.type){case"text":case"error-text":o=t.value;break;case"content":case"json":case"error-json":o=JSON.stringify(t.value)}f.push({type:"function_call_output",call_id:e.toolCallId,output:o})}break;default:throw new Error(`Unsupported role: ${_}`)}return{input:f,warnings:y}}({prompt:p,systemMessageMode:k.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:null==(g=null==I?void 0:I.store)||g,hasLocalShellTool:T("openai.local_shell")});v.push(...Y);const j=null!=(f=null==I?void 0:I.strictJsonSchema)&&f;let w=null==I?void 0:I.include;function x(e){w=null!=w?[...w,e]:[e]}function T(e){return null!=(null==c?void 0:c.find(t=>"provider-defined"===t.type&&t.id===e))}const O="number"==typeof(null==I?void 0:I.logprobs)?null==I?void 0:I.logprobs:!0===(null==I?void 0:I.logprobs)?20:void 0;O&&x("message.output_text.logprobs");const q=null==(y=null==c?void 0:c.find(e=>"provider-defined"===e.type&&("openai.web_search"===e.id||"openai.web_search_preview"===e.id)))?void 0:y.name;q&&x("web_search_call.action.sources"),T("openai.code_interpreter")&&x("code_interpreter_call.outputs");const S={model:this.modelId,input:b,temperature:t,top_p:s,max_output_tokens:e,...("json"===(null==h?void 0:h.type)||(null==I?void 0:I.textVerbosity))&&{text:{..."json"===(null==h?void 0:h.type)&&{format:null!=h.schema?{type:"json_schema",strict:j,name:null!=(_=h.name)?_:"response",description:h.description,schema:h.schema}:{type:"json_object"}},...(null==I?void 0:I.textVerbosity)&&{verbosity:I.textVerbosity}}},max_tool_calls:null==I?void 0:I.maxToolCalls,metadata:null==I?void 0:I.metadata,parallel_tool_calls:null==I?void 0:I.parallelToolCalls,previous_response_id:null==I?void 0:I.previousResponseId,store:null==I?void 0:I.store,user:null==I?void 0:I.user,instructions:null==I?void 0:I.instructions,service_tier:null==I?void 0:I.serviceTier,include:w,prompt_cache_key:null==I?void 0:I.promptCacheKey,safety_identifier:null==I?void 0:I.safetyIdentifier,top_logprobs:O,...k.isReasoningModel&&(null!=(null==I?void 0:I.reasoningEffort)||null!=(null==I?void 0:I.reasoningSummary))&&{reasoning:{...null!=(null==I?void 0:I.reasoningEffort)&&{effort:I.reasoningEffort},...null!=(null==I?void 0:I.reasoningSummary)&&{summary:I.reasoningSummary}}},...k.requiredAutoTruncation&&{truncation:"auto"}};k.isReasoningModel?(null!=S.temperature&&(S.temperature=void 0,v.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=S.top_p&&(S.top_p=void 0,v.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):(null!=(null==I?void 0:I.reasoningEffort)&&v.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),null!=(null==I?void 0:I.reasoningSummary)&&v.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),"flex"!==(null==I?void 0:I.serviceTier)||k.supportsFlexProcessing||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete S.service_tier),"priority"!==(null==I?void 0:I.serviceTier)||k.supportsPriorityProcessing||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete S.service_tier);const{tools:C,toolChoice:M,toolWarnings:N}=function({tools:e,toolChoice:t,strictJsonSchema:o}){const n=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:n};const s=[];for(const t of e)switch(t.type){case"function":s.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,strict:o});break;case"provider-defined":switch(t.id){case"openai.file_search":{const e=H.parse(t.args);s.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case"openai.local_shell":s.push({type:"local_shell"});break;case"openai.web_search_preview":{const e=G.parse(t.args);s.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.web_search":{const e=B.parse(t.args);s.push({type:"web_search",filters:null!=e.filters?{allowed_domains:e.filters.allowedDomains}:void 0,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.code_interpreter":{const e=E.parse(t.args);s.push({type:"code_interpreter",container:null==e.container?{type:"auto",file_ids:void 0}:"string"==typeof e.container?e.container:{type:"auto",file_ids:e.container.fileIds}});break}case"openai.image_generation":{const e=z.parse(t.args);s.push({type:"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,size:e.size,quality:e.quality,moderation:e.moderation,output_format:e.outputFormat,output_compression:e.outputCompression});break}}break;default:n.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:s,toolChoice:void 0,toolWarnings:n};const a=t.type;switch(a){case"auto":case"none":case"required":return{tools:s,toolChoice:a,toolWarnings:n};case"tool":return{tools:s,toolChoice:"code_interpreter"===t.toolName||"file_search"===t.toolName||"image_generation"===t.toolName||"web_search_preview"===t.toolName||"web_search"===t.toolName?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:n};default:{const e=a;throw new i.b8({functionality:`tool choice type: ${e}`})}}}({tools:c,toolChoice:m,strictJsonSchema:j});return{webSearchToolName:q,args:{...S,tools:C,tool_choice:M},warnings:[...v,...N]}}async doGenerate(e){var t,o,a,r,u,p,d,c,m,h,g,f,y,_,v,k,I,b,Y;const{args:j,warnings:w,webSearchToolName:x}=await this.getArgs(e),T=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:O,value:q,rawValue:S}=await(0,n.postJsonToApi)({url:T,headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:j,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(s.Ik({id:s.Yj(),created_at:s.ai(),error:s.Ik({code:s.Yj(),message:s.Yj()}).nullish(),model:s.Yj(),output:s.YO(s.gM("type",[s.Ik({type:s.eu("message"),role:s.eu("assistant"),id:s.Yj(),content:s.YO(s.Ik({type:s.eu("output_text"),text:s.Yj(),logprobs:ae.nullish(),annotations:s.YO(s.gM("type",[s.Ik({type:s.eu("url_citation"),start_index:s.ai(),end_index:s.ai(),url:s.Yj(),title:s.Yj()}),s.Ik({type:s.eu("file_citation"),file_id:s.Yj(),filename:s.Yj().nullish(),index:s.ai().nullish(),start_index:s.ai().nullish(),end_index:s.ai().nullish(),quote:s.Yj().nullish()}),s.Ik({type:s.eu("container_file_citation")})]))}))}),te,oe,ne,se,ie,s.Ik({type:s.eu("function_call"),call_id:s.Yj(),name:s.Yj(),arguments:s.Yj(),id:s.Yj()}),s.Ik({type:s.eu("computer_call"),id:s.Yj(),status:s.Yj().optional()}),s.Ik({type:s.eu("reasoning"),id:s.Yj(),encrypted_content:s.Yj().nullish(),summary:s.YO(s.Ik({type:s.eu("summary_text"),text:s.Yj()}))})])),service_tier:s.Yj().nullish(),incomplete_details:s.Ik({reason:s.Yj()}).nullish(),usage:le})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(q.error)throw new i.hL({message:q.error.message,url:T,requestBodyValues:j,statusCode:400,responseHeaders:O,responseBody:S,isRetryable:!1});const C=[],M=[];let N=!1;for(const i of q.output)switch(i.type){case"reasoning":0===i.summary.length&&i.summary.push({type:"summary_text",text:""});for(const e of i.summary)C.push({type:"reasoning",text:e.text,providerMetadata:{openai:{itemId:i.id,reasoningEncryptedContent:null!=(t=i.encrypted_content)?t:null}}});break;case"image_generation_call":C.push({type:"tool-call",toolCallId:i.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),C.push({type:"tool-result",toolCallId:i.id,toolName:"image_generation",result:{result:i.result},providerExecuted:!0});break;case"local_shell_call":C.push({type:"tool-call",toolCallId:i.call_id,toolName:"local_shell",input:JSON.stringify({action:i.action}),providerMetadata:{openai:{itemId:i.id}}});break;case"message":for(const t of i.content){(null==(a=null==(o=e.providerOptions)?void 0:o.openai)?void 0:a.logprobs)&&t.logprobs&&M.push(t.logprobs),C.push({type:"text",text:t.text,providerMetadata:{openai:{itemId:i.id}}});for(const e of t.annotations)"url_citation"===e.type?C.push({type:"source",sourceType:"url",id:null!=(p=null==(u=(r=this.config).generateId)?void 0:u.call(r))?p:(0,n.generateId)(),url:e.url,title:e.title}):"file_citation"===e.type&&C.push({type:"source",sourceType:"document",id:null!=(m=null==(c=(d=this.config).generateId)?void 0:c.call(d))?m:(0,n.generateId)(),mediaType:"text/plain",title:null!=(g=null!=(h=e.quote)?h:e.filename)?g:"Document",filename:null!=(f=e.filename)?f:e.file_id})}break;case"function_call":N=!0,C.push({type:"tool-call",toolCallId:i.call_id,toolName:i.name,input:i.arguments,providerMetadata:{openai:{itemId:i.id}}});break;case"web_search_call":C.push({type:"tool-call",toolCallId:i.id,toolName:null!=x?x:"web_search",input:JSON.stringify({action:i.action}),providerExecuted:!0}),C.push({type:"tool-result",toolCallId:i.id,toolName:null!=x?x:"web_search",result:{status:i.status},providerExecuted:!0});break;case"computer_call":C.push({type:"tool-call",toolCallId:i.id,toolName:"computer_use",input:"",providerExecuted:!0}),C.push({type:"tool-result",toolCallId:i.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:i.status||"completed"},providerExecuted:!0});break;case"file_search_call":C.push({type:"tool-call",toolCallId:i.id,toolName:"file_search",input:"{}",providerExecuted:!0}),C.push({type:"tool-result",toolCallId:i.id,toolName:"file_search",result:{queries:i.queries,results:null!=(_=null==(y=i.results)?void 0:y.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?_:null},providerExecuted:!0});break;case"code_interpreter_call":C.push({type:"tool-call",toolCallId:i.id,toolName:"code_interpreter",input:JSON.stringify({code:i.code,containerId:i.container_id}),providerExecuted:!0}),C.push({type:"tool-result",toolCallId:i.id,toolName:"code_interpreter",result:{outputs:i.outputs},providerExecuted:!0})}const R={openai:{responseId:q.id}};return M.length>0&&(R.openai.logprobs=M),"string"==typeof q.service_tier&&(R.openai.serviceTier=q.service_tier),{content:C,finishReason:ee({finishReason:null==(v=q.incomplete_details)?void 0:v.reason,hasFunctionCall:N}),usage:{inputTokens:q.usage.input_tokens,outputTokens:q.usage.output_tokens,totalTokens:q.usage.input_tokens+q.usage.output_tokens,reasoningTokens:null!=(I=null==(k=q.usage.output_tokens_details)?void 0:k.reasoning_tokens)?I:void 0,cachedInputTokens:null!=(Y=null==(b=q.usage.input_tokens_details)?void 0:b.cached_tokens)?Y:void 0},request:{body:j},response:{id:q.id,timestamp:new Date(1e3*q.created_at),modelId:q.model,headers:O,body:S},providerMetadata:R,warnings:w}}async doStream(e){const{args:t,warnings:o,webSearchToolName:i}=await this.getArgs(e),{responseHeaders:s,value:a}=await(0,n.postJsonToApi)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:l,successfulResponseHandler:(0,n.createEventSourceResponseHandler)(Ie),abortSignal:e.abortSignal,fetch:this.config.fetch}),r=this;let u="unknown";const p={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d=[];let c=null;const m={};let h=!1;const g={};let f;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var s,a,l,y,_,v,k,I,b,Y,j,w,x,T,O,q,S,C,M,N,R,E,$;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return u="error",void o.enqueue({type:"error",error:t.error});const P=t.value;if(Ye(P))"function_call"===P.item.type?(m[P.output_index]={toolName:P.item.name,toolCallId:P.item.call_id},o.enqueue({type:"tool-input-start",id:P.item.call_id,toolName:P.item.name})):"web_search_call"===P.item.type?(m[P.output_index]={toolName:null!=i?i:"web_search",toolCallId:P.item.id},o.enqueue({type:"tool-input-start",id:P.item.id,toolName:null!=i?i:"web_search",providerExecuted:!0})):"computer_call"===P.item.type?(m[P.output_index]={toolName:"computer_use",toolCallId:P.item.id},o.enqueue({type:"tool-input-start",id:P.item.id,toolName:"computer_use",providerExecuted:!0})):"code_interpreter_call"===P.item.type?(m[P.output_index]={toolName:"code_interpreter",toolCallId:P.item.id,codeInterpreter:{containerId:P.item.container_id}},o.enqueue({type:"tool-input-start",id:P.item.id,toolName:"code_interpreter",providerExecuted:!0}),o.enqueue({type:"tool-input-delta",id:P.item.id,delta:`{"containerId":"${P.item.container_id}","code":"`})):"file_search_call"===P.item.type?o.enqueue({type:"tool-call",toolCallId:P.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):"image_generation_call"===P.item.type?o.enqueue({type:"tool-call",toolCallId:P.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):"message"===P.item.type?o.enqueue({type:"text-start",id:P.item.id,providerMetadata:{openai:{itemId:P.item.id}}}):function(e){return Ye(e)&&"reasoning"===e.item.type}(P)&&(g[P.item.id]={encryptedContent:P.item.encrypted_content,summaryParts:[0]},o.enqueue({type:"reasoning-start",id:`${P.item.id}:0`,providerMetadata:{openai:{itemId:P.item.id,reasoningEncryptedContent:null!=(s=P.item.encrypted_content)?s:null}}}));else if(be(P)){if("function_call"===P.item.type)m[P.output_index]=void 0,h=!0,o.enqueue({type:"tool-input-end",id:P.item.call_id}),o.enqueue({type:"tool-call",toolCallId:P.item.call_id,toolName:P.item.name,input:P.item.arguments,providerMetadata:{openai:{itemId:P.item.id}}});else if("web_search_call"===P.item.type)m[P.output_index]=void 0,o.enqueue({type:"tool-input-end",id:P.item.id}),o.enqueue({type:"tool-call",toolCallId:P.item.id,toolName:"web_search",input:JSON.stringify({action:P.item.action}),providerExecuted:!0}),o.enqueue({type:"tool-result",toolCallId:P.item.id,toolName:"web_search",result:{status:P.item.status},providerExecuted:!0});else if("computer_call"===P.item.type)m[P.output_index]=void 0,o.enqueue({type:"tool-input-end",id:P.item.id}),o.enqueue({type:"tool-call",toolCallId:P.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),o.enqueue({type:"tool-result",toolCallId:P.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:P.item.status||"completed"},providerExecuted:!0});else if("file_search_call"===P.item.type)m[P.output_index]=void 0,o.enqueue({type:"tool-result",toolCallId:P.item.id,toolName:"file_search",result:{queries:P.item.queries,results:null!=(l=null==(a=P.item.results)?void 0:a.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?l:null},providerExecuted:!0});else if("code_interpreter_call"===P.item.type)m[P.output_index]=void 0,o.enqueue({type:"tool-result",toolCallId:P.item.id,toolName:"code_interpreter",result:{outputs:P.item.outputs},providerExecuted:!0});else if("image_generation_call"===P.item.type)o.enqueue({type:"tool-result",toolCallId:P.item.id,toolName:"image_generation",result:{result:P.item.result},providerExecuted:!0});else if("local_shell_call"===P.item.type)m[P.output_index]=void 0,o.enqueue({type:"tool-call",toolCallId:P.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:P.item.action.command,timeoutMs:P.item.action.timeout_ms,user:P.item.action.user,workingDirectory:P.item.action.working_directory,env:P.item.action.env}}),providerMetadata:{openai:{itemId:P.item.id}}});else if("message"===P.item.type)o.enqueue({type:"text-end",id:P.item.id});else if(function(e){return be(e)&&"reasoning"===e.item.type}(P)){const e=g[P.item.id];for(const t of e.summaryParts)o.enqueue({type:"reasoning-end",id:`${P.item.id}:${t}`,providerMetadata:{openai:{itemId:P.item.id,reasoningEncryptedContent:null!=(y=P.item.encrypted_content)?y:null}}});delete g[P.item.id]}}else if(function(e){return"response.function_call_arguments.delta"===e.type}(P)){const e=m[P.output_index];null!=e&&o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:P.delta})}else if(function(e){return"response.code_interpreter_call_code.delta"===e.type}(P)){const e=m[P.output_index];null!=e&&o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:JSON.stringify(P.delta).slice(1,-1)})}else if(function(e){return"response.code_interpreter_call_code.done"===e.type}(P)){const e=m[P.output_index];null!=e&&(o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}'}),o.enqueue({type:"tool-input-end",id:e.toolCallId}),o.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:P.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else!function(e){return"response.created"===e.type}(P)?function(e){return"response.output_text.delta"===e.type}(P)?(o.enqueue({type:"text-delta",id:P.item_id,delta:P.delta}),(null==(v=null==(_=e.providerOptions)?void 0:_.openai)?void 0:v.logprobs)&&P.logprobs&&d.push(P.logprobs)):function(e){return"response.reasoning_summary_part.added"===e.type}(P)?P.summary_index>0&&(null==(k=g[P.item_id])||k.summaryParts.push(P.summary_index),o.enqueue({type:"reasoning-start",id:`${P.item_id}:${P.summary_index}`,providerMetadata:{openai:{itemId:P.item_id,reasoningEncryptedContent:null!=(b=null==(I=g[P.item_id])?void 0:I.encryptedContent)?b:null}}})):function(e){return"response.reasoning_summary_text.delta"===e.type}(P)?o.enqueue({type:"reasoning-delta",id:`${P.item_id}:${P.summary_index}`,delta:P.delta,providerMetadata:{openai:{itemId:P.item_id}}}):function(e){return"response.completed"===e.type||"response.incomplete"===e.type}(P)?(u=ee({finishReason:null==(Y=P.response.incomplete_details)?void 0:Y.reason,hasFunctionCall:h}),p.inputTokens=P.response.usage.input_tokens,p.outputTokens=P.response.usage.output_tokens,p.totalTokens=P.response.usage.input_tokens+P.response.usage.output_tokens,p.reasoningTokens=null!=(w=null==(j=P.response.usage.output_tokens_details)?void 0:j.reasoning_tokens)?w:void 0,p.cachedInputTokens=null!=(T=null==(x=P.response.usage.input_tokens_details)?void 0:x.cached_tokens)?T:void 0,"string"==typeof P.response.service_tier&&(f=P.response.service_tier)):function(e){return"response.output_text.annotation.added"===e.type}(P)?"url_citation"===P.annotation.type?o.enqueue({type:"source",sourceType:"url",id:null!=(S=null==(q=(O=r.config).generateId)?void 0:q.call(O))?S:(0,n.generateId)(),url:P.annotation.url,title:P.annotation.title}):"file_citation"===P.annotation.type&&o.enqueue({type:"source",sourceType:"document",id:null!=(N=null==(M=(C=r.config).generateId)?void 0:M.call(C))?N:(0,n.generateId)(),mediaType:"text/plain",title:null!=(E=null!=(R=P.annotation.quote)?R:P.annotation.filename)?E:"Document",filename:null!=($=P.annotation.filename)?$:P.annotation.file_id}):function(e){return"error"===e.type}(P)&&o.enqueue({type:"error",error:P}):(c=P.response.id,o.enqueue({type:"response-metadata",id:P.response.id,timestamp:new Date(1e3*P.response.created_at),modelId:P.response.model}))},flush(e){const t={openai:{responseId:c}};d.length>0&&(t.openai.logprobs=d),void 0!==f&&(t.openai.serviceTier=f),e.enqueue({type:"finish",finishReason:u,usage:p,providerMetadata:t})}})),request:{body:t},response:{headers:s}}}},le=s.Ik({input_tokens:s.ai(),input_tokens_details:s.Ik({cached_tokens:s.ai().nullish()}).nullish(),output_tokens:s.ai(),output_tokens_details:s.Ik({reasoning_tokens:s.ai().nullish()}).nullish()}),ue=s.Ik({type:s.eu("response.output_text.delta"),item_id:s.Yj(),delta:s.Yj(),logprobs:ae.nullish()}),pe=s.Ik({type:s.eu("error"),code:s.Yj(),message:s.Yj(),param:s.Yj().nullish(),sequence_number:s.ai()}),de=s.Ik({type:s.k5(["response.completed","response.incomplete"]),response:s.Ik({incomplete_details:s.Ik({reason:s.Yj()}).nullish(),usage:le,service_tier:s.Yj().nullish()})}),ce=s.Ik({type:s.eu("response.created"),response:s.Ik({id:s.Yj(),created_at:s.ai(),model:s.Yj(),service_tier:s.Yj().nullish()})}),me=s.Ik({type:s.eu("response.output_item.added"),output_index:s.ai(),item:s.gM("type",[s.Ik({type:s.eu("message"),id:s.Yj()}),s.Ik({type:s.eu("reasoning"),id:s.Yj(),encrypted_content:s.Yj().nullish()}),s.Ik({type:s.eu("function_call"),id:s.Yj(),call_id:s.Yj(),name:s.Yj(),arguments:s.Yj()}),s.Ik({type:s.eu("web_search_call"),id:s.Yj(),status:s.Yj(),action:s.Ik({type:s.eu("search"),query:s.Yj().optional()}).nullish()}),s.Ik({type:s.eu("computer_call"),id:s.Yj(),status:s.Yj()}),s.Ik({type:s.eu("file_search_call"),id:s.Yj()}),s.Ik({type:s.eu("image_generation_call"),id:s.Yj()}),s.Ik({type:s.eu("code_interpreter_call"),id:s.Yj(),container_id:s.Yj(),code:s.Yj().nullable(),outputs:s.YO(s.gM("type",[s.Ik({type:s.eu("logs"),logs:s.Yj()}),s.Ik({type:s.eu("image"),url:s.Yj()})])).nullable(),status:s.Yj()})])}),he=s.Ik({type:s.eu("response.output_item.done"),output_index:s.ai(),item:s.gM("type",[s.Ik({type:s.eu("message"),id:s.Yj()}),s.Ik({type:s.eu("reasoning"),id:s.Yj(),encrypted_content:s.Yj().nullish()}),s.Ik({type:s.eu("function_call"),id:s.Yj(),call_id:s.Yj(),name:s.Yj(),arguments:s.Yj(),status:s.eu("completed")}),ne,se,te,oe,ie,s.Ik({type:s.eu("computer_call"),id:s.Yj(),status:s.eu("completed")})])}),ge=s.Ik({type:s.eu("response.function_call_arguments.delta"),item_id:s.Yj(),output_index:s.ai(),delta:s.Yj()}),fe=s.Ik({type:s.eu("response.code_interpreter_call_code.delta"),item_id:s.Yj(),output_index:s.ai(),delta:s.Yj()}),ye=s.Ik({type:s.eu("response.code_interpreter_call_code.done"),item_id:s.Yj(),output_index:s.ai(),code:s.Yj()}),_e=s.Ik({type:s.eu("response.output_text.annotation.added"),annotation:s.gM("type",[s.Ik({type:s.eu("url_citation"),url:s.Yj(),title:s.Yj()}),s.Ik({type:s.eu("file_citation"),file_id:s.Yj(),filename:s.Yj().nullish(),index:s.ai().nullish(),start_index:s.ai().nullish(),end_index:s.ai().nullish(),quote:s.Yj().nullish()})])}),ve=s.Ik({type:s.eu("response.reasoning_summary_part.added"),item_id:s.Yj(),summary_index:s.ai()}),ke=s.Ik({type:s.eu("response.reasoning_summary_text.delta"),item_id:s.Yj(),summary_index:s.ai(),delta:s.Yj()}),Ie=s.KC([ue,de,ce,me,he,ge,fe,ye,_e,ve,ke,pe,s.Ik({type:s.Yj()}).loose()]);function be(e){return"response.output_item.done"===e.type}function Ye(e){return"response.output_item.added"===e.type}var je=s.Ik({include:s.YO(s.k5(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:s.Yj().nullish(),logprobs:s.KC([s.zM(),s.ai().min(1).max(20)]).optional(),maxToolCalls:s.ai().nullish(),metadata:s.bz().nullish(),parallelToolCalls:s.zM().nullish(),previousResponseId:s.Yj().nullish(),promptCacheKey:s.Yj().nullish(),reasoningEffort:s.Yj().nullish(),reasoningSummary:s.Yj().nullish(),safetyIdentifier:s.Yj().nullish(),serviceTier:s.k5(["auto","flex","priority"]).nullish(),store:s.zM().nullish(),strictJsonSchema:s.zM().nullish(),textVerbosity:s.k5(["low","medium","high"]).nullish(),user:s.Yj().nullish()}),we=s.Ik({instructions:s.Yj().nullish(),speed:s.ai().min(.25).max(4).default(1).nullish()}),xe=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:o="mp3",speed:i,instructions:s,language:a,providerOptions:r}){const l=[],u=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:r,schema:we}),p={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:i,instructions:s};if(o&&(["mp3","opus","aac","flac","wav","pcm"].includes(o)?p.response_format=o:l.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${o}. Using mp3 instead.`})),u){const e={};for(const t in e){const o=e[t];void 0!==o&&(p[t]=o)}}return a&&l.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:p,warnings:l}}async doGenerate(e){var t,o,i;const s=null!=(i=null==(o=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:o.call(t))?i:new Date,{requestBody:a,warnings:r}=await this.getArgs(e),{value:u,responseHeaders:p,rawValue:d}=await(0,n.postJsonToApi)({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),body:a,failedResponseHandler:l,successfulResponseHandler:(0,n.createBinaryResponseHandler)(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:u,warnings:r,request:{body:JSON.stringify(a)},response:{timestamp:s,modelId:this.modelId,headers:p,body:d}}}},Te=s.Ik({include:s.YO(s.Yj()).optional(),language:s.Yj().optional(),prompt:s.Yj().optional(),temperature:s.ai().min(0).max(1).default(0).optional(),timestampGranularities:s.YO(s.k5(["word","segment"])).default(["segment"]).optional()}),Oe={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},qe=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:o}){const i=await(0,n.parseProviderOptions)({provider:"openai",providerOptions:o,schema:Te}),s=new FormData,a=e instanceof Uint8Array?new Blob([e]):new Blob([(0,n.convertBase64ToUint8Array)(e)]);s.append("model",this.modelId);const r=(0,n.mediaTypeToExtension)(t);if(s.append("file",new File([a],"audio",{type:t}),`audio.${r}`),i){const e={include:i.include,language:i.language,prompt:i.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:i.temperature,timestamp_granularities:i.timestampGranularities};for(const[t,o]of Object.entries(e))if(null!=o)if(Array.isArray(o))for(const e of o)s.append(`${t}[]`,String(e));else s.append(t,String(o))}return{formData:s,warnings:[]}}async doGenerate(e){var t,o,i,s,a,r,u,p;const d=null!=(i=null==(o=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:o.call(t))?i:new Date,{formData:c,warnings:m}=await this.getArgs(e),{value:h,responseHeaders:g,rawValue:f}=await(0,n.postFormDataToApi)({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:(0,n.combineHeaders)(this.config.headers(),e.headers),formData:c,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(Se),abortSignal:e.abortSignal,fetch:this.config.fetch}),y=null!=h.language&&h.language in Oe?Oe[h.language]:void 0;return{text:h.text,segments:null!=(u=null!=(r=null==(s=h.segments)?void 0:s.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))?r:null==(a=h.words)?void 0:a.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?u:[],language:y,durationInSeconds:null!=(p=h.duration)?p:void 0,warnings:m,response:{timestamp:d,modelId:this.modelId,headers:g,body:f}}}},Se=s.Ik({text:s.Yj(),language:s.Yj().nullish(),duration:s.ai().nullish(),words:s.YO(s.Ik({word:s.Yj(),start:s.ai(),end:s.ai()})).nullish(),segments:s.YO(s.Ik({id:s.ai(),seek:s.ai(),start:s.ai(),end:s.ai(),text:s.Yj(),tokens:s.YO(s.ai()),temperature:s.ai(),avg_logprob:s.ai(),compression_ratio:s.ai(),no_speech_prob:s.ai()})).nullish()}),Ce="2.0.44";function Me(e={}){var t,o;const i=null!=(t=(0,n.withoutTrailingSlash)((0,n.loadOptionalSetting)({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))?t:"https://api.openai.com/v1",s=null!=(o=e.name)?o:"openai",a=()=>(0,n.withUserAgentSuffix)({Authorization:`Bearer ${(0,n.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},`ai-sdk/openai/${Ce}`),r=t=>new T(t,{provider:`${s}.embedding`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),l=t=>new C(t,{provider:`${s}.image`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),u=t=>new qe(t,{provider:`${s}.transcription`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),p=t=>new xe(t,{provider:`${s}.speech`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),d=e=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return m(e)},m=t=>new re(t,{provider:`${s}.responses`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch,fileIdPrefixes:["file-"]}),h=function(e){return d(e)};return h.languageModel=d,h.chat=t=>new c(t,{provider:`${s}.chat`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),h.completion=t=>new b(t,{provider:`${s}.completion`,url:({path:e})=>`${i}${e}`,headers:a,fetch:e.fetch}),h.responses=m,h.embedding=r,h.textEmbedding=r,h.textEmbeddingModel=r,h.image=l,h.imageModel=l,h.transcription=u,h.transcriptionModel=u,h.speech=p,h.speechModel=p,h.tools=Z,h}var Ne=Me()}}]);