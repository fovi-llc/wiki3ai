"use strict";(self.webpackChunkjupyterlab_browser_ai=self.webpackChunkjupyterlab_browser_ai||[]).push([[509],{509:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var r=o(560),a=o(986),n=o(762),i=o(694),s=o(249),c=o(279),l=o(368),d=o(516),u=o(190);async function p(e){const t=await e.arrayBuffer(),o=new Uint8Array(t);let r="";for(let e=0;e<o.length;e+=8192){const t=o.slice(e,e+8192);r+=String.fromCharCode(...t)}return btoa(r)}const m={id:"jupyterlab-browser-ai:plugin",description:"In-browser AI in JupyterLab and Jupyter Notebook",autoStart:!0,requires:[c.IProviderRegistry],optional:[r.ISettingRegistry],activate:(e,t,r)=>{if((0,l.doesBrowserSupportBuiltInAI)()){const e={id:"chrome-ai",name:"Chrome Built-in AI",apiKeyRequirement:"none",defaultModels:["chrome-ai"],supportsBaseURL:!1,supportsHeaders:!1,supportsToolCalling:!1,factory:()=>(0,l.builtInAI)("text")};t.registerProvider(e)}if((0,d.doesBrowserSupportWebLLM)()){const e={id:"web-llm",name:"WebLLM",apiKeyRequirement:"none",defaultModels:["Llama-3.2-3B-Instruct-q4f16_1-MLC","Llama-3.2-1B-Instruct-q4f16_1-MLC","Phi-3.5-mini-instruct-q4f16_1-MLC","gemma-2-2b-it-q4f16_1-MLC","Qwen3-0.6B-q4f16_1-MLC"],supportsBaseURL:!1,supportsHeaders:!1,supportsToolCalling:!1,factory:e=>{var t;const r=null!==(t=e.model)&&void 0!==t?t:"Llama-3.2-3B-Instruct-q4f16_1-MLC";let n=null;const i=(0,d.webLLM)(r,{worker:new Worker(new URL(o.p+o.u(143),o.b),{type:void 0}),initProgressCallback:e=>{var t;const o=Math.round(100*e.progress);null===n?n=a.Notification.emit(null!==(t=e.text)&&void 0!==t?t:`Downloading ${r}...`,"in-progress",{progress:0,autoClose:!1}):100===o?n&&a.Notification.update({id:n,message:`${r} ready`,type:"success",progress:1,autoClose:3e3}):n&&a.Notification.update({id:n,message:`Downloading ${r}... ${o}%`,progress:e.progress})}});return i}};t.registerProvider(e)}r&&r.load(m.id).then(e=>{console.log("jupyterlab-browser-ai settings loaded:",e.composite)}).catch(e=>{console.error("Failed to load settings for jupyterlab-browser-ai.",e)})}};var f;!function(e){e.generateAltText="chrome-ai:generate-alt-text",e.generateTranscript="chrome-ai:generate-transcript",e.proofreadNotebook="chrome-ai:proofread-notebook"}(f||(f={}));class g{async generateAltText(e){try{const t=await fetch(e),o=await t.blob(),r=await p(o),a=(0,u.gM)({model:(0,l.builtInAI)(),messages:[{role:"user",content:[{type:"text",text:'Generate a concise alt text description for this image. Focus on the most important visual elements and keep it under 125 characters. Do not include phrases like "an image of" or "a picture showing".'},{type:"file",mediaType:o.type||"image/png",data:r}]}]});let n="";for await(const e of a.textStream)n+=e;return n}catch(e){throw console.error("Failed to generate alt text:",e),e}}}class y{async generateTranscript(e){try{const t=await fetch(e),o=await t.blob(),r=await p(o),a=(0,u.gM)({model:(0,l.builtInAI)(),messages:[{role:"user",content:[{type:"text",text:"Please transcribe this audio file. Provide only the transcribed text without any additional commentary or formatting."},{type:"file",mediaType:o.type||"audio/mp3",data:r}]}]});let n="";for await(const e of a.textStream)n+=e;return n.trim()}catch(e){throw console.error("Failed to generate transcript:",e),e}}}const w={id:"jupyterlab-browser-ai:alt-text-generator",description:"Chrome AI Alt Text Generator Context Menu",autoStart:!0,requires:[n.INotebookTracker],activate:(e,t)=>{if(!(0,l.doesBrowserSupportBuiltInAI)())return void console.log("Chrome Built-in AI not supported in this browser");const o=new g,r=e=>"IMG"===e.tagName;e.commands.addCommand(f.generateAltText,{label:"Generate Alt Text with ChromeAI",icon:i.imageIcon,execute:async()=>{const n=e.contextMenuHitTest(r);if(!n)return;const i=n.src,s=a.Notification.emit("Generating alt text with ChromeAI...","in-progress",{autoClose:!1});try{const e=await o.generateAltText(i),r=await async function(e,t,o){try{const r=o.currentWidget;if(!r)return!1;const a=r.content;let n=a.activeCell;if(!n||"markdown"!==n.model.type){let t=null,o=-1;for(let r=0;r<a.widgets.length;r++){const n=a.widgets[r];if("markdown"===n.model.type){const a=n.node.querySelectorAll("img");for(const i of a)if(i.src===e.src){t=n,o=r;break}}if(t)break}if(!t)return!1;a.activeCellIndex=o,n=t}const i=n.model.sharedModel,s=i.getSource(),c=/!\[([^\]]*)\]\(([^)]+)\)/g;let l=0,d=!1;const u=s.replace(c,(e,o,r)=>(l++,d||""!==o.trim()&&1!==l?e:(d=!0,`![${t}](${r})`)));return u!==s&&(i.setSource(u),!0)}catch(e){return console.error("Failed to update image alt text:",e),!1}}(n,e,t);a.Notification.update({id:s,message:r?"Alt text generated and applied to markdown cell":"Alt text generated - copied to clipboard",type:"success",autoClose:3e3}),navigator.clipboard&&await navigator.clipboard.writeText(e)}catch(e){console.error("ChromeAI Alt Text Generation Error:",e),a.Notification.update({id:s,message:`Failed to generate alt text: ${e instanceof Error?e.message:"Unknown error"}`,type:"error",autoClose:5e3})}},describedBy:{args:{type:"object",properties:{}}}}),e.contextMenu.addItem({command:f.generateAltText,selector:"img",rank:1})}};function h(e){return[".mp3",".wav",".ogg",".m4a",".aac",".flac",".opus"].some(t=>e.toLowerCase().endsWith(t))}const b={id:"jupyterlab-browser-ai:audio-transcript-generator",description:"Chrome AI Audio Transcript Generator",autoStart:!0,requires:[s.IFileBrowserFactory],activate:(e,t)=>{if(!(0,l.doesBrowserSupportBuiltInAI)())return void console.log("Chrome Built-in AI not supported in this browser");const o=new y,{serviceManager:r}=e;e.commands.addCommand(f.generateTranscript,{label:"Generate Transcript with ChromeAI",icon:i.textEditorIcon,isVisible:()=>function(e){const t=e.tracker.currentWidget;if(!t)return!1;const o=Array.from(t.selectedItems());return 1===o.length&&h(o[0].name)}(t),execute:async()=>{const n=t.tracker.currentWidget;if(!n)return void a.Notification.emit("No file browser available","warning");const i=Array.from(n.selectedItems());if(1!==i.length)return void a.Notification.emit("Please select a single audio file","warning");const s=i[0];if(!h(s.name))return void a.Notification.emit("Selected file is not an audio file","warning");const c=s.path,l=await r.contents.getDownloadUrl(c),d=a.Notification.emit("Generating transcript with ChromeAI...","in-progress",{autoClose:!1});try{const t=await o.generateTranscript(l),i=`${s.name.replace(/\.[^/.]+$/,"")}_transcript.txt`,u=c.replace(s.name,i);await r.contents.save(u,{type:"file",format:"text",content:t}),a.Notification.update({id:d,message:`Transcript saved as ${i}`,type:"success",autoClose:3e3,actions:[{label:"Open",callback:async()=>{await e.commands.execute("docmanager:open",{path:u})}}]}),await n.model.refresh()}catch(e){console.error("ChromeAI Transcript Generation Error:",e),a.Notification.update({id:d,message:`Failed to generate transcript: ${e instanceof Error?e.message:"Unknown error"}`,type:"error",autoClose:5e3})}}}),e.contextMenu.addItem({command:f.generateTranscript,selector:".jp-DirListing-item[data-file-type]",rank:2})}};class x{async summarizeNotebook(e,t){const o=await t.serviceManager.contents.get(e,{content:!0});if("notebook"!==o.type)throw new Error("Not a notebook file");const r=o.content.cells||[],a=[];for(const e of r){const t="string"==typeof e.source?e.source:(e.source||[]).join("");if("markdown"===e.cell_type&&t.trim())a.push(`[Markdown]\n${t}`);else if("code"===e.cell_type&&t.trim()&&(a.push(`[Code]\n${t}`),e.outputs&&e.outputs.length>0)){const t=e.outputs.filter(e=>{var t;return e.text||(null===(t=e.data)||void 0===t?void 0:t["text/plain"])}).map(e=>{var t;return e.text||(null===(t=e.data)||void 0===t?void 0:t["text/plain"])}).join("\n");t&&a.push(`[Output]\n${t}`)}}const n=a.join("\n\n");if(!n.trim())return"No summary available: notebook is empty";if(!("Summarizer"in window))throw new Error("Summarizer API not available");if("unavailable"===await Summarizer.availability())throw new Error("Summarizer API is not available");const i=await Summarizer.create({type:"tldr",format:"plain-text",length:"medium",sharedContext:"en"}),s=await i.summarize(n);return i.destroy(),s}async summarizeTextFile(e,t){const o=await t.serviceManager.contents.get(e,{content:!0});if("file"!==o.type)throw new Error("Not a file");const r=o.content;if(!r.trim())return"Empty file";if(!("Summarizer"in window))throw new Error("Summarizer API not available");if("unavailable"===await Summarizer.availability())throw new Error("Summarizer API is not available");const a=await Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:"en"}),n=await a.summarize(r);return a.destroy(),n}}const v={id:"jupyterlab-browser-ai:notebook-proofreader",description:"Chrome AI Notebook Proofreader",autoStart:!0,requires:[n.INotebookTracker],optional:[a.ICommandPalette],activate:(e,t,o)=>{"undefined"!=typeof window&&"Proofreader"in window?(e.commands.addCommand(f.proofreadNotebook,{label:"Proofread Notebook",caption:"Proofread all markdown cells in the notebook",icon:i.textEditorIcon,execute:async()=>{const e=t.currentWidget;if(!e)return void a.Notification.emit("No notebook open","warning");const o=e.content,r=[];for(let e=0;e<o.widgets.length;e++){const t=o.widgets[e];"markdown"===t.model.type&&r.push(t)}if(0===r.length)return void a.Notification.emit("No markdown cells found","info");const n=a.Notification.emit("Proofreading notebook...","in-progress",{autoClose:!1});try{const e=await Proofreader.create({expectedInputLanguages:["en"]});let t=0,o=0;for(const a of r){const r=a.model.sharedModel,n=r.getSource();if(""===n.trim())continue;const i=await e.proofread(n);i.corrections.length>0&&i.correctedInput!==n&&(r.setSource(i.correctedInput),t+=i.corrections.length,o++)}e.destroy(),0===t?a.Notification.update({id:n,message:"No corrections needed",type:"success",autoClose:3e3}):a.Notification.update({id:n,message:`✓ Made ${t} correction${t>1?"s":""} across ${o} cell${o>1?"s":""}`,type:"success",autoClose:5e3})}catch(e){console.error("Proofreading Error:",e),a.Notification.update({id:n,message:`Failed to proofread: ${e instanceof Error?e.message:"Unknown error"}`,type:"error",autoClose:5e3})}}}),o&&o.addItem({command:f.proofreadNotebook,category:"Notebook Operations"})):console.log("Chrome Proofreader API not supported in this browser")}},C={id:"jupyterlab-browser-ai:file-summarizer",description:"Chrome AI File Summarizer with Inline Badges",autoStart:!0,requires:[s.IFileBrowserFactory],activate:(e,t)=>{if("undefined"==typeof window||!("Summarizer"in window))return void console.log("Chrome Summarizer API not supported in this browser");const o=new x,r=new Map,a=new WeakMap;let n=null,i=null,s=null;e.serviceManager.contents.fileChanged.connect((e,t)=>{if("save"===t.type&&t.newValue){const e=t.newValue.path;e&&r.has(e)&&(console.log(`Invalidating cache for modified file: ${e}`),r.delete(e))}});const c=(e,t,o)=>{const r=(n||(n=document.createElement("div"),n.className="jp-ai-summary-tooltip",n.style.position="fixed",n.style.backgroundColor="var(--jp-layout-color1)",n.style.border="1px solid var(--jp-border-color1)",n.style.borderRadius="4px",n.style.padding="8px 12px",n.style.maxWidth="400px",n.style.fontSize="12px",n.style.lineHeight="1.4",n.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.15)",n.style.zIndex="10000",n.style.pointerEvents="auto",n.style.display="none",n.style.color="var(--jp-ui-font-color1)",n.style.cursor="default",document.body.appendChild(n),document.addEventListener("click",e=>{if(n&&"none"!==n.style.display){const t=e.target;n.contains(t)||t.classList.contains("jp-ai-summary-badge")||l()}})),n);r.textContent=e,r.style.display="block",r.style.left=`${t+10}px`,r.style.top=`${o+10}px`},l=()=>{n&&(n.style.display="none"),i=null,s&&(clearTimeout(s),s=null)},d=()=>{const n=t.tracker.currentWidget;if(!n)return;const s=n.node.querySelector(".jp-DirListing-content");s&&s.querySelectorAll(".jp-DirListing-item").forEach(t=>{if(a.has(t))return;const s=t.querySelector(".jp-DirListing-itemText");if(!s)return;const l=s.textContent||"";if(!((e,t)=>!t&&(e.endsWith(".ipynb")||e.endsWith(".md")||e.endsWith(".txt")||e.endsWith(".py")||e.endsWith(".js")||e.endsWith(".ts")))(l,null!==t.querySelector(".jp-FolderIcon")))return;const d=((t,a,n)=>{const s=document.createElement("span");return s.className="jp-ai-summary-badge",s.textContent="✨",s.title="Click to view AI summary",s.style.cursor="pointer",s.style.marginLeft="6px",s.style.opacity="0.7",s.style.fontSize="14px",s.style.transition="opacity 0.2s",s.addEventListener("mouseenter",()=>{s.style.opacity="1"}),s.addEventListener("mouseleave",()=>{s.style.opacity="0.7"}),s.addEventListener("click",async t=>{t.stopPropagation(),t.preventDefault(),i=n;const l=s.getBoundingClientRect(),d=l.right,u=l.bottom;c("Loading summary...",d,u);try{let t;r.has(n)?(t=r.get(n),c(t,d,u)):(t=a.endsWith(".ipynb")?await o.summarizeNotebook(n,e):await o.summarizeTextFile(n,e),r.set(n,t),i===n&&c(t,d,u))}catch(e){console.error("Failed to generate summary:",e),i===n&&c("Failed to generate summary",d,u)}}),s})(0,l,n.model.path?`${n.model.path}/${l}`:l);s.appendChild(d),a.set(t,d)})},u=()=>{const e=t.tracker.currentWidget;e&&(e.model.fileChanged.connect(()=>{d()}),e.model.pathChanged.connect(()=>{d()}),e.model.refreshed.connect(()=>{d()}),d())};e.restored.then(()=>{u(),t.tracker.currentChanged.connect(()=>{u()})})}},I=[m,w,b,v,C]}}]);