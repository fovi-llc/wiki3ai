"use strict";(self.webpackChunkjupyterlab_browser_ai=self.webpackChunkjupyterlab_browser_ai||[]).push([[635],{245:t=>{var e,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((t,e)=>{for(var r in e)n(t,r,{get:e[r],enumerable:!0})})(s,{AISDKError:()=>f,APICallError:()=>m,EmptyResponseBodyError:()=>S,InvalidArgumentError:()=>P,InvalidPromptError:()=>U,InvalidResponseDataError:()=>F,JSONParseError:()=>D,LoadAPIKeyError:()=>H,LoadSettingError:()=>Q,NoContentGeneratedError:()=>rt,NoSuchModelError:()=>ut,TooManyEmbeddingValuesForCallError:()=>dt,TypeValidationError:()=>vt,UnsupportedFunctionalityError:()=>At,getErrorMessage:()=>_,isJSONArray:()=>Et,isJSONObject:()=>Tt,isJSONValue:()=>It}),t.exports=(e=s,((t,e,s,a)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of o(e))i.call(t,s)||undefined===s||n(t,s,{get:()=>e[s],enumerable:!(a=r(e,s))||a.enumerable});return t})(n({},"__esModule",{value:!0}),e));var a,u="vercel.ai.error",c=Symbol.for(u),l=class t extends Error{constructor({name:t,message:e,cause:n}){super(e),this[a]=!0,this.name=t,this.cause=n}static isInstance(e){return t.hasMarker(e,u)}static hasMarker(t,e){const n=Symbol.for(e);return null!=t&&"object"==typeof t&&n in t&&"boolean"==typeof t[n]&&!0===t[n]}};a=c;var h,f=l,d="AI_APICallError",g=`vercel.ai.error.${d}`,p=Symbol.for(g),m=class extends f{constructor({message:t,url:e,requestBodyValues:n,statusCode:r,responseHeaders:o,responseBody:i,cause:s,isRetryable:a=null!=r&&(408===r||409===r||429===r||r>=500),data:u}){super({name:d,message:t,cause:s}),this[h]=!0,this.url=e,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=o,this.responseBody=i,this.isRetryable=a,this.data=u}static isInstance(t){return f.hasMarker(t,g)}};h=p;var y,b="AI_EmptyResponseBodyError",v=`vercel.ai.error.${b}`,w=Symbol.for(v),S=class extends f{constructor({message:t="Empty response body"}={}){super({name:b,message:t}),this[y]=!0}static isInstance(t){return f.hasMarker(t,v)}};function _(t){return null==t?"unknown error":"string"==typeof t?t:t instanceof Error?t.message:JSON.stringify(t)}y=w;var A,I="AI_InvalidArgumentError",E=`vercel.ai.error.${I}`,T=Symbol.for(E),P=class extends f{constructor({message:t,cause:e,argument:n}){super({name:I,message:t,cause:e}),this[A]=!0,this.argument=n}static isInstance(t){return f.hasMarker(t,E)}};A=T;var x,O="AI_InvalidPromptError",B=`vercel.ai.error.${O}`,k=Symbol.for(B),U=class extends f{constructor({prompt:t,message:e,cause:n}){super({name:O,message:`Invalid prompt: ${e}`,cause:n}),this[x]=!0,this.prompt=t}static isInstance(t){return f.hasMarker(t,B)}};x=k;var L,M="AI_InvalidResponseDataError",N=`vercel.ai.error.${M}`,j=Symbol.for(N),F=class extends f{constructor({data:t,message:e=`Invalid response data: ${JSON.stringify(t)}.`}){super({name:M,message:e}),this[L]=!0,this.data=t}static isInstance(t){return f.hasMarker(t,N)}};L=j;var V,C="AI_JSONParseError",$=`vercel.ai.error.${C}`,G=Symbol.for($),D=class extends f{constructor({text:t,cause:e}){super({name:C,message:`JSON parsing failed: Text: ${t}.\nError message: ${_(e)}`,cause:e}),this[V]=!0,this.text=t}static isInstance(t){return f.hasMarker(t,$)}};V=G;var R,z="AI_LoadAPIKeyError",q=`vercel.ai.error.${z}`,W=Symbol.for(q),H=class extends f{constructor({message:t}){super({name:z,message:t}),this[R]=!0}static isInstance(t){return f.hasMarker(t,q)}};R=W;var J,K="AI_LoadSettingError",X=`vercel.ai.error.${K}`,Y=Symbol.for(X),Q=class extends f{constructor({message:t}){super({name:K,message:t}),this[J]=!0}static isInstance(t){return f.hasMarker(t,X)}};J=Y;var Z,tt="AI_NoContentGeneratedError",et=`vercel.ai.error.${tt}`,nt=Symbol.for(et),rt=class extends f{constructor({message:t="No content generated."}={}){super({name:tt,message:t}),this[Z]=!0}static isInstance(t){return f.hasMarker(t,et)}};Z=nt;var ot,it="AI_NoSuchModelError",st=`vercel.ai.error.${it}`,at=Symbol.for(st),ut=class extends f{constructor({errorName:t=it,modelId:e,modelType:n,message:r=`No such ${n}: ${e}`}){super({name:t,message:r}),this[ot]=!0,this.modelId=e,this.modelType=n}static isInstance(t){return f.hasMarker(t,st)}};ot=at;var ct,lt="AI_TooManyEmbeddingValuesForCallError",ht=`vercel.ai.error.${lt}`,ft=Symbol.for(ht),dt=class extends f{constructor(t){super({name:lt,message:`Too many values for a single embedding call. The ${t.provider} model "${t.modelId}" can only embed up to ${t.maxEmbeddingsPerCall} values per call, but ${t.values.length} values were provided.`}),this[ct]=!0,this.provider=t.provider,this.modelId=t.modelId,this.maxEmbeddingsPerCall=t.maxEmbeddingsPerCall,this.values=t.values}static isInstance(t){return f.hasMarker(t,ht)}};ct=ft;var gt,pt="AI_TypeValidationError",mt=`vercel.ai.error.${pt}`,yt=Symbol.for(mt);gt=yt;var bt,vt=class t extends f{constructor({value:t,cause:e}){super({name:pt,message:`Type validation failed: Value: ${JSON.stringify(t)}.\nError message: ${_(e)}`,cause:e}),this[gt]=!0,this.value=t}static isInstance(t){return f.hasMarker(t,mt)}static wrap({value:e,cause:n}){return t.isInstance(n)&&n.value===e?n:new t({value:e,cause:n})}},wt="AI_UnsupportedFunctionalityError",St=`vercel.ai.error.${wt}`,_t=Symbol.for(St),At=class extends f{constructor({functionality:t,message:e=`'${t}' functionality not supported.`}){super({name:wt,message:e}),this[bt]=!0,this.functionality=t}static isInstance(t){return f.hasMarker(t,St)}};function It(t){return null===t||"string"==typeof t||"number"==typeof t||"boolean"==typeof t||(Array.isArray(t)?t.every(It):"object"==typeof t&&Object.entries(t).every(([t,e])=>"string"==typeof t&&It(e)))}function Et(t){return Array.isArray(t)&&t.every(It)}function Tt(t){return null!=t&&"object"==typeof t&&Object.entries(t).every(([t,e])=>"string"==typeof t&&It(e))}bt=_t},635:(t,e,n)=>{var r,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,u={};((t,e)=>{for(var n in e)o(t,n,{get:e[n],enumerable:!0})})(u,{BuiltInAIChatLanguageModel:()=>p,BuiltInAIEmbeddingModel:()=>y,builtInAI:()=>w,createBuiltInAI:()=>v,doesBrowserSupportBuiltInAI:()=>f,isBuiltInAIModelAvailable:()=>d}),t.exports=(r=u,((t,e,n,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let n of s(e))a.call(t,n)||undefined===n||o(t,n,{get:()=>e[n],enumerable:!(r=i(e,n))||r.enumerable});return t})(o({},"__esModule",{value:!0}),r));var c=n(245),l=n(245);function h(t,e){return t instanceof URL?t.toString():t instanceof Uint8Array?t:"string"==typeof t?function(t){try{const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}catch(t){throw new Error(`Failed to convert base64 to Uint8Array: ${t}`)}}(t):(console.warn(`Unexpected data type for ${e}:`,typeof t),t)}function f(){return"undefined"!=typeof LanguageModel}function d(){return"undefined"!=typeof LanguageModel}function g(t){const e=new Set;for(const n of t)if("user"===n.role)for(const t of n.content)"file"===t.type&&(t.mediaType?.startsWith("image/")?e.add("image"):t.mediaType?.startsWith("audio/")&&e.add("audio"));return Array.from(e).map(t=>({type:t}))}var p=class{constructor(t,e={}){this.specificationVersion="v2",this.provider="browser-ai",this.supportedUrls={"image/*":[/^https?:\/\/.+$/],"audio/*":[/^https?:\/\/.+$/]},this.modelId=t,this.config={provider:this.provider,modelId:t,options:e}}async getSession(t,e,n,r){if("undefined"==typeof LanguageModel)throw new c.LoadSettingError({message:"Prompt API is not available. This library requires Chrome or Edge browser with built-in AI capabilities."});if(this.session)return this.session;if("unavailable"===await LanguageModel.availability())throw new c.LoadSettingError({message:"Built-in model not available"});const o={...this.config.options,...t};return n&&(o.initialPrompts=[{role:"system",content:n}]),e&&e.length>0&&(o.expectedInputs=e),r&&(o.monitor=t=>{t.addEventListener("downloadprogress",t=>{r(t.loaded)})}),this.session=await LanguageModel.create(o),this.session}getArgs({prompt:t,maxOutputTokens:e,temperature:n,topP:r,topK:o,frequencyPenalty:i,presencePenalty:s,stopSequences:a,responseFormat:u,seed:c,tools:f}){const d=[];f&&f.length>0&&d.push({type:"unsupported-setting",setting:"tools",details:"Tool calling is not yet supported by Prompt API"}),null!=e&&d.push({type:"unsupported-setting",setting:"maxOutputTokens",details:"maxOutputTokens is not supported by Prompt API"}),null!=a&&d.push({type:"unsupported-setting",setting:"stopSequences",details:"stopSequences is not supported by Prompt API"}),null!=r&&d.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported by Prompt API"}),null!=s&&d.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported by Prompt API"}),null!=i&&d.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported by Prompt API"}),null!=c&&d.push({type:"unsupported-setting",setting:"seed",details:"seed is not supported by Prompt API"});const p=function(t){for(const e of t)if("user"===e.role)for(const t of e.content)if("file"===t.type)return!0;return!1}(t),{systemMessage:m,messages:y}=function(t){let e;const n=[];for(const r of t)switch(r.role){case"system":e=r.content;break;case"user":n.push({role:"user",content:r.content.map(t=>{switch(t.type){case"text":return{type:"text",value:t.text};case"file":{const{mediaType:e,data:n,filename:r}=t;if(e?.startsWith("image/"))return{type:"image",value:h(n,e)};if(e?.startsWith("audio/"))return{type:"audio",value:h(n,e)};throw new l.UnsupportedFunctionalityError({functionality:`file type: ${e}`})}default:throw new l.UnsupportedFunctionalityError({functionality:`content type: ${t.type}`})}})});break;case"assistant":{let t="";for(const e of r.content)switch(e.type){case"text":t+=e.text;break;case"tool-call":throw new l.UnsupportedFunctionalityError({functionality:"tool calls"})}n.push({role:"assistant",content:t});break}case"tool":throw new l.UnsupportedFunctionalityError({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${r.role}`)}return{systemMessage:e,messages:n}}(t),b={};return"json"===u?.type&&(b.responseConstraint=u.schema),void 0!==n&&(b.temperature=n),void 0!==o&&(b.topK=o),{systemMessage:m,messages:y,warnings:d,promptOptions:b,hasMultiModalInput:p,expectedInputs:p?g(t):void 0}}async doGenerate(t){const e=this.getArgs(t),{systemMessage:n,messages:r,warnings:o,promptOptions:i,expectedInputs:s}=e,a=await this.getSession(void 0,s,n);return{content:[{type:"text",text:await a.prompt(r,i)}],finishReason:"stop",usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},request:{body:{messages:r,options:i}},warnings:o}}async availability(){return"undefined"==typeof LanguageModel?"unavailable":LanguageModel.availability()}async createSessionWithProgress(t){return this.getSession(void 0,void 0,void 0,t)}async doStream(t){const e=this.getArgs(t),{systemMessage:n,messages:r,warnings:o,promptOptions:i,expectedInputs:s,hasMultiModalInput:a}=e,u=await this.getSession(void 0,s,n),c={...i,signal:t.abortSignal},l=u.promptStreaming(r,c);let h=!0;const f="text-0";return{stream:l.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o}),t.abortSignal&&t.abortSignal.addEventListener("abort",()=>{e.terminate()})},transform(t,e){h&&(e.enqueue({type:"text-start",id:f}),h=!1),e.enqueue({type:"text-delta",id:f,delta:t})},flush(t){t.enqueue({type:"text-end",id:f}),t.enqueue({type:"finish",finishReason:"stop",usage:{inputTokens:u.inputUsage,outputTokens:void 0,totalTokens:void 0}})}})),request:{body:{messages:r,options:i}}}}},m=n(882),y=class{constructor(t={}){this.specificationVersion="v2",this.provider="google-mediapipe",this.modelId="embedding",this.supportsParallelCalls=!0,this.maxEmbeddingsPerCall=void 0,this.settings={wasmLoaderPath:"https://pub-ddcfe353995744e89b8002f16bf98575.r2.dev/text_wasm_internal.js",wasmBinaryPath:"https://pub-ddcfe353995744e89b8002f16bf98575.r2.dev/text_wasm_internal.wasm",modelAssetPath:"https://pub-ddcfe353995744e89b8002f16bf98575.r2.dev/universal_sentence_encoder.tflite",l2Normalize:!1,quantize:!1},this.getTextEmbedder=async()=>m.TextEmbedder.createFromOptions({wasmBinaryPath:this.settings.wasmBinaryPath,wasmLoaderPath:this.settings.wasmLoaderPath},{baseOptions:{modelAssetBuffer:await this.modelAssetBuffer,delegate:this.settings.delegate},l2Normalize:this.settings.l2Normalize,quantize:this.settings.quantize}),this.doEmbed=async t=>{if(t.abortSignal?.aborted)throw new Error("Operation was aborted");const e=await this.textEmbedder;return{embeddings:t.values.map(t=>{const n=e.embed(t),[r]=n.embeddings;return r?.floatEmbedding??[]}),rawResponse:{model:"universal_sentence_encoder",provider:"google-mediapipe",processed_texts:t.values.length}}},this.settings={...this.settings,...t},this.modelAssetBuffer=fetch(this.settings.modelAssetPath).then(t=>t.body.getReader()),this.textEmbedder=this.getTextEmbedder()}},b=n(245);function v(t={}){const e=(t,e)=>new p(t,e),n=(t,e)=>new y(e),r=function(t="text",n){if(new.target)throw new Error("The BuiltInAI model function cannot be called with the new keyword.");return e(t,n)};return r.languageModel=e,r.chat=e,r.textEmbedding=n,r.textEmbeddingModel=n,r.imageModel=t=>{throw new b.NoSuchModelError({modelId:t,modelType:"imageModel"})},r.speechModel=t=>{throw new b.NoSuchModelError({modelId:t,modelType:"speechModel"})},r.transcriptionModel=t=>{throw new b.NoSuchModelError({modelId:t,modelType:"transcriptionModel"})},r}var w=v()},882:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n="undefined"!=typeof self?self:{};function r(){throw Error("Invalid UTF8")}function o(t,e){return e=String.fromCharCode.apply(null,e),null==t?e:t+e}let i,s;const a="undefined"!=typeof TextDecoder;let u;const c="undefined"!=typeof TextEncoder;function l(t){if(c)t=(u||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let o=0;o<t.length;o++){var e=t.charCodeAt(o);if(e<128)r[n++]=e;else{if(e<2048)r[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&o<t.length){const i=t.charCodeAt(++o);if(i>=56320&&i<=57343){e=1024*(e-55296)+i-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}o--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var h,f;t:{for(var d=["CLOSURE_FLAGS"],g=n,p=0;p<d.length;p++)if(null==(g=g[d[p]])){f=null;break t}f=g}var m,y=f&&f[610401301];h=null!=y&&y;const b=n.navigator;function v(t){return!!h&&!!m&&m.brands.some(({brand:e})=>e&&-1!=e.indexOf(t))}function w(t){var e;return(e=n.navigator)&&(e=e.userAgent)||(e=""),-1!=e.indexOf(t)}function S(){return!!h&&!!m&&m.brands.length>0}function _(){return S()?v("Chromium"):(w("Chrome")||w("CriOS"))&&!(!S()&&w("Edge"))||w("Silk")}function A(t){return A[" "](t),t}m=b&&b.userAgentData||null,A[" "]=function(){};var I=!S()&&(w("Trident")||w("MSIE"));!w("Android")||_(),_(),w("Safari")&&(_()||!S()&&w("Coast")||!S()&&w("Opera")||!S()&&w("Edge")||(S()?v("Microsoft Edge"):w("Edg/"))||S()&&v("Opera"));var E={},T=null;function P(){if(!T){T={};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const r=t.concat(e[n].split(""));E[n]=r;for(let t=0;t<r.length;t++){const e=r[t];void 0===T[e]&&(T[e]=t)}}}}var x="undefined"!=typeof Uint8Array,O=!I&&"function"==typeof btoa;function B(t){if(!O){var e;void 0===e&&(e=0),P(),e=E[e];var n=Array(Math.floor(t.length/3)),r=e[64]||"";let u=0,c=0;for(;u<t.length-2;u+=3){var o=t[u],i=t[u+1],s=t[u+2],a=e[o>>2];o=e[(3&o)<<4|i>>4],i=e[(15&i)<<2|s>>6],s=e[63&s],n[c++]=a+o+i+s}switch(a=0,s=r,t.length-u){case 2:s=e[(15&(a=t[u+1]))<<2]||r;case 1:t=t[u],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+s+r}return n.join("")}for(e="",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const k=/[-_.]/g,U={"-":"+",_:"/",".":"="};function L(t){return U[t]||""}function M(t){if(!O)return function(t){const e=t.length;let n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);const r=new Uint8Array(n);let o=0;return function(t,e){function n(e){for(;r<t.length;){const e=t.charAt(r++),n=T[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return e}P();let r=0;for(;;){const t=n(-1),r=n(0),o=n(64),i=n(64);if(64===i&&-1===t)break;e(t<<2|r>>4),64!=o&&(e(r<<4&240|o>>2),64!=i&&e(o<<6&192|i))}}(t,function(t){r[o++]=t}),o!==n?r.subarray(0,o):r}(t);k.test(t)&&(t=t.replace(k,L)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function N(t){return x&&null!=t&&t instanceof Uint8Array}var j={};function F(){return $||=new C(null,j)}function V(t){D(j);var e=t.g;return null==(e=null==e||N(e)?e:"string"==typeof e?M(e):null)?e:t.g=e}var C=class{i(){return new Uint8Array(V(this)||0)}constructor(t,e){if(D(e),this.g=t,null!=t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}};let $,G;function D(t){if(t!==j)throw Error("illegal external caller")}function R(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function z(){const t=Error("int32");return R(t,"warning"),t}function q(t){if(null!=t){var e=G??={},r=e[t]||0;r>=5||(e[t]=r+1,R(t=Error(),"incident"),function(t){n.setTimeout(()=>{throw t},0)}(t))}}var W="function"==typeof Symbol&&"symbol"==typeof Symbol();function H(t,e,n=!1){return"function"==typeof Symbol&&"symbol"==typeof Symbol()?n&&Symbol.for&&t?Symbol.for(t):null!=t?Symbol(t):Symbol():e}var J=H("jas",void 0,!0),K=H(void 0,"1oa"),X=H(void 0,Symbol()),Y=H(void 0,"0actk"),Q=H(void 0,"8utk");const Z=W?J:"L",tt={L:{value:0,configurable:!0,writable:!0,enumerable:!1}},et=Object.defineProperties;function nt(t,e){W||Z in t||et(t,tt),t[Z]|=e}function rt(t,e){W||Z in t||et(t,tt),t[Z]=e}function ot(t,e){rt(e,-15615&t)}function it(t,e){rt(e,-15581&t|34)}function st(){return"function"==typeof BigInt}function at(t){return Array.prototype.slice.call(t)}var ut,ct={};function lt(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}function ht(t,e){if(null!=t)if("string"==typeof t)t=t?new C(t,j):F();else if(t.constructor!==C)if(N(t))t=t.length?new C(new Uint8Array(t),j):F();else{if(!e)throw Error();t=void 0}return t}const ft=[];function dt(t){if(2&t)throw Error()}function gt(t){return X?t[X]:void 0}rt(ft,55),ut=Object.freeze(ft);var pt=Object.freeze({}),mt="function"==typeof n.BigInt&&"bigint"==typeof n.BigInt(0),yt=t=>mt?t>=vt&&t<=St:"-"===t[0]?_t(t,bt):_t(t,wt);const bt=Number.MIN_SAFE_INTEGER.toString(),vt=mt?BigInt(Number.MIN_SAFE_INTEGER):void 0,wt=Number.MAX_SAFE_INTEGER.toString(),St=mt?BigInt(Number.MAX_SAFE_INTEGER):void 0;function _t(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const r=t[n],o=e[n];if(r>o)return!1;if(r<o)return!0}}const At="function"==typeof Uint8Array.prototype.slice;let It,Et=0,Tt=0;function Pt(t){const e=t>>>0;Et=e,Tt=(t-e)/4294967296>>>0}function xt(t){if(t<0){Pt(-t);const[e,n]=Nt(Et,Tt);Et=e>>>0,Tt=n>>>0}else Pt(t)}function Ot(t){const e=It||=new DataView(new ArrayBuffer(8));e.setFloat32(0,+t,!0),Tt=0,Et=e.getUint32(0,!0)}function Bt(t,e){const n=4294967296*e+(t>>>0);return Number.isSafeInteger(n)?n:Ut(t,e)}function kt(t,e){const n=2147483648&e;return n&&(e=~e>>>0,0==(t=1+~t>>>0)&&(e=e+1>>>0)),"number"==typeof(t=Bt(t,e))?n?-t:t:n?"-"+t:t}function Ut(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else st()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+Lt(n)+Lt(t));return n}function Lt(t){return t=String(t),"0000000".slice(t.length)+t}function Mt(t){if(t.length<16)xt(Number(t));else if(st())t=BigInt(t),Et=Number(t&BigInt(4294967295))>>>0,Tt=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+("-"===t[0]);Tt=Et=0;const n=t.length;for(let r=e,o=(n-e)%6+e;o<=n;r=o,o+=6){const e=Number(t.slice(r,o));Tt*=1e6,Et=1e6*Et+e,Et>=4294967296&&(Tt+=Math.trunc(Et/4294967296),Tt>>>=0,Et>>>=0)}if(e){const[t,e]=Nt(Et,Tt);Et=t,Tt=e}}}function Nt(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}const jt="function"==typeof BigInt?BigInt.asIntN:void 0,Ft="function"==typeof BigInt?BigInt.asUintN:void 0,Vt=Number.isSafeInteger,Ct=Number.isFinite,$t=Math.trunc;function Gt(t){return null==t||"number"==typeof t?t:"NaN"===t||"Infinity"===t||"-Infinity"===t?Number(t):void 0}function Dt(t){if(null!=t&&"boolean"!=typeof t){var e=typeof t;throw Error(`Expected boolean but got ${"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}: ${t}`)}return t}const Rt=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function zt(t){switch(typeof t){case"bigint":return!0;case"number":return Ct(t);case"string":return Rt.test(t);default:return!1}}function qt(t){if(null==t)return t;if("string"==typeof t&&t)t=+t;else if("number"!=typeof t)return;return Ct(t)?0|t:void 0}function Wt(t){if("-"===t[0])return!1;const e=t.length;return e<20||20===e&&Number(t.substring(0,6))<184467}function Ht(t){return t=$t(t),Vt(t)||(xt(t),t=kt(Et,Tt)),t}function Jt(t){var e=$t(Number(t));if(Vt(e))return String(e);if(-1!==(e=t.indexOf("."))&&(t=t.substring(0,e)),e=t.length,!("-"===t[0]?e<20||20===e&&Number(t.substring(0,7))>-922337:e<19||19===e&&Number(t.substring(0,6))<922337))if(Mt(t),t=Et,2147483648&(e=Tt))if(st())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=Nt(t,e);t="-"+Ut(n,r)}else t=Ut(t,e);return t}function Kt(t){return null==t?t:"bigint"==typeof t?(yt(t)?t=Number(t):(t=jt(64,t),t=yt(t)?Number(t):String(t)),t):zt(t)?"number"==typeof t?Ht(t):Jt(t):void 0}function Xt(t){if("string"!=typeof t)throw Error();return t}function Yt(t){if(null!=t&&"string"!=typeof t)throw Error();return t}function Qt(t){return null==t||"string"==typeof t?t:void 0}function Zt(t,e,n){if(null!=t&&"object"==typeof t&&t.B===ct)return t;if(Array.isArray(t)){var r=0|t[Z],o=r;return 0===o&&(o|=32&n),(o|=2&n)!==r&&rt(t,o),new e(t)}}function te(t){return t}function ee(t,e,n,r,o){if(null!=t){if(Array.isArray(t)){const i=0|t[Z];return 0===t.length&&1&i?void 0:o&&2&i?t:ne(t,e,n,void 0!==r,o)}return e(t,r)}}function ne(t,e,n,r,o){const i=r||n?0|t[Z]:0,s=r?!!(32&i):void 0;let a=0;const u=(r=at(t)).length;for(let t=0;t<u;t++){var c=r[t];if(t===u-1&&lt(c)){var l=e,h=n,f=s,d=o;let t;for(let e in c){const n=ee(c[e],l,h,f,d);null!=n&&((t??={})[e]=n)}c=t}else c=ee(r[t],e,n,s,o);r[t]=c,null!=c&&(a=t+1)}return a<u&&(r.length=a),n&&((t=gt(t))&&(r[X]=at(t)),n(i,r)),r}function re(t){switch(typeof t){case"number":return Number.isFinite(t)?t:""+t;case"bigint":return yt(t)?Number(t):""+t;case"boolean":return t?1:0;case"object":if(N(t))return N(t)&&q(Q),B(t);if(t.B===ct)return ae(t);if(t instanceof C){const e=t.g;return null==e?"":"string"==typeof e?e:t.g=B(e)}return}return t}let oe,ie,se;function ae(t){var e=t.l;t=ne(e,re,void 0,void 0,!1);var n=0|e[Z];if((e=t.length)&&!(512&n)){var r=t[e-1],o=!1;lt(r)?(e--,o=!0):r=void 0;var i=e-(n=512&n?0:-1),s=(oe??te)(i,n,t,r);if(r&&(t[e]=void 0),i<s&&r){for(var a in i=!0,r){const u=+a;u<=s?(t[o=u+n]=r[a],e=Math.max(o+1,e),o=!1,delete r[a]):i=!1}i&&(r=void 0)}for(i=e-1;e>0;i=e-1)if(null==(a=t[i]))e--,o=!0;else{if(!((i-=n)>=s))break;(r??={})[i]=a,e--,o=!0}o&&(t.length=e),r&&t.push(r)}return t}function ue(t,e,n){return t=ce(t,e[0],e[1],n?1:2),e!==ie&&n&&nt(t,8192),t}function ce(t,e,n,r){if(null==t){var o=96;n?(t=[n],o|=512):t=[],e&&(o=-16760833&o|(1023&e)<<14)}else{if(!Array.isArray(t))throw Error("narr");if(8192&(o=0|t[Z])||!(64&o)||2&o||q(Y),1024&o)throw Error("farr");if(64&o)return t;if(1===r||2===r||(o|=64),n&&(o|=512,n!==t[0]))throw Error("mid");t:{var i=(n=t).length;if(i){var s=i-1;if(lt(r=n[s])){if((s-=e=512&(o|=256)?0:-1)>=1024)throw Error("pvtlmt");for(var a in r)(i=+a)<s&&(n[i+e]=r[a],delete r[a]);o=-16760833&o|(1023&s)<<14;break t}}if(e){if((a=Math.max(e,i-(512&o?0:-1)))>1024)throw Error("spvt");o=-16760833&o|(1023&a)<<14}}}return rt(t,o),t}function le(t,e,n=it){if(null!=t){if(x&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=0|t[Z];return 2&r?t:(e&&=0===r||!!(32&r)&&!(64&r||!(16&r)),e?(rt(t,34|r),4&r&&Object.freeze(t),t):ne(t,le,4&r?it:n,!0,!0))}return t.B===ct&&(t=2&(r=0|(n=t.l)[Z])?t:new t.constructor(fe(n,r,!0))),t}}function he(t){const e=t.l;return new t.constructor(fe(e,0|e[Z],!1))}function fe(t,e,n){const r=n||2&e?it:ot,o=!!(32&e);return t=function(t,e,n){const r=at(t);var o=r.length;const i=256&e?r[o-1]:void 0;for(o+=i?-1:0,e=512&e?1:0;e<o;e++)r[e]=n(r[e]);if(i){e=r[e]={};for(const t in i)e[t]=n(i[t])}return(t=gt(t))&&(r[X]=at(t)),r}(t,e,t=>le(t,o,r)),nt(t,32|(n?2:0)),t}function de(t){const e=t.l,n=0|e[Z];return 2&n?new t.constructor(fe(e,n,!1)):t}function ge(t,e){return pe(t=t.l,0|t[Z],e)}function pe(t,e,n){if(-1===n)return null;const r=n+(512&e?0:-1),o=t.length-1;return r>=o&&256&e?t[o][n]:r<=o?t[r]:void 0}function me(t,e,n){const r=t.l;let o=0|r[Z];return dt(o),ye(r,o,e,n),t}function ye(t,e,n,r){const o=512&e?0:-1,i=n+o;var s=t.length-1;return i>=s&&256&e?(t[s][n]=r,e):i<=s?(t[i]=r,e):(void 0!==r&&(n>=(s=e>>14&1023||536870912)?null!=r&&(t[s+o]={[n]:r},rt(t,e|=256)):t[i]=r),e)}function be(t){let e=0|(t=t.l)[Z];const n=pe(t,e,1),r=ht(n,!0);return null!=r&&r!==n&&ye(t,e,1,r),r}function ve(t,e,n,r,o){const i=t.l,s=2&(t=0|i[Z])?1:r;o=!!o;let a=0|(r=we(i,t,e))[Z];if(!(4&a)){4&a&&(r=at(r),a=Fe(a,t),t=ye(i,t,e,r));let o=0,s=0;for(;o<r.length;o++){const t=n(r[o]);null!=t&&(r[s++]=t)}s<o&&(r.length=s),a=Se(a,t),n=-2049&a|20,a=n&=-4097,rt(r,a),2&a&&Object.freeze(r)}return 1===s||4===s&&32&a?_e(a)||(o=a,a|=2,a!==o&&rt(r,a),Object.freeze(r)):(2===s&&_e(a)&&(r=at(r),a=Fe(a,t),a=Ve(a,t,o),rt(r,a),t=ye(i,t,e,r)),_e(a)||(e=a,a=Ve(a,t,o),a!==e&&rt(r,a))),r}function we(t,e,n){return t=pe(t,e,n),Array.isArray(t)?t:ut}function Se(t,e){return 0===t&&(t=Fe(t,e)),1|t}function _e(t){return!!(2&t)&&!!(4&t)||!!(1024&t)}function Ae(t,e,n){let r=0|(t=t.l)[Z];if(dt(r),null==n)ye(t,r,e);else{var o=0|n[Z],i=o,s=_e(o),a=s||Object.isFrozen(n);for(s||(o=0),a||(n=at(n),i=0,o=Ve(o=Fe(o,r),r,!0),a=!1),o|=21,s=0;s<n.length;s++){const t=n[s],e=Xt(t);Object.is(t,e)||(a&&(n=at(n),i=0,o=Ve(o=Fe(o,r),r,!0),a=!1),n[s]=e)}o!==i&&(a&&(n=at(n),o=Ve(o=Fe(o,r),r,!0)),rt(n,o)),ye(t,r,e,n)}}function Ie(t,e){let n=0|(t=t.l)[Z];dt(n),ye(t,n,2,""===e?void 0:e)}function Ee(t,e,n,r){dt(e);let o=we(t,e,n);const i=o!==ut;if(64&e||!(8192&e)||!i){const s=i?0|o[Z]:0;let a=s;(!i||2&a||_e(a)||4&a&&!(32&a))&&(o=at(o),a=Fe(a,e),e=ye(t,e,n,o)),a=-13&Se(a,e),a=Ve(r?-17&a:16|a,e,!0),a!==s&&rt(o,a)}return o}function Te(t,e){var n=co;return Oe(Pe(t=t.l),t,0|t[Z],n)===e?e:-1}function Pe(t){if(W)return t[K]??(t[K]=new Map);if(K in t)return t[K];const e=new Map;return Object.defineProperty(t,K,{value:e}),e}function xe(t,e,n,r){const o=Pe(t),i=Oe(o,t,e,n);return i!==r&&(i&&(e=ye(t,e,i)),o.set(n,r)),e}function Oe(t,e,n,r){let o=t.get(r);if(null!=o)return o;o=0;for(let t=0;t<r.length;t++){const i=r[t];null!=pe(e,n,i)&&(0!==o&&(n=ye(e,n,o)),o=i)}return t.set(r,o),o}function Be(t,e,n){let r=0|t[Z];const o=pe(t,r,n);let i;if(null!=o&&o.B===ct)return(e=de(o))!==o&&ye(t,r,n,e),e.l;if(Array.isArray(o)){const t=0|o[Z];i=2&t?ue(fe(o,t,!1),e,!0):64&t?o:ue(i,e,!0)}else i=ue(void 0,e,!0);return i!==o&&ye(t,r,n,i),i}function ke(t,e,n){let r=0|(t=t.l)[Z];const o=pe(t,r,n);return(e=Zt(o,e,r))!==o&&null!=e&&ye(t,r,n,e),e}function Ue(t,e,n){if(null==(e=ke(t,e,n)))return e;let r=0|(t=t.l)[Z];if(!(2&r)){const o=de(e);o!==e&&ye(t,r,n,e=o)}return e}function Le(t,e,n,r,o,i){t=t.l;var s=!!(2&e);const a=s?1:r;o=!!o,i&&=!s;var u=0|(r=we(t,e,1))[Z];if(!(s=!!(4&u))){var c=r,l=e;const t=!!(2&(u=Se(u,e)));t&&(l|=2);let o=!t,i=!0,s=0,a=0;for(;s<c.length;s++){const e=Zt(c[s],n,l);if(e instanceof n){if(!t){const t=!!(2&e.l[Z]);o&&=!t,i&&=t}c[a++]=e}}a<s&&(c.length=a),u|=4,u=i?16|u:-17&u,rt(c,u=o?8|u:-9&u),t&&Object.freeze(c)}if(i&&!(8&u||!r.length&&(1===a||4===a&&32&u))){for(_e(u)&&(r=at(r),u=Fe(u,e),e=ye(t,e,1,r)),n=r,i=u,c=0;c<n.length;c++)(u=n[c])!==(l=de(u))&&(n[c]=l);i|=8,rt(n,i=n.length?-17&i:16|i),u=i}return 1===a||4===a&&32&u?_e(u)||(e=u,(u|=!r.length||16&u&&(!s||32&u)?2:1024)!==e&&rt(r,u),Object.freeze(r)):(2===a&&_e(u)&&(rt(r=at(r),u=Ve(u=Fe(u,e),e,o)),e=ye(t,e,1,r)),_e(u)||(t=u,(u=Ve(u,e,o))!==t&&rt(r,u))),r}function Me(t,e){const n=0|t.l[Z];return Le(t,n,e,void 0===pt?2:4,!1,!(2&n))}function Ne(t,e,n,r){return null==r&&(r=void 0),me(t,n,r)}function je(t,e,n){var r=mo;null==n&&(n=void 0);t:{let o=0|(t=t.l)[Z];if(dt(o),null==n){const n=Pe(t);if(Oe(n,t,o,r)!==e)break t;n.set(r,0)}else o=xe(t,o,r,e);ye(t,o,e,n)}}function Fe(t,e){return-1025&(2&e?2|t:-3&t)|32}function Ve(t,e,n){return 32&e&&n||(t&=-33),t}function Ce(t,e,n){dt(0|t.l[Z]),ve(t,e,Qt,2,!0).push(Xt(n))}function $e(t,e){var n=Kr;const r=0|t.l[Z];dt(r),t=Le(t,r,n,2,!0),e=null!=e?e:new n,t.push(e),t[Z]=2&e.l[Z]?-9&t[Z]:-17&t[Z]}function Ge(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function De(){return Error("Failed to read varint, encoding is invalid.")}function Re(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function ze(t){if("string"==typeof t)return{buffer:M(t),v:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),v:!1};if(t.constructor===Uint8Array)return{buffer:t,v:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),v:!1};if(t.constructor===C)return{buffer:V(t)||new Uint8Array(0),v:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),v:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function qe(t,e){let n,r=0,o=0,i=0;const s=t.i;let a=t.g;do{n=s[a++],r|=(127&n)<<i,i+=7}while(i<32&&128&n);for(i>32&&(o|=(127&n)>>4),i=3;i<32&&128&n;i+=7)n=s[a++],o|=(127&n)<<i;if(Ye(t,a),n<128)return e(r>>>0,o>>>0);throw De()}function We(t){let e=0,n=t.g;const r=n+10,o=t.i;for(;n<r;){const r=o[n++];if(e|=r,!(128&r))return Ye(t,n),!!(127&e)}throw De()}function He(t){const e=t.i;let n=t.g,r=e[n++],o=127&r;if(128&r&&(r=e[n++],o|=(127&r)<<7,128&r&&(r=e[n++],o|=(127&r)<<14,128&r&&(r=e[n++],o|=(127&r)<<21,128&r&&(r=e[n++],o|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw De();return Ye(t,n),o}function Je(t){var e=t.i;const n=t.g;var r=e[n],o=e[n+1];const i=e[n+2];return e=e[n+3],Ye(t,t.g+4),t=2*((o=(r|o<<8|i<<16|e<<24)>>>0)>>31)+1,r=o>>>23&255,o&=8388607,255==r?o?NaN:t*(1/0):0==r?1401298464324817e-60*t*o:t*Math.pow(2,r-150)*(o+8388608)}function Ke(t){return He(t)}function Xe(t,e,{C:n=!1}={}){t.C=n,e&&(e=ze(e),t.i=e.buffer,t.m=e.v,t.u=0,t.j=t.i.length,t.g=t.u)}function Ye(t,e){if(t.g=e,e>t.j)throw Re(t.j,e)}function Qe(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.j)throw Re(e,t.j-n);return t.g=r,n}function Ze(t,e){if(0==e)return F();var n=Qe(t,e);return t.C&&t.m?n=t.i.subarray(n,n+e):(t=t.i,n=n===(e=n+e)?new Uint8Array(0):At?t.slice(n,e):new Uint8Array(t.subarray(n,e))),0==n.length?F():new C(n,j)}var tn=[];function en(t){var e=t.g;if(e.g==e.j)return!1;t.j=t.g.g;var n=He(t.g)>>>0;if(e=n>>>3,!((n&=7)>=0&&n<=5))throw Ge(n,t.j);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.j})`);return t.m=e,t.i=n,!0}function nn(t){switch(t.i){case 0:0!=t.i?nn(t):We(t.g);break;case 1:Ye(t=t.g,t.g+8);break;case 2:if(2!=t.i)nn(t);else{var e=He(t.g)>>>0;Ye(t=t.g,t.g+e)}break;case 5:Ye(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!en(t))throw Error("Unmatched start-group tag: stream EOF");if(4==t.i){if(t.m!=e)throw Error("Unmatched end-group tag");break}nn(t)}break;default:throw Ge(t.i,t.j)}}function rn(t,e,n){const r=t.g.j,o=He(t.g)>>>0,i=t.g.g+o;let s=i-r;if(s<=0&&(t.g.j=i,n(e,t,void 0,void 0,void 0),s=i-t.g.g),s)throw Error(`Message parsing ended unexpectedly. Expected to read ${o} bytes, instead read ${o-s} bytes, either the data ended unexpectedly or the message misreported its own length`);t.g.g=i,t.g.j=r}function on(t){var e=He(t.g)>>>0,n=Qe(t=t.g,e);if(t=t.i,a){var u,c=t;(u=s)||(u=s=new TextDecoder("utf-8",{fatal:!0})),e=n+e,c=0===n&&e===c.length?c:c.subarray(n,e);try{var l=u.decode(c)}catch(t){if(void 0===i){try{u.decode(new Uint8Array([128]))}catch(t){}try{u.decode(new Uint8Array([97])),i=!0}catch(t){i=!1}}throw!i&&(s=void 0),t}}else{e=(l=n)+e,n=[];let i,s=null;for(;l<e;){var h=t[l++];h<128?n.push(h):h<224?l>=e?r():(i=t[l++],h<194||128!=(192&i)?(l--,r()):n.push((31&h)<<6|63&i)):h<240?l>=e-1?r():(i=t[l++],128!=(192&i)||224===h&&i<160||237===h&&i>=160||128!=(192&(u=t[l++]))?(l--,r()):n.push((15&h)<<12|(63&i)<<6|63&u)):h<=244?l>=e-2?r():(i=t[l++],128!=(192&i)||i-144+(h<<28)>>30||128!=(192&(u=t[l++]))||128!=(192&(c=t[l++]))?(l--,r()):(h=(7&h)<<18|(63&i)<<12|(63&u)<<6|63&c,h-=65536,n.push(55296+(h>>10&1023),56320+(1023&h)))):r(),n.length>=8192&&(s=o(s,n),n.length=0)}l=o(s,n)}return l}function sn(t){const e=He(t.g)>>>0;return Ze(t.g,e)}function an(t,e,n){var r=He(t.g)>>>0;for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var un=[];function cn(t,e,n){e.g?e.j(t,e.g,e.i,n):e.j(t,e.i,n)}var ln=class{constructor(t,e){this.l=ce(t,e)}toJSON(){try{var t=ae(this)}finally{oe=void 0}return t}v(){return!!(2&this.l[Z])}};function hn(t){return t?/^\d+$/.test(t)?(Mt(t),new fn(Et,Tt)):null:dn||=new fn(0,0)}ln.prototype.B=ct,ln.prototype.toString=function(){return this.l.toString()};var fn=class{constructor(t,e){this.i=t>>>0,this.g=e>>>0}};let dn;function gn(t){return t?/^-?\d+$/.test(t)?(Mt(t),new pn(Et,Tt)):null:mn||=new pn(0,0)}var pn=class{constructor(t,e){this.i=t>>>0,this.g=e>>>0}};let mn;function yn(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function bn(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function vn(t,e){if(e>=0)bn(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function wn(t){var e=Et;t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function Sn(t,e){0!==e.length&&(t.j.push(e),t.i+=e.length)}function _n(t,e,n){bn(t.g,8*e+n)}function An(t,e){return _n(t,e,2),e=t.g.end(),Sn(t,e),e.push(t.i),e}function In(t,e){var n=e.pop();for(n=t.i+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.i++;e.push(n),t.i++}function En(t,e,n){_n(t,e,2),bn(t.g,n.length),Sn(t,t.g.end()),Sn(t,n)}function Tn(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var Pn=Tn(),xn=Tn(),On=Tn(),Bn=Tn(),kn=Tn(),Un=Tn(),Ln=Tn(),Mn=Tn(),Nn=class{constructor(t,e,n){this.g=t,this.i=e,t=Pn,this.j=!!t&&n===t||!1}};function jn(t,e){return new Nn(t,e,Pn)}function Fn(t,e,n,r,o){null!=(e=Jn(e,r))&&(n=An(t,n),o(e,t),In(t,n))}const Vn=jn(function(t,e,n,r,o){return 2===t.i&&(rn(t,Be(e,r,n),o),!0)},Fn),Cn=jn(function(t,e,n,r,o){return 2===t.i&&(rn(t,Be(e,r,n),o),!0)},Fn);var $n=Symbol(),Gn=Symbol(),Dn=Symbol(),Rn=Symbol();let zn,qn;function Wn(t,e,n,r){var o=r[t];if(o)return o;(o={}).N=r,o.A=function(t){switch(typeof t){case"boolean":return ie||=[0,void 0,!0];case"number":return t>0?void 0:0===t?se||=[0,void 0]:[-t,void 0];case"string":return[0,t];case"object":return t}}(r[0]);var i=r[1];let s=1;i&&i.constructor===Object&&(o.F=i,"function"==typeof(i=r[++s])&&(o.G=!0,zn??=i,qn??=r[s+1],i=r[s+=2]));const a={};for(;i&&Array.isArray(i)&&i.length&&"number"==typeof i[0]&&i[0]>0;){for(var u=0;u<i.length;u++)a[i[u]]=i;i=r[++s]}for(u=1;void 0!==i;){let t;"number"==typeof i&&(u+=i,i=r[++s]);var c=void 0;if(i instanceof Nn?t=i:(t=Vn,s--),t?.j){i=r[++s],c=r;var l=s;"function"==typeof i&&(i=i(),c[l]=i),c=i}for(l=u+1,"number"==typeof(i=r[++s])&&i<0&&(l-=i,i=r[++s]);u<l;u++){const r=a[u];c?n(o,u,t,c,r):e(o,u,t,r)}}return r[t]=o}function Hn(t){return Array.isArray(t)?t[0]instanceof Nn?t:[Cn,t]:[t,void 0]}function Jn(t,e){return t instanceof ln?t.l:Array.isArray(t)?ue(t,e,!1):void 0}function Kn(t,e,n,r){const o=n.g;t[e]=r?(t,e,n)=>o(t,e,n,r):o}function Xn(t,e,n,r,o){const i=n.g;let s,a;t[e]=(t,e,n)=>i(t,e,n,a||=Wn(Gn,Kn,Xn,r).A,s||=Yn(r),o)}function Yn(t){let e=t[Dn];if(null!=e)return e;const n=Wn(Gn,Kn,Xn,t);return e=n.G?(t,e)=>zn(t,e,n):(t,e)=>{const r=0|t[Z];for(;en(e)&&4!=e.i;){var o=e.m,i=n[o];if(null==i){var s=n.F;s&&(s=s[o])&&null!=(s=Qn(s))&&(i=n[o]=s)}null!=i&&i(e,t,o)||(o=(i=e).j,nn(i),i.D?i=void 0:(s=i.g.g-o,i.g.g=o,i=Ze(i.g,s)),o=t,i&&((s=o[X])?s.push(i):o[X]=[i]))}return 8192&r&&nt(t,34),!0},t[Dn]=e}function Qn(t){const e=(t=Hn(t))[0].g;if(t=t[1]){const n=Yn(t),r=Wn(Gn,Kn,Xn,t).A;return(t,o,i)=>e(t,o,i,r,n)}return e}function Zn(t,e,n){t[e]=n.i}function tr(t,e,n,r){let o,i;const s=n.i;t[e]=(t,e,n)=>s(t,e,n,i||=Wn($n,Zn,tr,r).A,o||=er(r))}function er(t){let e=t[Rn];if(!e){const n=Wn($n,Zn,tr,t);e=(t,e)=>nr(t,e,n),t[Rn]=e}return e}function nr(t,e,n){!function(t,e,n){const r=512&e?0:-1,o=t.length,i=o+((e=64&e?256&e:!!o&&lt(t[o-1]))?-1:0);for(let e=0;e<i;e++)n(e-r,t[e]);if(e){t=t[o-1];for(const e in t)!isNaN(e)&&n(+e,t[e])}}(t,t[Z]|(n.A[1]?512:0),(t,r)=>{if(null!=r){var o=function(t,e){var n=t[e];if(n)return n;if((n=t.F)&&(n=n[e])){var r=(n=Hn(n))[0].i;if(n=n[1]){const e=er(n),o=Wn($n,Zn,tr,n).A;n=t.G?qn(o,e):(t,n,i)=>r(t,n,i,o,e)}else n=r;return t[e]=n}}(n,t);o&&o(e,r,t)}}),(t=gt(t))&&function(t,e){Sn(t,t.g.end());for(let n=0;n<e.length;n++)Sn(t,V(e[n])||new Uint8Array(0))}(e,t)}function rr(t,e){if(Array.isArray(e)){var n=0|e[Z];if(4&n)return e;for(var r=0,o=0;r<e.length;r++){const n=t(e[r]);null!=n&&(e[o++]=n)}return o<r&&(e.length=o),rt(e,-6145&n|5),2&n&&Object.freeze(e),e}}function or(t,e,n){return new Nn(t,e,n)}function ir(t,e,n){return new Nn(t,e,n)}function sr(t,e,n){ye(t,0|t[Z],e,n)}function ar(t,e,n){if(e=function(t){if(null==t)return t;const e=typeof t;if("bigint"===e)return String(jt(64,t));if(zt(t)){if("string"===e)return Jt(t);if("number"===e)return Ht(t)}}(e),null!=e&&("string"==typeof e&&gn(e),null!=e))switch(_n(t,n,0),typeof e){case"number":t=t.g,xt(e),yn(t,Et,Tt);break;case"bigint":n=BigInt.asUintN(64,e),n=new pn(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),yn(t.g,n.i,n.g);break;default:n=gn(e),yn(t.g,n.i,n.g)}}function ur(t,e,n){null!=(e=qt(e))&&null!=e&&(_n(t,n,0),vn(t.g,e))}function cr(t,e,n){null!=(e=null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0)&&(_n(t,n,0),t.g.g.push(e?1:0))}function lr(t,e,n){null!=(e=Qt(e))&&En(t,n,l(e))}function hr(t,e,n,r,o){null!=(e=Jn(e,r))&&(n=An(t,n),o(e,t),In(t,n))}function fr(t,e,n){null==e||"string"==typeof e||e instanceof C||(N(e)?N(e)&&q(Q):e=void 0),null!=e&&En(t,n,ze(e).buffer)}var dr=or(function(t,e,n){return 5===t.i&&(sr(e,n,Je(t.g)),!0)},function(t,e,n){null!=(e=Gt(e))&&(_n(t,n,5),t=t.g,Ot(e),wn(t))},Un),gr=ir(function(t,e,n){return(5===t.i||2===t.i)&&(e=Ee(e,0|e[Z],n,!1),2==t.i?an(t,Je,e):e.push(Je(t.g)),!0)},function(t,e,n){if(null!=(e=rr(Gt,e))&&e.length){_n(t,n,2),bn(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,Ot(e[r]),wn(n)}},Un),pr=or(function(t,e,n){return 0===t.i&&(sr(e,n,qe(t.g,kt)),!0)},ar,kn),mr=or(function(t,e,n){return 0===t.i&&(sr(e,n,0===(t=qe(t.g,kt))?void 0:t),!0)},ar,kn),yr=or(function(t,e,n){return 0===t.i&&(sr(e,n,qe(t.g,Bt)),!0)},function(t,e,n){if(null!=(e=function(t){if(null==t)return t;var e=typeof t;if("bigint"===e)return String(Ft(64,t));if(zt(t)){if("string"===e)return e=$t(Number(t)),Vt(e)&&e>=0?t=String(e):(-1!==(e=t.indexOf("."))&&(t=t.substring(0,e)),Wt(t)||(Mt(t),t=Ut(Et,Tt))),t;if("number"===e)return(t=$t(t))>=0&&Vt(t)?t:function(t){if(t<0){xt(t);var e=Ut(Et,Tt);return t=Number(e),Vt(t)?t:e}return Wt(e=String(t))?e:(xt(t),Bt(Et,Tt))}(t)}}(e))&&("string"==typeof e&&hn(e),null!=e))switch(_n(t,n,0),typeof e){case"number":t=t.g,xt(e),yn(t,Et,Tt);break;case"bigint":n=BigInt.asUintN(64,e),n=new fn(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),yn(t.g,n.i,n.g);break;default:n=hn(e),yn(t.g,n.i,n.g)}},Tn()),br=or(function(t,e,n){return 0===t.i&&(sr(e,n,He(t.g)),!0)},ur,Bn),vr=ir(function(t,e,n){return(0===t.i||2===t.i)&&(e=Ee(e,0|e[Z],n,!1),2==t.i?an(t,He,e):e.push(He(t.g)),!0)},function(t,e,n){if(null!=(e=rr(qt,e))&&e.length){n=An(t,n);for(let n=0;n<e.length;n++)vn(t.g,e[n]);In(t,n)}},Bn),wr=or(function(t,e,n){return 0===t.i&&(sr(e,n,0===(t=He(t.g))?void 0:t),!0)},ur,Bn),Sr=or(function(t,e,n){return 0===t.i&&(sr(e,n,We(t.g)),!0)},cr,xn),_r=or(function(t,e,n){return 0===t.i&&(sr(e,n,!1===(t=We(t.g))?void 0:t),!0)},cr,xn),Ar=ir(function(t,e,n){return 2===t.i&&(t=on(t),Ee(e,0|e[Z],n,!1).push(t),!0)},function(t,e,n){if(null!=(e=rr(Qt,e)))for(let s=0;s<e.length;s++){var r=t,o=n,i=e[s];null!=i&&En(r,o,l(i))}},On),Ir=or(function(t,e,n){return 2===t.i&&(sr(e,n,""===(t=on(t))?void 0:t),!0)},lr,On),Er=or(function(t,e,n){return 2===t.i&&(sr(e,n,on(t)),!0)},lr,On),Tr=function(t,e,n=Pn){return new Nn(t,e,n)}(function(t,e,n,r,o){return 2===t.i&&(r=ue(void 0,r,!0),Ee(e,0|e[Z],n,!0).push(r),rn(t,r,o),!0)},function(t,e,n,r,o){if(Array.isArray(e))for(let i=0;i<e.length;i++)hr(t,e[i],n,r,o)}),Pr=jn(function(t,e,n,r,o,i){return 2===t.i&&(xe(e,0|e[Z],i,n),rn(t,e=Be(e,r,n),o),!0)},hr),xr=or(function(t,e,n){return 2===t.i&&(sr(e,n,sn(t)),!0)},fr,Ln),Or=or(function(t,e,n){return 0===t.i&&(sr(e,n,0==(t=He(t.g)>>>0)?void 0:t),!0)},function(t,e,n){e=function(t){if(null==t)return t;if("string"==typeof t&&t)t=+t;else if("number"!=typeof t)return;return Ct(t)?t>>>0:void 0}(e),null!=e&&null!=e&&(_n(t,n,0),bn(t.g,e))},Tn()),Br=or(function(t,e,n){return 0===t.i&&(sr(e,n,He(t.g)),!0)},function(t,e,n){null!=(e=qt(e))&&(e=parseInt(e,10),_n(t,n,0),vn(t.g,e))},Mn);class kr{constructor(t,e){this.i=t,this.g=e,this.j=Ne,this.defaultValue=void 0}register(){A(this)}}function Ur(t,e){return(n,r)=>{if(un.length){const t=un.pop();t.o(r),Xe(t.g,n,r),n=t}else n=new class{constructor(t,e){if(tn.length){const n=tn.pop();Xe(n,t,e),t=n}else t=new class{constructor(t,e){this.i=null,this.m=!1,this.g=this.j=this.u=0,Xe(this,t,e)}clear(){this.i=null,this.m=!1,this.g=this.j=this.u=0,this.C=!1}}(t,e);this.g=t,this.j=this.g.g,this.i=this.m=-1,this.o(e)}o({D:t=!1}={}){this.D=t}}(n,r);try{const r=new t,i=r.l;Yn(e)(i,n);var o=r}finally{n.g.clear(),n.m=-1,n.i=-1,un.length<100&&un.push(n)}return o}}var Lr=[0,Ir,or(function(t,e,n){return 2===t.i&&(sr(e,n,(t=sn(t))===F()?void 0:t),!0)},function(t,e,n){if(null!=e){if(e instanceof ln){const r=e.O;return void(r&&(e=r(e),null!=e&&En(t,n,ze(e).buffer)))}if(Array.isArray(e))return}fr(t,e,n)},Ln)];let Mr,Nr=globalThis.trustedTypes;function jr(t){void 0===Mr&&(Mr=function(){let t=null;if(!Nr)return t;try{const e=t=>t;t=Nr.createPolicy("goog#html",{createHTML:e,createScript:e,createScriptURL:e})}catch(t){}return t}());var e=Mr;return new class{constructor(t){this.g=t}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function Fr(t,...e){if(0===e.length)return jr(t[0]);let n=t[0];for(let r=0;r<e.length;r++)n+=encodeURIComponent(e[r])+t[r+1];return jr(n)}var Vr=[0,br,Br,Sr,-1,vr,Br,-1],Cr=class extends ln{constructor(t){super(t)}},$r=[0,Sr,Er,Sr,Br,-1,ir(function(t,e,n){return(0===t.i||2===t.i)&&(e=Ee(e,0|e[Z],n,!1),2==t.i?an(t,Ke,e):e.push(He(t.g)),!0)},function(t,e,n){if(null!=(e=rr(qt,e))&&e.length){n=An(t,n);for(let n=0;n<e.length;n++)vn(t.g,e[n]);In(t,n)}},Mn),Er,-1,[0,Sr,-1],Br,Sr,-1],Gr=[0,Er,-2],Dr=class extends ln{constructor(t){super(t)}},Rr=[0],zr=[0,br,Sr,1,Sr,-3],qr=class extends ln{constructor(t){super(t,2)}},Wr={};Wr[336783863]=[0,Er,Sr,-1,br,[0,[1,2,3,4,5,6,7,8,9],Pr,Rr,Pr,$r,Pr,Gr,Pr,zr,Pr,Vr,Pr,[0,Er,-2],Pr,[0,Er,Br],Pr,[0,Br,Er,-1],Pr,[0,Br,-1]],[0,Er],Sr,[0,[1,3],[2,4],Pr,[0,vr],-1,Pr,[0,Ar],-1,Tr,[0,Er,-1]],Er];var Hr=[0,mr,-1,_r,-3,mr,vr,Ir,wr,mr,-1,_r,wr,_r,-2,Ir];function Jr(t){Ce(t,3,"TEXT:text_in")}var Kr=class extends ln{constructor(t){super(t,500)}o(t){return Ne(this,0,7,t)}},Xr=[-1,{}],Yr=[0,Er,1,Xr],Qr=[0,Er,Ar,Xr];function Zr(t){Ce(t,10,"text_in")}var to,eo=class extends ln{constructor(t){super(t,500)}o(t){return Ne(this,0,1001,t)}};eo.prototype.g=(to=[-500,Tr,[-500,Ir,-1,Ar,-3,[-2,Wr,Sr],Tr,Lr,wr,-1,Yr,Qr,Tr,[0,Ir,_r],Ir,Hr,wr,Ar,987,Ar],4,Tr,[-500,Er,-1,[-1,{}],998,Er],Tr,[-500,Er,Ar,-1,[-2,{},Sr],997,Ar,-1],wr,Tr,[-500,Er,Ar,Xr,998,Ar],Ar,wr,Yr,Qr,Tr,[0,Ir,-1,Xr],Ar,-2,Hr,Ir,-1,_r,[0,_r,Or],978,Xr,Tr,Lr],function(){const t=new class{constructor(){this.j=[],this.i=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const t=this.g;return this.g=[],t}}}};nr(this.l,t,Wn($n,Zn,tr,to)),Sn(t,t.g.end());const e=new Uint8Array(t.i),n=t.j,r=n.length;let o=0;for(let t=0;t<r;t++){const r=n[t];e.set(r,o),o+=r.length}return t.j=[e],e});var no=class extends ln{constructor(t){super(t)}},ro=class extends ln{constructor(t){super(t)}g(){return Me(this,no)}},oo=class extends ln{constructor(t){super(t)}},io=Ur(class extends ln{constructor(t){super(t)}},[0,Tr,[0,1,br,Er,[0,Tr,[0,br,dr,Er,-1]]],pr]),so=class extends ln{constructor(t){super(t)}},ao=class extends ln{constructor(t){super(t)}H(){const t=be(this);return null==t?F():t}},uo=class extends ln{constructor(t){super(t)}},co=[1,2],lo=Ur(class extends ln{constructor(t){super(t)}},[0,Tr,[0,co,Pr,[0,gr],Pr,[0,xr],br,Er],pr]),ho=class extends ln{constructor(t){super(t)}},fo=class extends ln{constructor(t){super(t)}},go=[0,Sr,-1],po=class extends ln{constructor(t){super(t)}},mo=[1,2,3,4,5],yo=class extends ln{constructor(t){super(t)}g(){return null!=be(this)}i(){return null!=Qt(ge(this,2))}},bo=class extends ln{constructor(t){super(t)}},vo=[0,[0,xr,Er,[0,br,pr,-1],[0,yr,pr]],Sr,[0,mo,Pr,zr,Pr,$r,Pr,Vr,Pr,Rr,Pr,Gr],Br],wo=class extends ln{constructor(t){super(t)}},So=new kr(462704549,wo);Wr[462704549]=[0,vo,[0,Er,br,dr,Ar,-1]];var _o=class extends ln{constructor(t){super(t)}},Ao=new kr(477589892,_o);function Io(t,e){if(e=e?he(e):new ho,void 0!==t.displayNamesLocale?me(e,1,Yt(t.displayNamesLocale)):void 0===t.displayNamesLocale&&me(e,1),void 0!==t.maxResults){var n=t.maxResults;if(null!=n){if("number"!=typeof n)throw z();if(!Ct(n))throw z();n|=0}me(e,2,n)}else"maxResults"in t&&me(e,2);if(void 0!==t.scoreThreshold){if(null!=(n=t.scoreThreshold)&&"number"!=typeof n)throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);me(e,3,n)}else"scoreThreshold"in t&&me(e,3);return void 0!==t.categoryAllowlist?Ae(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&me(e,4),void 0!==t.categoryDenylist?Ae(e,5,t.categoryDenylist):"categoryDenylist"in t&&me(e,5),e}function Eo(t){const e={classifications:Me(t,oo).map(t=>function(t,e=-1,n=""){return{categories:t.map(t=>{var e=qt(ge(t,1))??0??-1;const n=t.l;let r=0|n[Z];const o=pe(n,r,2),i=Gt(o);return null!=i&&i!==o&&ye(n,r,2,i),{index:e,score:i??0??0,categoryName:Qt(ge(t,3))??""??"",displayName:Qt(ge(t,4))??""??""}}),headIndex:e,headName:n}}(Ue(t,ro,4)?.g()??[],qt(ge(t,2))??0,Qt(ge(t,3))??""))};return null!=Kt(ge(t,2))&&(e.timestampMs=Kt(ge(t,2))??0),e}function To(t){return Array.from(t,t=>t>127?t-256:t)}function Po(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,o=0;for(let i=0;i<t.length;i++)n+=t[i]*e[i],r+=t[i]*t[i],o+=e[i]*e[i];if(r<=0||o<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*o)}let xo;Wr[477589892]=[0,vo,go];const Oo=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function Bo(){if(void 0===xo)try{await WebAssembly.instantiate(Oo),xo=!0}catch{xo=!1}return xo}async function ko(t,e=Fr``){const n=await Bo()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var Uo=class{};async function Lo(t){if("function"!=typeof importScripts){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise((t,n)=>{e.addEventListener("load",()=>{t()},!1),e.addEventListener("error",t=>{n(t)},!1),document.body.appendChild(e)})}importScripts(t.toString())}function Mo(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.h.stringToNewUTF8(e)),t.h._free(e)}function No(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(e.length);for(let n=0;n<e.length;n++)r[n]=t.h.stringToNewUTF8(e[n]);e=t.h._malloc(4*r.length),t.h.HEAPU32.set(r,e>>2),n(e);for(const e of r)t.h._free(e);t.h._free(e)}function jo(t,e,n){t.h.simpleListeners=t.h.simpleListeners||{},t.h.simpleListeners[e]=n}function Fo(t,e,n){let r=[];t.h.simpleListeners=t.h.simpleListeners||{},t.h.simpleListeners[e]=(t,e,o)=>{e?(n(r,o),r=[]):r.push(t)}}Uo.forVisionTasks=function(t){return ko("vision",t)},Uo.forTextTasks=function(t){return ko("text",t)},Uo.forGenAiExperimentalTasks=function(t){return ko("genai_experimental",t)},Uo.forGenAiTasks=function(t){return ko("genai",t)},Uo.forAudioTasks=function(t){return ko("audio",t)},Uo.isSimdSupported=function(){return Bo()};const Vo=function(t){return class extends t{M(){this.h._registerModelResourcesGraphService()}}}(class{constructor(t,e){this.j=!0,this.h=t,this.g=null,this.i=0,this.m="function"==typeof this.h._addIntToInputStream,void 0!==e?this.h.canvas=e:function(){var t=navigator;return!("undefined"==typeof OffscreenCanvas||function(t=navigator){return(t=t.userAgent).includes("Safari")&&!t.includes("Chrome")}(t)&&!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}()?this.h.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.h.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph((new TextEncoder).encode(t),!1)}setGraph(t,e){const n=t.length,r=this.h._malloc(n);this.h.HEAPU8.set(t,r),e?this.h._changeBinaryGraph(n,r):this.h._changeTextGraph(n,r),this.h._free(r)}configureAudio(t,e,n,r,o){this.h._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Mo(this,r||"input_audio",r=>{Mo(this,o=o||"audio_header",o=>{this.h._configureAudio(r,o,t,e??0,n)})})}setAutoResizeCanvas(t){this.j=t}setAutoRenderToScreen(t){this.h._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.h.gpuOriginForWebTexturesIsBottomLeft=t}attachErrorListener(t){this.h.errorListener=t}attachEmptyPacketListener(t,e){this.h.emptyPacketListeners=this.h.emptyPacketListeners||{},this.h.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,o){const i=4*t.length;this.i!==i&&(this.g&&this.h._free(this.g),this.g=this.h._malloc(i),this.i=i),this.h.HEAPF32.set(t,this.g/4),Mo(this,r,t=>{this.h._addAudioToInputStream(this.g,e,n,t,o)})}addGpuBufferToStream(t,e,n){Mo(this,e,e=>{if(!this.h.canvas)throw Error("No OpenGL canvas configured.");e?this.h._bindTextureToStream(e):this.h._bindTextureToCanvas();const r=this.h.canvas.getContext("webgl2")||this.h.canvas.getContext("webgl");if(!r)throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");this.h.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),this.h.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);const[o,i]=void 0!==t.videoWidth?[t.videoWidth,t.videoHeight]:void 0!==t.naturalWidth?[t.naturalWidth,t.naturalHeight]:void 0!==t.displayWidth?[t.displayWidth,t.displayHeight]:[t.width,t.height];!this.j||o===this.h.canvas.width&&i===this.h.canvas.height||(this.h.canvas.width=o,this.h.canvas.height=i);const[s,a]=[o,i];this.h._addBoundTextureToStream(e,s,a,n)})}addBoolToStream(t,e,n){Mo(this,e,e=>{this.h._addBoolToInputStream(t,e,n)})}addDoubleToStream(t,e,n){Mo(this,e,e=>{this.h._addDoubleToInputStream(t,e,n)})}addFloatToStream(t,e,n){Mo(this,e,e=>{this.h._addFloatToInputStream(t,e,n)})}addIntToStream(t,e,n){Mo(this,e,e=>{this.h._addIntToInputStream(t,e,n)})}addUintToStream(t,e,n){Mo(this,e,e=>{this.h._addUintToInputStream(t,e,n)})}addStringToStream(t,e,n){Mo(this,e,e=>{Mo(this,t,t=>{this.h._addStringToInputStream(t,e,n)})})}addStringRecordToStream(t,e,n){Mo(this,e,e=>{No(this,Object.keys(t),r=>{No(this,Object.values(t),o=>{this.h._addFlatHashMapToInputStream(r,o,Object.keys(t).length,e,n)})})})}addProtoToStream(t,e,n,r){Mo(this,n,n=>{Mo(this,e,e=>{const o=this.h._malloc(t.length);this.h.HEAPU8.set(t,o),this.h._addProtoToInputStream(o,t.length,e,n,r),this.h._free(o)})})}addEmptyPacketToStream(t,e){Mo(this,t,t=>{this.h._addEmptyPacketToInputStream(t,e)})}addBoolVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const e of t)this.h._addBoolVectorEntry(r,e);this.h._addBoolVectorToInputStream(r,e,n)})}addDoubleVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const e of t)this.h._addDoubleVectorEntry(r,e);this.h._addDoubleVectorToInputStream(r,e,n)})}addFloatVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const e of t)this.h._addFloatVectorEntry(r,e);this.h._addFloatVectorToInputStream(r,e,n)})}addIntVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const e of t)this.h._addIntVectorEntry(r,e);this.h._addIntVectorToInputStream(r,e,n)})}addUintVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const e of t)this.h._addUintVectorEntry(r,e);this.h._addUintVectorToInputStream(r,e,n)})}addStringVectorToStream(t,e,n){Mo(this,e,e=>{const r=this.h._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const e of t)Mo(this,e,t=>{this.h._addStringVectorEntry(r,t)});this.h._addStringVectorToInputStream(r,e,n)})}addBoolToInputSidePacket(t,e){Mo(this,e,e=>{this.h._addBoolToInputSidePacket(t,e)})}addDoubleToInputSidePacket(t,e){Mo(this,e,e=>{this.h._addDoubleToInputSidePacket(t,e)})}addFloatToInputSidePacket(t,e){Mo(this,e,e=>{this.h._addFloatToInputSidePacket(t,e)})}addIntToInputSidePacket(t,e){Mo(this,e,e=>{this.h._addIntToInputSidePacket(t,e)})}addUintToInputSidePacket(t,e){Mo(this,e,e=>{this.h._addUintToInputSidePacket(t,e)})}addStringToInputSidePacket(t,e){Mo(this,e,e=>{Mo(this,t,t=>{this.h._addStringToInputSidePacket(t,e)})})}addProtoToInputSidePacket(t,e,n){Mo(this,n,n=>{Mo(this,e,e=>{const r=this.h._malloc(t.length);this.h.HEAPU8.set(t,r),this.h._addProtoToInputSidePacket(r,t.length,e,n),this.h._free(r)})})}addBoolVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateBoolVector(t.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const e of t)this.h._addBoolVectorEntry(n,e);this.h._addBoolVectorToInputSidePacket(n,e)})}addDoubleVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateDoubleVector(t.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const e of t)this.h._addDoubleVectorEntry(n,e);this.h._addDoubleVectorToInputSidePacket(n,e)})}addFloatVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateFloatVector(t.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const e of t)this.h._addFloatVectorEntry(n,e);this.h._addFloatVectorToInputSidePacket(n,e)})}addIntVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateIntVector(t.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const e of t)this.h._addIntVectorEntry(n,e);this.h._addIntVectorToInputSidePacket(n,e)})}addUintVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateUintVector(t.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const e of t)this.h._addUintVectorEntry(n,e);this.h._addUintVectorToInputSidePacket(n,e)})}addStringVectorToInputSidePacket(t,e){Mo(this,e,e=>{const n=this.h._allocateStringVector(t.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const e of t)Mo(this,e,t=>{this.h._addStringVectorEntry(n,t)});this.h._addStringVectorToInputSidePacket(n,e)})}attachBoolListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachBoolListener(t)})}attachBoolVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachBoolVectorListener(t)})}attachIntListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachIntListener(t)})}attachIntVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachIntVectorListener(t)})}attachUintListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachUintListener(t)})}attachUintVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachUintVectorListener(t)})}attachDoubleListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachDoubleListener(t)})}attachDoubleVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachDoubleVectorListener(t)})}attachFloatListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachFloatListener(t)})}attachFloatVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachFloatVectorListener(t)})}attachStringListener(t,e){jo(this,t,e),Mo(this,t,t=>{this.h._attachStringListener(t)})}attachStringVectorListener(t,e){Fo(this,t,e),Mo(this,t,t=>{this.h._attachStringVectorListener(t)})}attachProtoListener(t,e,n){jo(this,t,e),Mo(this,t,t=>{this.h._attachProtoListener(t,n||!1)})}attachProtoVectorListener(t,e,n){Fo(this,t,e),Mo(this,t,t=>{this.h._attachProtoVectorListener(t,n||!1)})}attachAudioListener(t,e,n){this.h._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),jo(this,t,(t,n)=>{t=new Float32Array(t.buffer,t.byteOffset,t.length/4),e(t,n)}),Mo(this,t,t=>{this.h._attachAudioListener(t,n||!1)})}finishProcessing(){this.h._waitUntilIdle()}closeGraph(){this.h._closeGraph(),this.h.simpleListeners=void 0,this.h.emptyPacketListeners=void 0}});var Co=class extends Vo{};async function $o(t,e,n){return async function(t,e,n){return t=await(async(t,e,n,r)=>{if(e&&await Lo(e),!self.ModuleFactory)throw Error("ModuleFactory not set.");if(n&&(await Lo(n),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&r&&((e=self.Module).locateFile=r.locateFile,r.mainScriptUrlOrBlob&&(e.mainScriptUrlOrBlob=r.mainScriptUrlOrBlob)),r=await self.ModuleFactory(self.Module||r),self.ModuleFactory=self.Module=void 0,new t(r,null)})(t,e.wasmLoaderPath,e.assetLoaderPath,{locateFile:t=>t.endsWith(".wasm")?e.wasmBinaryPath.toString():e.assetBinaryPath&&t.endsWith(".data")?e.assetBinaryPath.toString():t}),await t.o(n),t}(t,e,n)}function Go(t,e){const n=Ue(t.baseOptions,yo,1)||new yo;"string"==typeof e?(me(n,2,Yt(e)),me(n,1)):e instanceof Uint8Array&&(me(n,1,ht(e,!1)),me(n,2)),Ne(t.baseOptions,0,1,n)}function Do(t,e){const n=e.baseOptions||{};if(e.baseOptions?.modelAssetBuffer&&e.baseOptions?.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(Ue(t.baseOptions,yo,1)?.g()||Ue(t.baseOptions,yo,1)?.i()||e.baseOptions?.modelAssetBuffer||e.baseOptions?.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if(function(t,e){let n=Ue(t.baseOptions,po,3);if(!n){var r=n=new po;je(r,4,new Dr)}"delegate"in e&&("GPU"===e.delegate?je(e=n,2,r=new Cr):je(e=n,4,r=new Dr)),Ne(t.baseOptions,0,3,n)}(t,n),n.modelAssetPath)return fetch(n.modelAssetPath.toString()).then(t=>{if(t.ok)return t.arrayBuffer();throw Error(`Failed to fetch model: ${n.modelAssetPath} (${t.status})`)}).then(e=>{try{t.g.h.FS_unlink("/model.dat")}catch{}t.g.h.FS_createDataFile("/","model.dat",new Uint8Array(e),!0,!1,!1),Go(t,"/model.dat"),t.u()});if(n.modelAssetBuffer instanceof Uint8Array)Go(t,n.modelAssetBuffer);else if(n.modelAssetBuffer)return async function(t){const e=[];for(var n=0;;){const{done:r,value:o}=await t.read();if(r)break;e.push(o),n+=o.length}if(0===e.length)return new Uint8Array(0);if(1===e.length)return e[0];t=new Uint8Array(n),n=0;for(const r of e)t.set(r,n),n+=r.length;return t}(n.modelAssetBuffer).then(e=>{Go(t,e),t.u()});return t.u(),Promise.resolve()}function Ro(t){try{const e=t.m.length;if(1===e)throw Error(t.m[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.m.map(t=>t.message).join(", "))}finally{t.m=[]}}function zo(t,e){t.j=Math.max(t.j,e)}var qo=class{constructor(t){this.g=t,this.m=[],this.j=0,this.g.setAutoRenderToScreen(!1)}setGraph(t,e){this.g.attachErrorListener((t,e)=>{this.m.push(Error(e))}),this.g.M(),this.g.setGraph(t,e),Ro(this)}finishProcessing(){this.g.finishProcessing(),Ro(this)}close(){this.g.closeGraph()}};qo.prototype.close=qo.prototype.close;var Wo=class extends qo{constructor(t,e){super(new Co(t,e)),this.s={languages:[]},Ne(t=this.i=new wo,0,1,e=new bo)}o(t){return Ne(this.i,0,2,Io(t,Ue(this.i,ho,2))),Do(this,t)}get baseOptions(){return Ue(this.i,bo,1)}set baseOptions(t){Ne(this.i,0,1,t)}J(t){return this.s={languages:[]},this.g.addStringToStream(t,"text_in",this.j+1),this.finishProcessing(),this.s}u(){var t=new eo;Zr(t),Ce(t,15,"classifications_out");const e=new qr;cn(e,So,this.i);const n=new Kr;Ie(n,Yt("mediapipe.tasks.text.text_classifier.TextClassifierGraph")),Jr(n),Ce(n,4,"CLASSIFICATIONS:classifications_out"),n.o(e),$e(t,n),this.g.attachProtoListener("classifications_out",(t,e)=>{if(({classifications:t}=Eo(io(t))),1!==t.length)throw Error(`Expected 1 classification head, got ${t.length}`);this.s.languages=t[0].categories.map(t=>({languageCode:t.categoryName,probability:t.score})),zo(this,e)}),this.g.attachEmptyPacketListener("classifications_out",t=>{zo(this,t)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Wo.prototype.detect=Wo.prototype.J,Wo.prototype.setOptions=Wo.prototype.o,Wo.createFromModelPath=function(t,e){return $o(Wo,t,{baseOptions:{modelAssetPath:e}})},Wo.createFromModelBuffer=function(t,e){return $o(Wo,t,{baseOptions:{modelAssetBuffer:e}})},Wo.createFromOptions=function(t,e){return $o(Wo,t,e)};var Ho=class extends qo{constructor(t,e){super(new Co(t,e)),this.s={classifications:[]},Ne(t=this.i=new wo,0,1,e=new bo)}o(t){return Ne(this.i,0,2,Io(t,Ue(this.i,ho,2))),Do(this,t)}get baseOptions(){return Ue(this.i,bo,1)}set baseOptions(t){Ne(this.i,0,1,t)}I(t){return this.s={classifications:[]},this.g.addStringToStream(t,"text_in",this.j+1),this.finishProcessing(),this.s}u(){var t=new eo;Zr(t),Ce(t,15,"classifications_out");const e=new qr;cn(e,So,this.i);const n=new Kr;Ie(n,Yt("mediapipe.tasks.text.text_classifier.TextClassifierGraph")),Jr(n),Ce(n,4,"CLASSIFICATIONS:classifications_out"),n.o(e),$e(t,n),this.g.attachProtoListener("classifications_out",(t,e)=>{this.s=Eo(io(t)),zo(this,e)}),this.g.attachEmptyPacketListener("classifications_out",t=>{zo(this,t)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ho.prototype.classify=Ho.prototype.I,Ho.prototype.setOptions=Ho.prototype.o,Ho.createFromModelPath=function(t,e){return $o(Ho,t,{baseOptions:{modelAssetPath:e}})},Ho.createFromModelBuffer=function(t,e){return $o(Ho,t,{baseOptions:{modelAssetBuffer:e}})},Ho.createFromOptions=function(t,e){return $o(Ho,t,e)};var Jo=class extends qo{constructor(t,e){super(new Co(t,e)),this.s={embeddings:[]},Ne(t=this.i=new _o,0,1,e=new bo)}o(t){var e=this.i,n=Ue(this.i,fo,2);return n=n?he(n):new fo,void 0!==t.l2Normalize?me(n,1,Dt(t.l2Normalize)):"l2Normalize"in t&&me(n,1),void 0!==t.quantize?me(n,2,Dt(t.quantize)):"quantize"in t&&me(n,2),Ne(e,0,2,n),Do(this,t)}get baseOptions(){return Ue(this.i,bo,1)}set baseOptions(t){Ne(this.i,0,1,t)}K(t){return this.g.addStringToStream(t,"text_in",this.j+1),this.finishProcessing(),this.s}u(){var t=new eo;Zr(t),Ce(t,15,"embeddings_out");const e=new qr;cn(e,Ao,this.i);const n=new Kr;Ie(n,Yt("mediapipe.tasks.text.text_embedder.TextEmbedderGraph")),Jr(n),Ce(n,4,"EMBEDDINGS:embeddings_out"),n.o(e),$e(t,n),this.g.attachProtoListener("embeddings_out",(t,e)=>{t=lo(t),this.s=function(t){return{embeddings:Me(t,uo).map(t=>{const e={headIndex:qt(ge(t,3))??0??-1,headName:Qt(ge(t,4))??""??""};if(void 0!==ke(t,so,Te(t,1)))e.floatEmbedding=ve(Ue(t,so,Te(t,1)),1,Gt,void 0===pt?2:4).slice();else{const n=new Uint8Array(0);e.quantizedEmbedding=Ue(t,ao,Te(t,2))?.H()?.i()??n}return e}),timestampMs:Kt(ge(t,2))??0}}(t),zo(this,e)}),this.g.attachEmptyPacketListener("embeddings_out",t=>{zo(this,t)}),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Jo.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=Po(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=Po(To(t.quantizedEmbedding),To(e.quantizedEmbedding))}return t},Jo.prototype.embed=Jo.prototype.K,Jo.prototype.setOptions=Jo.prototype.o,Jo.createFromModelPath=function(t,e){return $o(Jo,t,{baseOptions:{modelAssetPath:e}})},Jo.createFromModelBuffer=function(t,e){return $o(Jo,t,{baseOptions:{modelAssetBuffer:e}})},Jo.createFromOptions=function(t,e){return $o(Jo,t,e)},e.FilesetResolver=Uo,e.LanguageDetector=Wo,e.TaskRunner=qo,e.TextClassifier=Ho,e.TextEmbedder=Jo}}]);